1
00:00:26,516 --> 00:00:31,136
[ Applause ]


2
00:00:31,636 --> 00:00:32,356
>> All right.


3
00:00:32,356 --> 00:00:33,956
Good evening, everyone.


4
00:00:34,196 --> 00:00:35,066
My name is Eugene.


5
00:00:35,286 --> 00:00:37,206
I'm an engineer on the Messages


6
00:00:37,206 --> 00:00:39,616
team and I am super excited to


7
00:00:39,616 --> 00:00:40,986
be here tonight to speak with


8
00:00:40,986 --> 00:00:43,496
you about what's new in iMessage


9
00:00:43,496 --> 00:00:43,916
apps.


10
00:00:45,016 --> 00:00:45,766
Let's dive in here.


11
00:00:46,076 --> 00:00:47,776
We've got a couple of things on


12
00:00:47,776 --> 00:00:48,726
the agenda this evening.


13
00:00:49,216 --> 00:00:51,366
First one, we want to show off a


14
00:00:51,366 --> 00:00:52,546
little bit of what's new in the


15
00:00:52,646 --> 00:00:54,686
iMessage app area in iOS 11.


16
00:00:54,726 --> 00:00:55,646
Some of the stuff you saw in the


17
00:00:55,646 --> 00:00:56,826
keynote plus a little bit more.


18
00:00:58,196 --> 00:00:59,556
After that, we're going to be


19
00:00:59,556 --> 00:01:00,956
introducing our awesome new


20
00:01:00,956 --> 00:01:02,286
Direct Send API.


21
00:01:03,176 --> 00:01:06,896
After that, my colleagues Jay


22
00:01:06,896 --> 00:01:07,946
and Stephen will be coming on


23
00:01:07,946 --> 00:01:09,846
stage to talk to you about our


24
00:01:09,846 --> 00:01:11,246
new Live Message Layouts.


25
00:01:12,226 --> 00:01:13,386
And finally, we'll be wrapping


26
00:01:13,386 --> 00:01:15,246
up the talk with a couple best


27
00:01:15,246 --> 00:01:17,276
practices tips and tricks for


28
00:01:17,276 --> 00:01:17,966
your iMessage apps.


29
00:01:21,136 --> 00:01:22,536
So a lot of what we're talking


30
00:01:22,536 --> 00:01:24,336
about this year builds off the


31
00:01:24,336 --> 00:01:26,036
fundamentals that we established


32
00:01:26,036 --> 00:01:27,796
last year with iOS 10 and the


33
00:01:27,796 --> 00:01:29,576
introduction of the Messages


34
00:01:29,576 --> 00:01:29,996
framework.


35
00:01:30,526 --> 00:01:31,806
So if you need a refresher about


36
00:01:31,806 --> 00:01:32,966
the Messages framework or


37
00:01:32,966 --> 00:01:34,246
iMessage apps in general, we


38
00:01:34,246 --> 00:01:36,906
highly recommend watching our


39
00:01:36,906 --> 00:01:39,026
previous year session iMessage


40
00:01:39,106 --> 00:01:41,356
Apps and Stickers Part 2, which


41
00:01:41,386 --> 00:01:43,516
is available on the developer


42
00:01:43,516 --> 00:01:43,896
portal.


43
00:01:44,286 --> 00:01:45,706
So give that a look if you'd


44
00:01:45,706 --> 00:01:46,306
like a refresher.


45
00:01:46,306 --> 00:01:49,816
So let's get into the cool


46
00:01:49,816 --> 00:01:50,206
stuff.


47
00:01:50,556 --> 00:01:52,176
What's new in the Messages app


48
00:01:52,176 --> 00:01:52,556
area.


49
00:01:52,746 --> 00:01:54,646
So as you all saw on Monday,


50
00:01:54,816 --> 00:01:56,756
we've updated a little bit of


51
00:01:57,006 --> 00:01:59,436
the Messages app UI for iOS 11.


52
00:02:00,036 --> 00:02:01,986
So I just saw on Monday when a


53
00:02:01,986 --> 00:02:03,636
user enters the conversation now


54
00:02:04,206 --> 00:02:06,436
we put all the app icons right


55
00:02:06,476 --> 00:02:07,766
there at the bottom of the


56
00:02:07,766 --> 00:02:09,006
screen which makes it really


57
00:02:09,006 --> 00:02:10,356
easy for users to launch


58
00:02:10,356 --> 00:02:12,296
applications right when entering


59
00:02:12,296 --> 00:02:13,056
a conversation.


60
00:02:13,596 --> 00:02:18,166
As with iOS 10, your application


61
00:02:18,166 --> 00:02:19,196
still lives in kind of the


62
00:02:19,196 --> 00:02:21,246
keyboard area but we still have


63
00:02:21,246 --> 00:02:22,596
the application icons down at


64
00:02:22,596 --> 00:02:23,086
the bottom.


65
00:02:24,336 --> 00:02:26,786
Now users can scroll this


66
00:02:26,786 --> 00:02:28,736
application list left and right


67
00:02:29,276 --> 00:02:30,666
to quickly find the application


68
00:02:30,666 --> 00:02:31,266
they want to launch.


69
00:02:32,526 --> 00:02:33,566
We've also divided the strip


70
00:02:33,566 --> 00:02:34,766
into two different sections, as


71
00:02:34,766 --> 00:02:35,426
you can see up here.


72
00:02:36,146 --> 00:02:37,856
The left-hand side we have the


73
00:02:37,856 --> 00:02:39,686
users favorite section which is


74
00:02:39,766 --> 00:02:41,286
ordered by the user, and on the


75
00:02:41,286 --> 00:02:43,466
right-hand side we have the most


76
00:02:43,466 --> 00:02:45,076
recently used applications.


77
00:02:46,276 --> 00:02:48,946
So users can also rearrange


78
00:02:48,946 --> 00:02:50,186
their applications out of the


79
00:02:50,186 --> 00:02:51,436
recent section and into their


80
00:02:51,436 --> 00:02:53,616
favorites for easy use and for


81
00:02:53,616 --> 00:02:55,286
accessibility right when they


82
00:02:55,286 --> 00:02:56,346
enter the conversation.


83
00:02:56,536 --> 00:02:57,746
So we think this is a great way


84
00:02:58,016 --> 00:02:59,156
for users to enter a


85
00:02:59,156 --> 00:03:00,726
conversation, tap the app they


86
00:03:00,726 --> 00:03:02,926
want and be able to use your


87
00:03:02,926 --> 00:03:04,226
application immediately.


88
00:03:04,846 --> 00:03:07,956
One really cool change their


89
00:03:07,956 --> 00:03:10,216
making this year revolves around


90
00:03:10,216 --> 00:03:11,956
how we handle app installations.


91
00:03:12,476 --> 00:03:14,676
So now in iOS 11 if you download


92
00:03:14,676 --> 00:03:16,146
an application from the iMessage


93
00:03:16,146 --> 00:03:18,366
app store or you download from


94
00:03:18,366 --> 00:03:20,096
our primary app store we will


95
00:03:20,096 --> 00:03:22,216
enable your application by


96
00:03:22,216 --> 00:03:24,036
default and the Messages app


97
00:03:24,036 --> 00:03:24,246
drawer.


98
00:03:25,036 --> 00:03:25,696
In addition --


99
00:03:26,516 --> 00:03:28,896
[ Applause ]


100
00:03:29,396 --> 00:03:30,626
So in addition, we will order


101
00:03:30,626 --> 00:03:32,396
your applications icon to the


102
00:03:32,396 --> 00:03:34,186
very first item in the most


103
00:03:34,186 --> 00:03:35,916
recently used apps so users can


104
00:03:35,916 --> 00:03:37,876
find it easily and launch the


105
00:03:37,876 --> 00:03:39,356
application immediately.


106
00:03:39,596 --> 00:03:41,236
So there's just a couple changes


107
00:03:41,286 --> 00:03:42,846
that we have for the Messages


108
00:03:42,846 --> 00:03:43,296
app UI.


109
00:03:43,406 --> 00:03:45,366
A lot of it you guys have today.


110
00:03:45,696 --> 00:03:50,226
Next up we have our brand new


111
00:03:50,226 --> 00:03:51,856
Direct Send API.


112
00:03:51,976 --> 00:03:53,256
We're super excited to share


113
00:03:53,256 --> 00:03:53,926
this with all of you.


114
00:03:54,486 --> 00:03:58,656
So in iOS 10, the only way to


115
00:03:58,656 --> 00:03:59,706
share content out of your


116
00:03:59,706 --> 00:04:01,666
Messages app would be to call an


117
00:04:01,666 --> 00:04:03,816
insert API which puts your


118
00:04:03,816 --> 00:04:07,346
message into the Messages entry


119
00:04:07,346 --> 00:04:08,066
view.


120
00:04:08,846 --> 00:04:09,806
And so while this works great


121
00:04:09,806 --> 00:04:11,466
for many applications, for some


122
00:04:11,466 --> 00:04:12,956
user experiences like this game


123
00:04:13,396 --> 00:04:14,656
when the users say makes the


124
00:04:14,656 --> 00:04:16,856
game move next logical step


125
00:04:16,995 --> 00:04:18,606
would probably be the message


126
00:04:18,745 --> 00:04:19,896
actually being sent and


127
00:04:19,966 --> 00:04:21,266
inserting that message into the


128
00:04:21,266 --> 00:04:23,156
entry view kind of adds an extra


129
00:04:23,156 --> 00:04:23,496
tap.


130
00:04:23,616 --> 00:04:25,536
So we thought this year how can


131
00:04:25,536 --> 00:04:26,776
we make this easier, how can we


132
00:04:26,776 --> 00:04:28,386
make this a better user


133
00:04:28,386 --> 00:04:29,096
experience?


134
00:04:29,596 --> 00:04:32,656
So in iOS 11 you can send any


135
00:04:32,656 --> 00:04:34,196
content that you would have


136
00:04:34,326 --> 00:04:35,206
normally inserted into the


137
00:04:35,206 --> 00:04:37,196
Messages entry view directly


138
00:04:37,286 --> 00:04:38,066
from your application.


139
00:04:39,106 --> 00:04:39,906
So how does this work?


140
00:04:40,456 --> 00:04:44,076
In iOS 10 we introduced MS


141
00:04:44,076 --> 00:04:46,006
conversation which defined the


142
00:04:46,006 --> 00:04:47,336
following insert APIs.


143
00:04:47,726 --> 00:04:49,966
Insert message ,insert sticker,


144
00:04:50,506 --> 00:04:53,046
insertText, and insertAttachment


145
00:04:53,086 --> 00:04:54,086
which supports any of our


146
00:04:54,086 --> 00:04:55,316
standard Messages attachment


147
00:04:55,316 --> 00:04:55,556
types.


148
00:04:56,856 --> 00:04:58,876
In iOS 11 we have a very simple


149
00:04:59,456 --> 00:05:01,836
analogist API called Send


150
00:05:01,836 --> 00:05:04,076
Message, Send Sticker, Send


151
00:05:04,076 --> 00:05:05,886
Text, and Send Attachment.


152
00:05:06,416 --> 00:05:07,836
So calling into anyone of these


153
00:05:07,836 --> 00:05:09,356
will bypass the Messages entry


154
00:05:09,356 --> 00:05:11,686
view and insert -- send you a


155
00:05:11,686 --> 00:05:13,136
message immediately in the


156
00:05:13,136 --> 00:05:13,886
conversation.


157
00:05:14,306 --> 00:05:16,806
So really quick and easy API.


158
00:05:17,516 --> 00:05:22,076
[ Applause ]


159
00:05:22,576 --> 00:05:24,986
So you may ask which API --


160
00:05:25,176 --> 00:05:27,266
which user experience is best


161
00:05:27,426 --> 00:05:29,596
for my application, both Insert


162
00:05:29,596 --> 00:05:32,356
Draft and Send Message APIs are


163
00:05:32,356 --> 00:05:34,496
first party citizens in iOS 11,


164
00:05:34,816 --> 00:05:35,876
and it's up to you to decide


165
00:05:35,876 --> 00:05:36,646
which one is best for your


166
00:05:36,646 --> 00:05:37,186
application.


167
00:05:37,826 --> 00:05:42,216
So the Insert Draft API is still


168
00:05:42,316 --> 00:05:43,746
the recommended API for most


169
00:05:43,746 --> 00:05:45,596
applications as it allows for


170
00:05:45,596 --> 00:05:47,346
richer composition experience.


171
00:05:47,446 --> 00:05:49,016
For example, user can insert a


172
00:05:49,016 --> 00:05:50,776
message and then say append a


173
00:05:50,776 --> 00:05:51,636
comment to the end of the


174
00:05:51,636 --> 00:05:53,766
message, or send with a screen


175
00:05:53,766 --> 00:05:55,336
effect or a full screen moment.


176
00:05:55,906 --> 00:05:57,546
So it's a really great way to


177
00:05:57,546 --> 00:05:58,946
enrich the content that you


178
00:05:58,946 --> 00:05:59,936
would already be sending.


179
00:06:00,146 --> 00:06:02,416
In addition, it gives the user


180
00:06:02,416 --> 00:06:04,576
an opportunity to verify the


181
00:06:04,576 --> 00:06:05,896
content that will be sent which


182
00:06:05,896 --> 00:06:06,796
is extremely important.


183
00:06:07,336 --> 00:06:10,816
On the other hand, Direct Send


184
00:06:10,816 --> 00:06:13,216
API offers a superfast quick and


185
00:06:13,216 --> 00:06:14,226
easy user experience that's


186
00:06:14,286 --> 00:06:16,496
great for, say, games and stuff


187
00:06:16,496 --> 00:06:17,186
like we saw above.


188
00:06:18,186 --> 00:06:19,766
So it's great for any


189
00:06:19,766 --> 00:06:22,676
application where the insert


190
00:06:22,676 --> 00:06:25,076
flow has tapping the entry view


191
00:06:25,076 --> 00:06:26,846
button feel like an extra step


192
00:06:26,846 --> 00:06:27,766
that you really don't need.


193
00:06:29,156 --> 00:06:31,396
However, when using this API it


194
00:06:31,396 --> 00:06:32,746
is extremely important to


195
00:06:32,746 --> 00:06:34,036
maintain user trust in your


196
00:06:34,036 --> 00:06:34,716
application.


197
00:06:35,016 --> 00:06:36,656
So it's important to very


198
00:06:36,656 --> 00:06:38,126
clearly indicate to the user


199
00:06:38,436 --> 00:06:39,956
exactly what content is going to


200
00:06:39,956 --> 00:06:42,226
be sent and also to clearly


201
00:06:42,226 --> 00:06:44,446
denote to the user exactly what


202
00:06:44,636 --> 00:06:46,366
user interaction or interface


203
00:06:46,366 --> 00:06:47,936
element within your application


204
00:06:48,126 --> 00:06:49,236
will trigger send.


205
00:06:49,236 --> 00:06:52,066
So to help promote a great user


206
00:06:52,066 --> 00:06:53,116
experience with a direct send


207
00:06:53,116 --> 00:06:55,396
API Messages enforces a couple


208
00:06:55,396 --> 00:06:57,286
requirements on this APIs use.


209
00:06:58,546 --> 00:07:00,596
Firstly, your application must


210
00:07:00,596 --> 00:07:02,476
be the visible Messages app on


211
00:07:02,516 --> 00:07:03,016
screen.


212
00:07:03,016 --> 00:07:05,116
As you may know, your Messages


213
00:07:05,116 --> 00:07:06,776
app extension may be running in


214
00:07:06,776 --> 00:07:08,396
the background within Messages


215
00:07:08,396 --> 00:07:10,296
and not actually be the current


216
00:07:10,346 --> 00:07:11,336
foreground application.


217
00:07:11,386 --> 00:07:13,266
So first requirement is your


218
00:07:13,266 --> 00:07:14,476
application must be visible.


219
00:07:15,776 --> 00:07:19,186
In addition, our target user


220
00:07:19,186 --> 00:07:20,776
experience for this is to have


221
00:07:20,776 --> 00:07:22,956
the user tap the screen or


222
00:07:22,956 --> 00:07:24,206
interact with your application


223
00:07:24,566 --> 00:07:25,536
and then to have a send be


224
00:07:25,536 --> 00:07:25,996
triggered.


225
00:07:26,566 --> 00:07:28,696
So to facilitate this, Messages


226
00:07:28,696 --> 00:07:30,706
will detect user interaction on


227
00:07:30,706 --> 00:07:32,436
your app and allow for a direct


228
00:07:32,526 --> 00:07:34,656
send API call to be made upon


229
00:07:34,656 --> 00:07:36,156
detection of that user


230
00:07:36,156 --> 00:07:36,786
interaction.


231
00:07:37,556 --> 00:07:39,116
Subsequent direct send calls


232
00:07:39,116 --> 00:07:40,836
will fail until we detect


233
00:07:40,916 --> 00:07:42,636
another user interaction, so


234
00:07:42,806 --> 00:07:44,956
kind of keeping with one-to-one


235
00:07:45,046 --> 00:07:46,186
the user press something on your


236
00:07:46,186 --> 00:07:47,966
screen and a send is allowed.


237
00:07:48,896 --> 00:07:51,406
So to help you as developers


238
00:07:51,406 --> 00:07:52,776
understand what's happening with


239
00:07:52,776 --> 00:07:54,806
the send API, we are introducing


240
00:07:55,016 --> 00:07:57,976
two new air codes, MSMessage air


241
00:07:57,976 --> 00:07:58,346
codes.


242
00:07:58,346 --> 00:07:58,696
We have


243
00:07:58,786 --> 00:08:00,606
sendwithoutRecentInteraction and


244
00:08:00,666 --> 00:08:02,286
sendwhileNotVisible.


245
00:08:02,566 --> 00:08:04,226
So as always, use great air


246
00:08:04,226 --> 00:08:06,666
handling so your application can


247
00:08:06,666 --> 00:08:07,596
catch these dates.


248
00:08:10,046 --> 00:08:10,916
And that's Direct Send.


249
00:08:11,266 --> 00:08:12,036
It's very simple.


250
00:08:12,036 --> 00:08:13,186
I think it's going to be a great


251
00:08:13,186 --> 00:08:14,626
user experience for the apps


252
00:08:14,716 --> 00:08:15,626
where it makes sense for.


253
00:08:15,626 --> 00:08:17,146
Definitely consider whether


254
00:08:17,146 --> 00:08:20,376
Insert Draft or Send makes the


255
00:08:20,376 --> 00:08:21,436
most sense for your application,


256
00:08:21,436 --> 00:08:22,566
and we're very excited to see


257
00:08:22,566 --> 00:08:26,416
what you-guys can build with it.


258
00:08:26,676 --> 00:08:27,246
All right.


259
00:08:27,386 --> 00:08:28,846
So next I'd like to invite


260
00:08:28,846 --> 00:08:31,656
Stephen up stage to introduce


261
00:08:31,656 --> 00:08:32,926
you to Live Message Layouts.


262
00:08:34,515 --> 00:08:38,916
[ Applause ]


263
00:08:39,416 --> 00:08:40,306
>> Hi everyone.


264
00:08:41,086 --> 00:08:44,285
So today I'm excited to return


265
00:08:44,285 --> 00:08:45,436
to the stage to you to talk to


266
00:08:45,436 --> 00:08:46,816
you about Live Message Layouts.


267
00:08:47,566 --> 00:08:50,346
Now in iOS 10 we introduced


268
00:08:50,346 --> 00:08:51,346
Messages framework and the


269
00:08:51,346 --> 00:08:53,046
ability for you to bring your


270
00:08:53,046 --> 00:08:54,166
app experience right into


271
00:08:54,166 --> 00:08:54,616
Messages.


272
00:08:55,306 --> 00:08:58,556
When you would build your


273
00:08:58,556 --> 00:09:01,166
iMessage app, your app could be


274
00:09:01,166 --> 00:09:02,936
shown here in the keyboard area


275
00:09:02,996 --> 00:09:04,616
in Messages or in a full screen


276
00:09:04,616 --> 00:09:05,646
presentation, and these would be


277
00:09:05,646 --> 00:09:06,856
the compact and expanded


278
00:09:06,856 --> 00:09:07,886
presentation styles that you


279
00:09:07,886 --> 00:09:08,236
could use.


280
00:09:09,296 --> 00:09:10,226
And then when you would send the


281
00:09:10,226 --> 00:09:12,016
message your app would use a


282
00:09:12,016 --> 00:09:13,856
template driven -- or we would


283
00:09:13,856 --> 00:09:15,016
use a template driven layout


284
00:09:15,016 --> 00:09:16,376
approach for your app message.


285
00:09:16,926 --> 00:09:18,056
Now this template layout had


286
00:09:18,056 --> 00:09:20,546
customization objects or options


287
00:09:21,116 --> 00:09:23,296
such as image and the text


288
00:09:23,296 --> 00:09:25,736
properties here, and it allowed


289
00:09:25,736 --> 00:09:27,116
you to provide some pretty good


290
00:09:27,116 --> 00:09:29,586
rich app messages, however, it's


291
00:09:29,586 --> 00:09:30,546
still limited by what the


292
00:09:30,546 --> 00:09:31,276
template provides.


293
00:09:32,736 --> 00:09:33,996
In iOS 11, I'm excited to


294
00:09:33,996 --> 00:09:35,316
announce that you can now


295
00:09:35,586 --> 00:09:37,486
completely customize what your


296
00:09:37,486 --> 00:09:39,256
app messages look like using


297
00:09:39,686 --> 00:09:40,566
these liveLayouts.


298
00:09:41,276 --> 00:09:43,896
So this is actually a view


299
00:09:43,896 --> 00:09:45,166
provided by the application


300
00:09:45,166 --> 00:09:46,586
itself here in the Messages


301
00:09:46,586 --> 00:09:47,086
transcript.


302
00:09:47,536 --> 00:09:50,156
The app could also drive a view


303
00:09:50,356 --> 00:09:53,326
as a draft message, and in fact


304
00:09:53,326 --> 00:09:55,106
can provide custom views to


305
00:09:55,186 --> 00:09:56,426
represent many messages


306
00:09:56,546 --> 00:09:57,456
simultaneously in the


307
00:09:57,456 --> 00:09:57,936
transcript.


308
00:09:58,446 --> 00:10:01,156
Of course we support the world


309
00:10:01,156 --> 00:10:02,456
where maybe your app isn't the


310
00:10:02,456 --> 00:10:05,126
only one on screen, but really


311
00:10:05,126 --> 00:10:06,106
we only care about your app.


312
00:10:06,546 --> 00:10:07,336
We're here to talk to you about


313
00:10:07,336 --> 00:10:07,706
that today.


314
00:10:10,516 --> 00:10:12,136
So I'd like to give you a quick


315
00:10:12,136 --> 00:10:14,536
demo of what that looks like in


316
00:10:14,536 --> 00:10:14,916
action.


317
00:10:15,966 --> 00:10:18,126
So here I have a simple iMessage


318
00:10:18,126 --> 00:10:20,196
app that I've built called Event


319
00:10:20,196 --> 00:10:22,196
Countdown, and this is just a


320
00:10:22,196 --> 00:10:23,716
simple list of upcoming events


321
00:10:23,716 --> 00:10:25,586
that I'm excited about and want


322
00:10:25,586 --> 00:10:26,686
to share with my friends via


323
00:10:26,686 --> 00:10:27,146
Messages.


324
00:10:27,846 --> 00:10:30,026
So for example, if I tap the


325
00:10:30,026 --> 00:10:32,836
batch here you'll see a


326
00:10:32,836 --> 00:10:34,176
completely custom message is


327
00:10:34,296 --> 00:10:35,316
presented here as a draft


328
00:10:35,316 --> 00:10:35,796
message.


329
00:10:36,396 --> 00:10:37,666
It's live updating, it has this


330
00:10:37,666 --> 00:10:38,896
great countdown that's building


331
00:10:38,896 --> 00:10:40,226
anticipation for the upcoming


332
00:10:40,226 --> 00:10:40,566
event.


333
00:10:40,666 --> 00:10:42,916
And when I send it, that same


334
00:10:42,916 --> 00:10:44,486
view is put in the transcript


335
00:10:45,176 --> 00:10:46,066
that would be seen on the other


336
00:10:46,066 --> 00:10:46,386
side.


337
00:10:46,846 --> 00:10:49,206
In fact, if we go into the


338
00:10:49,206 --> 00:10:51,616
recipient side or to see what a


339
00:10:51,616 --> 00:10:53,316
recipient might have sent or the


340
00:10:53,356 --> 00:10:56,656
other side might have sent, here


341
00:10:56,656 --> 00:10:58,046
I have an invitation from


342
00:10:58,046 --> 00:10:58,476
Eugene.


343
00:10:59,766 --> 00:11:00,976
This is a similar app message,


344
00:11:00,976 --> 00:11:02,746
but my iMessage app has chosen


345
00:11:03,176 --> 00:11:04,626
to render a completely different


346
00:11:04,626 --> 00:11:05,916
view on the receiver side.


347
00:11:06,746 --> 00:11:08,296
I'm representing an unaccepted


348
00:11:08,296 --> 00:11:09,416
invitation at this point.


349
00:11:10,696 --> 00:11:12,396
If I tap this app message bubble


350
00:11:12,396 --> 00:11:15,286
here, I mark the event as


351
00:11:15,286 --> 00:11:17,536
accepted and now it switches to


352
00:11:17,536 --> 00:11:19,106
that live countdown mode.


353
00:11:19,686 --> 00:11:21,596
I was able to do all that


354
00:11:21,596 --> 00:11:23,406
without even having to launch my


355
00:11:23,406 --> 00:11:24,946
iMessage app in this context.


356
00:11:24,946 --> 00:11:28,556
Now here in the top right I have


357
00:11:28,556 --> 00:11:29,556
a little infoButton.


358
00:11:30,426 --> 00:11:31,796
Not all experiences are


359
00:11:31,796 --> 00:11:33,136
appropriate to try to shove into


360
00:11:33,136 --> 00:11:33,836
an app message.


361
00:11:35,276 --> 00:11:37,156
By tapping this infoButton, I


362
00:11:37,156 --> 00:11:39,136
can actually request that my app


363
00:11:39,136 --> 00:11:40,196
be presented in a different


364
00:11:40,196 --> 00:11:42,326
presentation style to see more


365
00:11:42,326 --> 00:11:44,126
information about my event.


366
00:11:46,676 --> 00:11:48,396
So I hope you can see that here


367
00:11:48,446 --> 00:11:49,666
with Live Message Layouts you


368
00:11:49,666 --> 00:11:51,526
can build a really rich user


369
00:11:51,526 --> 00:11:53,166
experience, complete with


370
00:11:53,166 --> 00:11:54,616
interactions and live updating


371
00:11:54,616 --> 00:11:56,536
content, and it's really easy to


372
00:11:56,876 --> 00:11:56,946
do.


373
00:12:02,176 --> 00:12:03,116
So let's talk about how this


374
00:12:03,116 --> 00:12:03,386
works.


375
00:12:04,116 --> 00:12:07,366
So here when the iMessage app is


376
00:12:07,366 --> 00:12:08,726
being shown in the compact


377
00:12:08,776 --> 00:12:10,526
presentation style, we have


378
00:12:10,526 --> 00:12:12,726
instantiated an instance of the


379
00:12:12,766 --> 00:12:14,086
MSMessages app view controller


380
00:12:14,166 --> 00:12:15,926
subclass and configured it in


381
00:12:15,926 --> 00:12:17,376
the compact presentation style.


382
00:12:17,376 --> 00:12:20,456
When an app message with a


383
00:12:20,456 --> 00:12:22,106
liveLayout is shown on screen,


384
00:12:22,816 --> 00:12:24,716
we'll instantiate another


385
00:12:24,716 --> 00:12:26,746
instance of that same base class


386
00:12:27,536 --> 00:12:28,286
and configure it with a


387
00:12:28,286 --> 00:12:29,736
transcript presentation style.


388
00:12:30,316 --> 00:12:33,736
In fact, for each message


389
00:12:33,736 --> 00:12:35,156
displayed in the transcript we


390
00:12:36,036 --> 00:12:37,696
will instantiate a new instance


391
00:12:37,966 --> 00:12:40,026
of this class configured again


392
00:12:40,026 --> 00:12:41,256
in that transcript presentation


393
00:12:41,256 --> 00:12:41,566
style.


394
00:12:42,536 --> 00:12:44,006
There is a strict one-to-one


395
00:12:44,526 --> 00:12:46,196
relationship between these


396
00:12:46,196 --> 00:12:48,066
instances and an app message


397
00:12:48,066 --> 00:12:51,346
that they represent on screen.


398
00:12:51,586 --> 00:12:53,316
So that's a quick overview of


399
00:12:53,316 --> 00:12:54,246
Live Message Layouts.


400
00:12:55,036 --> 00:12:56,326
Now to walk you through more of


401
00:12:56,326 --> 00:12:57,726
the API and how to get started,


402
00:12:57,726 --> 00:12:59,096
I'd like to invite Jay on stage.


403
00:13:00,516 --> 00:13:04,500
[ Applause ]


404
00:13:11,316 --> 00:13:12,316
>> Well thanks, Stephen, for the


405
00:13:12,316 --> 00:13:12,956
introduction.


406
00:13:13,356 --> 00:13:15,216
My name is Jay and I'm here to


407
00:13:15,216 --> 00:13:16,546
introduce to you some of the new


408
00:13:16,546 --> 00:13:18,506
APIs we've added for Live


409
00:13:18,506 --> 00:13:19,156
Message Layout.


410
00:13:19,216 --> 00:13:21,706
So let's get started.


411
00:13:26,046 --> 00:13:27,266
As some of you may be familiar,


412
00:13:27,826 --> 00:13:29,116
you were able to customize your


413
00:13:29,116 --> 00:13:30,196
app bubble using


414
00:13:30,256 --> 00:13:31,246
MSMessageLayout.


415
00:13:32,296 --> 00:13:34,416
With existing MSMessage template


416
00:13:34,416 --> 00:13:35,916
layout you're only able to


417
00:13:35,916 --> 00:13:37,296
customize a limited set of


418
00:13:37,296 --> 00:13:39,896
appearances such as captions and


419
00:13:39,896 --> 00:13:40,366
images.


420
00:13:40,936 --> 00:13:44,716
In iOS 11, to support a fully


421
00:13:44,716 --> 00:13:47,056
customizable bubble we're adding


422
00:13:47,236 --> 00:13:48,166
a new subclass


423
00:13:49,996 --> 00:13:51,876
MSMessageLiveLayout.


424
00:13:51,876 --> 00:13:54,676
So let's take look at this real


425
00:13:54,676 --> 00:13:54,876
quick.


426
00:13:58,756 --> 00:14:00,676
As you can see, there aren't


427
00:14:00,676 --> 00:14:02,486
that many things to fill out as


428
00:14:02,486 --> 00:14:03,676
you have to do for the template


429
00:14:03,676 --> 00:14:04,056
layout.


430
00:14:05,546 --> 00:14:08,546
Well that's because now you have


431
00:14:08,576 --> 00:14:10,536
the opportunity to fully express


432
00:14:10,766 --> 00:14:11,846
how these app bubbles should


433
00:14:11,846 --> 00:14:12,906
look like.


434
00:14:13,716 --> 00:14:15,606
Though you may have noticed that


435
00:14:15,676 --> 00:14:17,076
there is one property called


436
00:14:17,076 --> 00:14:20,866
Alternate Layout and so what is


437
00:14:22,996 --> 00:14:23,096
this?


438
00:14:23,306 --> 00:14:24,266
Now there will be a few


439
00:14:24,266 --> 00:14:26,826
instances where your app bubble


440
00:14:26,826 --> 00:14:28,086
won't be supported by the


441
00:14:28,086 --> 00:14:29,056
receiving devices.


442
00:14:30,026 --> 00:14:32,336
In cases such as they don't have


443
00:14:32,336 --> 00:14:34,666
your extension installed or


444
00:14:34,666 --> 00:14:35,796
they're just running on older


445
00:14:35,866 --> 00:14:39,566
Apple iOS versions, iOS, macOS,


446
00:14:39,566 --> 00:14:40,406
or watchOS.


447
00:14:41,636 --> 00:14:45,156
So in these scenarios, they'll


448
00:14:45,216 --> 00:14:48,366
be seeing this template layout


449
00:14:48,626 --> 00:14:51,166
as a fallback representation by


450
00:14:51,356 --> 00:14:52,456
if they can actually support


451
00:14:52,456 --> 00:14:54,856
their extension then they'll be


452
00:14:54,856 --> 00:14:56,866
seeing the bubble on the right.


453
00:14:57,576 --> 00:15:01,716
So how do we use this API?


454
00:15:01,946 --> 00:15:04,016
It's very similar to how you did


455
00:15:04,016 --> 00:15:04,836
in iOS 10.


456
00:15:05,716 --> 00:15:07,696
First, create the template


457
00:15:07,696 --> 00:15:08,096
layout.


458
00:15:09,316 --> 00:15:10,336
And with a template layout


459
00:15:10,776 --> 00:15:11,486
you're going to create


460
00:15:11,606 --> 00:15:12,216
liveLayout.


461
00:15:12,806 --> 00:15:17,496
And with a liveLayout say it's a


462
00:15:17,756 --> 00:15:19,576
message and send.


463
00:15:19,736 --> 00:15:21,616
So really similar to what we did


464
00:15:21,616 --> 00:15:25,706
in iOS 10.


465
00:15:25,896 --> 00:15:28,216
So that was it for the


466
00:15:28,396 --> 00:15:29,556
MSMessageLiveLayout.


467
00:15:30,466 --> 00:15:31,796
We have some new additions in


468
00:15:31,916 --> 00:15:33,446
MSMessagesAppViewController.


469
00:15:33,446 --> 00:15:36,806
Now as some of you may be


470
00:15:36,806 --> 00:15:42,236
familiar, this was the principle


471
00:15:42,276 --> 00:15:43,406
class through extension point.


472
00:15:44,386 --> 00:15:45,726
So by configuring this view


473
00:15:45,726 --> 00:15:47,486
controller you're able to


474
00:15:47,486 --> 00:15:49,436
customize the appearance in your


475
00:15:49,916 --> 00:15:51,696
app in the keyboard area, in the


476
00:15:51,696 --> 00:15:52,356
compact mode.


477
00:15:52,896 --> 00:15:56,056
So the bubbles in the transcript


478
00:15:56,056 --> 00:15:57,016
are also backed by View


479
00:15:57,016 --> 00:16:00,516
Controller, and in fact they


480
00:16:00,746 --> 00:16:03,026
have the same class.


481
00:16:03,216 --> 00:16:04,746
Okay. So what does this mean?


482
00:16:06,026 --> 00:16:08,716
That means that this view right


483
00:16:08,716 --> 00:16:12,386
here in the bottom and that view


484
00:16:12,386 --> 00:16:14,186
on the top are coming from the


485
00:16:14,186 --> 00:16:14,766
same class.


486
00:16:16,186 --> 00:16:18,306
So to distinguish these two


487
00:16:18,306 --> 00:16:19,896
cases we've added a new


488
00:16:19,896 --> 00:16:23,366
presentation style transcript.


489
00:16:24,756 --> 00:16:26,836
So when it comes time to


490
00:16:26,836 --> 00:16:27,676
configuring these view


491
00:16:27,676 --> 00:16:30,476
controllers, you can use a


492
00:16:30,476 --> 00:16:32,716
combination of presentationStyle


493
00:16:33,626 --> 00:16:35,946
and selectedMessage to determine


494
00:16:36,246 --> 00:16:37,506
what you want to show in your


495
00:16:37,506 --> 00:16:38,116
view controller.


496
00:16:39,656 --> 00:16:41,696
And one really simple pattern


497
00:16:41,696 --> 00:16:43,636
you can follow is something


498
00:16:43,636 --> 00:16:45,016
along the line of path factory


499
00:16:45,016 --> 00:16:49,386
pattern where you can return


500
00:16:49,476 --> 00:16:50,266
appropriate child view


501
00:16:50,266 --> 00:16:52,586
controller depending on the


502
00:16:52,586 --> 00:16:53,546
state of these properties.


503
00:16:53,546 --> 00:16:54,856
So you're going to have one for


504
00:16:54,856 --> 00:16:58,916
transcript and one for compact.


505
00:17:00,066 --> 00:17:01,486
So if you're already following a


506
00:17:01,486 --> 00:17:05,156
similar pattern and code it will


507
00:17:05,156 --> 00:17:05,955
look something like this.


508
00:17:07,165 --> 00:17:10,016
So for the compact case we have


509
00:17:10,016 --> 00:17:10,806
a helper method


510
00:17:11,806 --> 00:17:14,106
presentSummaryViewController and


511
00:17:14,106 --> 00:17:16,106
this helper method you will


512
00:17:16,106 --> 00:17:16,986
create the right child view


513
00:17:16,986 --> 00:17:18,965
controller and configure a view


514
00:17:18,965 --> 00:17:20,136
controller appropriately.


515
00:17:20,726 --> 00:17:24,126
For the case of expanded, you'll


516
00:17:24,126 --> 00:17:25,646
have another helper method


517
00:17:26,596 --> 00:17:28,226
presentDetailViewController and


518
00:17:28,465 --> 00:17:29,796
will do something very similar


519
00:17:29,796 --> 00:17:31,666
to what you did for the compact


520
00:17:31,666 --> 00:17:31,986
case.


521
00:17:33,126 --> 00:17:34,886
So to handle another case for


522
00:17:34,886 --> 00:17:36,256
the transcript, we can just have


523
00:17:37,676 --> 00:17:39,536
another helper method something


524
00:17:39,536 --> 00:17:40,286
along the line of


525
00:17:40,686 --> 00:17:42,016
presentTranscriptViewController.


526
00:17:47,096 --> 00:17:47,956
So that was it for the


527
00:17:47,956 --> 00:17:50,596
presentation style, but we


528
00:17:50,596 --> 00:17:51,716
actually have one more thing to


529
00:17:51,716 --> 00:17:53,406
go over before you get this live


530
00:17:53,406 --> 00:17:53,966
bubble started.


531
00:17:54,506 --> 00:17:56,616
And that is sizing.


532
00:17:58,066 --> 00:17:59,376
Now, the view controllers are


533
00:17:59,376 --> 00:18:01,556
intended to use for transcript


534
00:18:02,046 --> 00:18:04,006
will conform to the new protocol


535
00:18:04,006 --> 00:18:07,076
called MSMessagesAppTranscript


536
00:18:07,076 --> 00:18:07,846
Presentation.


537
00:18:08,806 --> 00:18:10,436
It has one method called


538
00:18:11,146 --> 00:18:12,226
ContentSizeThatFits.


539
00:18:12,766 --> 00:18:16,796
In this function, return a size


540
00:18:17,366 --> 00:18:19,096
that best represents your view


541
00:18:19,096 --> 00:18:19,796
in the transcript.


542
00:18:21,096 --> 00:18:24,276
So to illustrate, here's an


543
00:18:25,216 --> 00:18:25,536
example.


544
00:18:25,536 --> 00:18:30,206
Now, we want our size to always


545
00:18:30,286 --> 00:18:32,066
fit all the sub views nicely


546
00:18:32,286 --> 00:18:34,236
without getting clipped or any


547
00:18:34,236 --> 00:18:35,586
extras base or anything like


548
00:18:36,266 --> 00:18:36,366
that.


549
00:18:37,126 --> 00:18:39,746
For this particular example, we


550
00:18:39,746 --> 00:18:42,936
have the map view timer and the


551
00:18:43,516 --> 00:18:43,676
button.


552
00:18:43,836 --> 00:18:45,246
And we decided that we'd only


553
00:18:45,246 --> 00:18:47,676
care about the size of the map


554
00:18:47,706 --> 00:18:49,986
view or the timer changing, but


555
00:18:50,146 --> 00:18:52,956
we want the button to adjust


556
00:18:52,956 --> 00:18:55,006
accordingly based on the system


557
00:18:55,006 --> 00:18:55,416
font.


558
00:18:56,586 --> 00:18:57,976
So let's give it a static


559
00:18:57,976 --> 00:19:02,556
number, 217, for the map view


560
00:19:02,556 --> 00:19:04,626
and the timer, and then the line


561
00:19:04,626 --> 00:19:08,156
hide right here will be the size


562
00:19:08,216 --> 00:19:09,936
of the button that takes the


563
00:19:09,936 --> 00:19:11,906
system font into consideration.


564
00:19:12,476 --> 00:19:15,246
So by adding these two numbers


565
00:19:15,296 --> 00:19:17,726
we'll get the right size or the


566
00:19:17,726 --> 00:19:19,436
right height that encompasses


567
00:19:19,496 --> 00:19:23,136
all the sub views in our view.


568
00:19:23,356 --> 00:19:26,426
So with this configuration, I


569
00:19:26,426 --> 00:19:29,016
think the height is about 235


570
00:19:29,056 --> 00:19:29,456
points.


571
00:19:30,046 --> 00:19:33,786
Now keep in mind that this


572
00:19:33,786 --> 00:19:34,846
function will be called again


573
00:19:35,386 --> 00:19:37,386
when there is a change in


574
00:19:37,756 --> 00:19:39,996
transcript size, change in


575
00:19:39,996 --> 00:19:42,386
locale or change in system font.


576
00:19:43,416 --> 00:19:45,216
In these events, these functions


577
00:19:45,216 --> 00:19:47,026
will be called again for a new


578
00:19:48,006 --> 00:19:48,146
size.


579
00:19:48,936 --> 00:19:51,176
So here's an example of change


580
00:19:51,176 --> 00:19:52,176
in system font.


581
00:19:52,226 --> 00:19:54,046
As you can see, the fonts are


582
00:19:54,046 --> 00:19:54,876
slightly bigger.


583
00:19:55,546 --> 00:19:59,136
In this case, we just said that


584
00:19:59,136 --> 00:20:00,656
we didn't care about the map


585
00:20:00,656 --> 00:20:02,236
view or the timer growing or


586
00:20:02,236 --> 00:20:03,666
shrinking so let's look at the


587
00:20:03,666 --> 00:20:04,746
same 217.


588
00:20:06,036 --> 00:20:07,226
But because we're using a


589
00:20:07,226 --> 00:20:09,636
dynamic font for the button, it


590
00:20:09,636 --> 00:20:11,196
automatically picked up a size.


591
00:20:12,306 --> 00:20:14,756
And with this configuration, you


592
00:20:14,756 --> 00:20:16,866
can appropriately return 244.


593
00:20:18,476 --> 00:20:20,726
We'll take this value and resize


594
00:20:20,726 --> 00:20:21,586
your view accordingly.


595
00:20:25,616 --> 00:20:27,906
So that was a lot of talking.


596
00:20:28,416 --> 00:20:30,416
To summarize everything I just


597
00:20:30,416 --> 00:20:32,196
talked about I'd like to show a


598
00:20:32,196 --> 00:20:33,056
quick code demo.


599
00:20:33,826 --> 00:20:35,246
And I know a lot of you-guys are


600
00:20:35,246 --> 00:20:37,626
very eager to be at the bash so


601
00:20:37,756 --> 00:20:40,226
we'll work on a sample app that


602
00:20:40,226 --> 00:20:42,736
shows you a countdown timer to


603
00:20:42,736 --> 00:20:43,766
the bash.


604
00:20:53,046 --> 00:20:53,556
Okay. Cool.


605
00:20:54,176 --> 00:20:58,216
So we have our nice X Code here


606
00:20:58,396 --> 00:21:01,226
and this is the device I have on


607
00:21:01,226 --> 00:21:02,416
the table right now.


608
00:21:03,836 --> 00:21:05,786
So in this demo I'd like to show


609
00:21:05,786 --> 00:21:07,796
how you can extend an existing


610
00:21:07,876 --> 00:21:10,136
iMessage app and start using our


611
00:21:10,136 --> 00:21:11,256
LiveMessageLayout.


612
00:21:12,606 --> 00:21:14,226
So if you remain on iMessage app


613
00:21:14,386 --> 00:21:15,386
it will look something like


614
00:21:15,426 --> 00:21:15,896
this.


615
00:21:17,166 --> 00:21:18,156
So you have an app in the


616
00:21:18,156 --> 00:21:20,616
compact mode and when you're


617
00:21:20,616 --> 00:21:22,736
trying to send it will show a


618
00:21:22,736 --> 00:21:24,066
template layout.


619
00:21:24,956 --> 00:21:26,726
So how about we start using


620
00:21:26,896 --> 00:21:27,836
LiveLayout instead


621
00:21:27,836 --> 00:21:29,436
templateLayout as showing on the


622
00:21:29,436 --> 00:21:29,936
shelf?


623
00:21:29,936 --> 00:21:33,226
So let's get to the code.


624
00:21:33,866 --> 00:21:36,916
And here I'm in


625
00:21:36,916 --> 00:21:40,166
MSMessagesAppViewController sub


626
00:21:41,836 --> 00:21:41,966
class.


627
00:21:42,156 --> 00:21:43,816
And somewhere in this code were


628
00:21:43,816 --> 00:21:45,106
probably creating a template


629
00:21:45,106 --> 00:21:45,536
layout.


630
00:21:45,576 --> 00:21:51,786
So let's look for that.


631
00:21:52,006 --> 00:21:55,416
Found it. So we have this helper


632
00:21:55,416 --> 00:21:56,796
function called sendMessage and


633
00:21:57,256 --> 00:21:58,386
it seems like we are creating


634
00:21:58,386 --> 00:22:01,686
the message, configuring it,


635
00:22:01,816 --> 00:22:04,536
create a templateLayout and then


636
00:22:04,536 --> 00:22:06,196
set that layout to the message


637
00:22:06,686 --> 00:22:08,096
and we're inserting it into the


638
00:22:08,096 --> 00:22:08,696
conversation.


639
00:22:10,066 --> 00:22:11,866
So I think this is a great place


640
00:22:11,906 --> 00:22:13,696
to start using our liveLayout


641
00:22:13,906 --> 00:22:14,526
objects.


642
00:22:15,666 --> 00:22:17,776
So here I'm going to go ahead


643
00:22:24,476 --> 00:22:25,496
and create a liveLayout.


644
00:22:25,496 --> 00:22:27,496
There's the template layout.


645
00:22:27,496 --> 00:22:31,016
And then we can set that as


646
00:22:31,016 --> 00:22:33,006
Messages layout property.


647
00:22:34,526 --> 00:22:37,296
And let's see -- okay.


648
00:22:38,016 --> 00:22:41,646
So with this change you should


649
00:22:41,646 --> 00:22:42,496
be seeing a liveLayout.


650
00:22:42,496 --> 00:22:44,746
And this is definitely a


651
00:22:44,746 --> 00:22:47,486
liveLayout, but this doesn't


652
00:22:47,486 --> 00:22:48,596
look right.


653
00:22:48,966 --> 00:22:50,086
This actually looks exactly like


654
00:22:50,086 --> 00:22:52,466
what you just saw in the compact


655
00:22:52,466 --> 00:22:52,736
mode.


656
00:22:53,696 --> 00:22:54,386
So what went wrong?


657
00:22:55,846 --> 00:22:56,906
Let's get back to the code and


658
00:22:58,406 --> 00:22:59,806
let's try to find out where


659
00:22:59,806 --> 00:23:02,176
we're actually creating this


660
00:23:02,176 --> 00:23:03,906
table view controller that you


661
00:23:03,906 --> 00:23:04,916
see in the compact mode.


662
00:23:06,286 --> 00:23:08,816
And a good place to check that


663
00:23:08,816 --> 00:23:10,936
right now, I'm going to go into


664
00:23:10,936 --> 00:23:13,426
willBecomeActive, okay, I see


665
00:23:13,606 --> 00:23:15,516
updatePresentation.


666
00:23:15,866 --> 00:23:16,916
See what this does.


667
00:23:18,476 --> 00:23:19,236
Oh and I see


668
00:23:19,296 --> 00:23:20,236
presentViewController.


669
00:23:20,826 --> 00:23:26,776
Now this seems like a problem


670
00:23:26,776 --> 00:23:27,246
right here.


671
00:23:28,256 --> 00:23:30,226
For anything that is not


672
00:23:30,226 --> 00:23:31,886
expanded we're always creating a


673
00:23:31,886 --> 00:23:33,866
table view controller and, as


674
00:23:33,866 --> 00:23:36,256
mentioned before, the same view


675
00:23:36,256 --> 00:23:37,466
controller class is used for


676
00:23:37,466 --> 00:23:39,256
both transcript, compact and


677
00:23:39,256 --> 00:23:41,396
expanded so we need to handle


678
00:23:41,396 --> 00:23:43,826
case for transcript which is not


679
00:23:43,826 --> 00:23:44,936
supporting this code right now.


680
00:23:45,556 --> 00:23:47,556
I'm going to leave this code as


681
00:23:47,556 --> 00:23:48,076
it is now.


682
00:23:48,076 --> 00:23:49,166
I'm going to create a new


683
00:23:49,266 --> 00:23:51,726
function so they can start


684
00:23:51,726 --> 00:23:53,626
handling this case.


685
00:23:53,666 --> 00:23:55,056
So I have this


686
00:23:57,756 --> 00:24:03,426
presentTranscriptView and I have


687
00:24:03,426 --> 00:24:04,956
this [inaudible], I have to know


688
00:24:05,096 --> 00:24:07,046
if it's for me or if it's


689
00:24:07,126 --> 00:24:09,076
pending because I want to decide


690
00:24:09,136 --> 00:24:10,576
if I need to show the invitation


691
00:24:10,576 --> 00:24:11,086
button or not.


692
00:24:12,496 --> 00:24:13,456
So now that I have this


693
00:24:13,456 --> 00:24:18,006
transcriptView I can go ahead


694
00:24:18,006 --> 00:24:20,356
and add it to a sub view with


695
00:24:20,746 --> 00:24:21,616
the Auto Layout Magic.


696
00:24:22,196 --> 00:24:25,766
Then I have to call this method


697
00:24:25,766 --> 00:24:26,746
somewhere so I'm going to go


698
00:24:26,746 --> 00:24:27,926
back to updatePresentation.


699
00:24:28,766 --> 00:24:29,266
It's right here.


700
00:24:29,916 --> 00:24:37,206
And here I can start configuring


701
00:24:37,206 --> 00:24:38,926
this viewController for


702
00:24:38,926 --> 00:24:39,496
transcript.


703
00:24:41,576 --> 00:24:43,936
TranscriptView, event,


704
00:24:45,416 --> 00:24:48,016
conversation, and for everything


705
00:24:48,016 --> 00:24:50,456
else I'm just going to do what


706
00:24:50,456 --> 00:24:52,596
we've always been doing for


707
00:24:52,596 --> 00:24:54,426
compact and expanded.


708
00:24:55,176 --> 00:24:57,666
Cool. So let's see how this


709
00:24:57,666 --> 00:24:59,386
change will look like.


710
00:25:00,086 --> 00:25:01,556
So with this change you should


711
00:25:01,556 --> 00:25:03,076
always see the event detail in


712
00:25:03,076 --> 00:25:03,636
app bubble.


713
00:25:04,226 --> 00:25:07,676
So it's succeeded.


714
00:25:07,976 --> 00:25:13,216
So I'm going back to our device.


715
00:25:13,376 --> 00:25:14,846
Right. Shut up.


716
00:25:21,226 --> 00:25:22,866
Cool. So I see something now,


717
00:25:23,606 --> 00:25:27,306
but it is kind of big and I


718
00:25:27,306 --> 00:25:28,196
don't know where the map view


719
00:25:28,786 --> 00:25:31,376
went but we're getting there.


720
00:25:38,486 --> 00:25:39,936
As you can see there's like an


721
00:25:39,936 --> 00:25:41,936
awkward wide blue space.


722
00:25:42,346 --> 00:25:43,976
It is definitely bigger than I


723
00:25:43,976 --> 00:25:44,566
expected.


724
00:25:44,776 --> 00:25:47,696
So what went wrong is seems like


725
00:25:47,696 --> 00:25:49,706
we didn't implement content size


726
00:25:49,706 --> 00:25:52,516
that fits the last part of this


727
00:25:52,516 --> 00:25:53,766
liveLayout adoption.


728
00:25:54,866 --> 00:25:56,206
So I'm going to go ahead and


729
00:25:57,286 --> 00:25:58,286
implement that real quick.


730
00:26:02,596 --> 00:26:04,836
And then from the demo, from the


731
00:26:04,836 --> 00:26:07,606
slides, you wanted to height to


732
00:26:07,606 --> 00:26:14,666
be about 217, and then for the


733
00:26:14,666 --> 00:26:16,326
title button you want it to by


734
00:26:16,326 --> 00:26:18,346
dynamic and it was fetched from


735
00:26:21,456 --> 00:26:26,216
transcriptView.titleFont and


736
00:26:26,216 --> 00:26:26,996
then lineHeight.


737
00:26:31,956 --> 00:26:33,456
We want our width to be the


738
00:26:33,456 --> 00:26:35,426
maximum width possible which is


739
00:26:35,426 --> 00:26:37,796
the path and size parameter so


740
00:26:37,796 --> 00:26:39,466
we can just return the exact


741
00:26:39,466 --> 00:26:39,886
value.


742
00:26:40,366 --> 00:26:45,866
And then for the height, we can


743
00:26:46,566 --> 00:26:47,636
add these two values.


744
00:26:48,306 --> 00:26:53,286
And this would be a good size to


745
00:26:53,286 --> 00:26:54,346
return two messages.


746
00:26:55,496 --> 00:26:56,376
So let's see how that looks


747
00:26:56,376 --> 00:26:56,566
like.


748
00:27:03,156 --> 00:27:03,396
Okay.


749
00:27:13,556 --> 00:27:14,496
So it's loaded.


750
00:27:14,496 --> 00:27:15,476
Much better.


751
00:27:17,296 --> 00:27:20,286
This is what we saw in the demo.


752
00:27:20,776 --> 00:27:22,816
Nice little size with the events


753
00:27:23,396 --> 00:27:24,756
and the timer ticking.


754
00:27:24,846 --> 00:27:26,426
We only have like an hour and


755
00:27:26,426 --> 00:27:27,616
twenty minutes until bash, so


756
00:27:28,106 --> 00:27:28,646
hang in there.


757
00:27:29,266 --> 00:27:33,276
So I'm going to send this.


758
00:27:33,496 --> 00:27:34,066
There we go.


759
00:27:34,306 --> 00:27:36,666
It's in a transcript live and


760
00:27:36,666 --> 00:27:37,386
the timer's ticking.


761
00:27:38,436 --> 00:27:40,356
So this was a quick demo to how


762
00:27:40,356 --> 00:27:42,696
to adopt Live Message Layout.


763
00:27:43,256 --> 00:27:44,656
So let's talk more about some of


764
00:27:44,656 --> 00:27:45,806
the interactions in


765
00:27:45,806 --> 00:27:46,876
viewControlLifecycle.


766
00:27:47,606 --> 00:27:48,686
I would actually like to bring


767
00:27:48,686 --> 00:27:50,596
Stephen back on stage to talk


768
00:27:50,596 --> 00:27:51,046
more about it.


769
00:27:52,516 --> 00:27:56,500
[ Applause ]


770
00:28:03,216 --> 00:28:04,736
Thank you Jay.


771
00:28:08,476 --> 00:28:09,336
All right.


772
00:28:10,536 --> 00:28:14,786
So, now we've seen a little bit


773
00:28:14,786 --> 00:28:15,976
of an introduction of what it


774
00:28:15,976 --> 00:28:17,686
looks like to use the new API,


775
00:28:17,846 --> 00:28:19,166
to use Live Message Layouts in


776
00:28:19,166 --> 00:28:19,906
your iMessage app.


777
00:28:20,846 --> 00:28:22,266
If you'll think back to the demo


778
00:28:22,266 --> 00:28:23,186
I did at the beginning of the


779
00:28:23,186 --> 00:28:25,106
session, we had some interactive


780
00:28:25,546 --> 00:28:26,926
elements to our iMessage app


781
00:28:27,036 --> 00:28:27,466
bubbles.


782
00:28:28,956 --> 00:28:30,196
And so I'd actually like to


783
00:28:30,196 --> 00:28:32,226
return to Xcode now to do just


784
00:28:32,946 --> 00:28:33,046
that.


785
00:28:34,196 --> 00:28:35,656
So return to my device here.


786
00:28:37,256 --> 00:28:38,436
We're going to go back to Xcode


787
00:28:38,436 --> 00:28:39,286
just where we left off.


788
00:28:39,956 --> 00:28:42,186
And I'm going to get my device


789
00:28:42,186 --> 00:28:45,276
ready for this demo.


790
00:28:45,276 --> 00:28:45,796
Excellent.


791
00:28:46,416 --> 00:28:49,056
Okay. So the first thing we want


792
00:28:49,056 --> 00:28:50,656
to do is here we have this


793
00:28:50,696 --> 00:28:52,576
EventCountdownTranscriptView and


794
00:28:52,576 --> 00:28:53,416
that's the view that gets


795
00:28:53,416 --> 00:28:55,686
imbedded in that app message in


796
00:28:55,686 --> 00:28:57,926
the transcript and so we want to


797
00:28:57,926 --> 00:28:59,126
configure that with some inner


798
00:28:59,126 --> 00:28:59,636
activity.


799
00:28:59,726 --> 00:29:01,986
So I'm going to go ahead and


800
00:29:01,986 --> 00:29:03,086
jump into that class and you'll


801
00:29:03,166 --> 00:29:04,176
see that I have a number of


802
00:29:04,176 --> 00:29:05,586
properties here that are


803
00:29:05,586 --> 00:29:08,046
configured, and here in


804
00:29:08,046 --> 00:29:09,806
setupSubviews I have a tap


805
00:29:09,806 --> 00:29:11,596
adjuster recognizer that's set


806
00:29:11,596 --> 00:29:13,306
up so that when the user taps my


807
00:29:13,306 --> 00:29:15,346
view this method user to tap


808
00:29:15,346 --> 00:29:15,786
gets called.


809
00:29:15,786 --> 00:29:19,286
If I jump to the implementation,


810
00:29:19,786 --> 00:29:21,476
of course the implementation


811
00:29:21,476 --> 00:29:22,526
right now is empty and it's


812
00:29:22,526 --> 00:29:23,726
ready for us to add something.


813
00:29:24,276 --> 00:29:27,496
So the inner activity we'll want


814
00:29:27,496 --> 00:29:29,236
to add first is specifically


815
00:29:29,236 --> 00:29:31,126
when the app message represents


816
00:29:31,156 --> 00:29:32,726
an unaccepted invitation.


817
00:29:33,836 --> 00:29:36,996
So if the event is not for me or


818
00:29:36,996 --> 00:29:38,316
if the app message is not for me


819
00:29:38,316 --> 00:29:40,316
and it's not been accepted then


820
00:29:40,316 --> 00:29:41,436
we want to have that interactive


821
00:29:41,686 --> 00:29:42,306
element to it.


822
00:29:42,306 --> 00:29:44,446
So the first thing we'll do is


823
00:29:44,446 --> 00:29:48,876
say if is not accepted and it's


824
00:29:48,876 --> 00:29:51,196
not from me then we'll change


825
00:29:51,196 --> 00:29:52,656
our view flag to have is


826
00:29:52,656 --> 00:29:54,716
accepted equals true.


827
00:29:55,016 --> 00:29:57,706
And the other thing I want to do


828
00:29:57,706 --> 00:29:58,986
is update the model that I have


829
00:29:58,986 --> 00:29:59,646
here.


830
00:29:59,926 --> 00:30:02,536
Normally I would use correct MVC


831
00:30:02,536 --> 00:30:04,506
and also update maybe my service


832
00:30:04,506 --> 00:30:05,696
to indicate that the event has


833
00:30:05,696 --> 00:30:06,606
been updated, but for the


834
00:30:06,606 --> 00:30:07,746
purposes of this demo I'm just


835
00:30:07,746 --> 00:30:08,446
going to mark this in the


836
00:30:08,446 --> 00:30:08,876
defaults.


837
00:30:12,956 --> 00:30:14,476
Great. So I've updated some


838
00:30:14,476 --> 00:30:16,726
state now I need to update my


839
00:30:16,726 --> 00:30:19,276
view state, so I'll just use a


840
00:30:19,276 --> 00:30:22,336
quick animation block here to


841
00:30:22,566 --> 00:30:25,186
call into my updated view state


842
00:30:25,186 --> 00:30:27,306
and then I'll trigger a layout


843
00:30:27,306 --> 00:30:27,626
pass.


844
00:30:28,516 --> 00:30:30,186
Now this updateViewState, it


845
00:30:30,186 --> 00:30:31,086
just looks at the different


846
00:30:31,086 --> 00:30:32,566
flags and properties on my view


847
00:30:32,566 --> 00:30:33,316
and configures the view


848
00:30:33,316 --> 00:30:33,806
correctly.


849
00:30:34,376 --> 00:30:37,716
So wait for our demo device to


850
00:30:37,716 --> 00:30:39,166
come back up and I'll show you


851
00:30:39,166 --> 00:30:39,786
what that looks like in


852
00:30:39,786 --> 00:30:40,156
practice.


853
00:30:40,806 --> 00:30:44,036
Great. So here we have our


854
00:30:44,036 --> 00:30:45,226
unaccepted invitation being


855
00:30:45,226 --> 00:30:47,556
shown in our demo and it's ready


856
00:30:47,556 --> 00:30:48,976
for us to test out that


857
00:30:48,976 --> 00:30:50,046
interaction that we just added.


858
00:30:50,046 --> 00:30:51,756
So if you see that when I tap


859
00:30:51,756 --> 00:30:53,986
that message that state gets


860
00:30:53,986 --> 00:30:55,216
updated and we see that live


861
00:30:55,216 --> 00:30:56,716
countdown, and you can tell that


862
00:30:56,716 --> 00:30:58,626
I have very little time left so


863
00:30:58,626 --> 00:31:00,466
I better keep going.


864
00:31:00,636 --> 00:31:01,486
Now the one thing that we're


865
00:31:01,486 --> 00:31:03,526
missing here is that nice


866
00:31:03,526 --> 00:31:04,686
infoButton on the top right that


867
00:31:04,686 --> 00:31:06,166
really gave me that rich detail


868
00:31:06,166 --> 00:31:07,256
about the event that I don't


869
00:31:07,256 --> 00:31:08,646
want to necessarily put here in


870
00:31:08,646 --> 00:31:09,416
my app message.


871
00:31:10,806 --> 00:31:12,096
So if I go back to the code here


872
00:31:13,096 --> 00:31:14,396
you'll see that this infoButton


873
00:31:14,666 --> 00:31:15,936
is just waiting to be


874
00:31:15,936 --> 00:31:16,526
implemented.


875
00:31:17,276 --> 00:31:18,356
But before we do that, we need


876
00:31:18,356 --> 00:31:19,376
to add the infoButton to the


877
00:31:19,376 --> 00:31:19,996
view hierarchy.


878
00:31:20,576 --> 00:31:25,956
So here in setupSubViews you can


879
00:31:25,996 --> 00:31:27,466
see that I have this infoButton


880
00:31:27,516 --> 00:31:28,786
that's already been configured,


881
00:31:29,486 --> 00:31:30,396
including with that target


882
00:31:30,396 --> 00:31:32,346
action I just need to add it as


883
00:31:32,346 --> 00:31:37,396
a sub view.


884
00:31:37,576 --> 00:31:38,436
I also want to add some


885
00:31:38,436 --> 00:31:39,936
constraints like it's laid out


886
00:31:40,656 --> 00:31:41,026
properly.


887
00:31:45,316 --> 00:31:47,956
And then we'll go and jump into


888
00:31:47,956 --> 00:31:49,076
the implementation for


889
00:31:49,076 --> 00:31:52,026
infoButtonTapped and call into


890
00:31:52,026 --> 00:31:52,646
our delegate.


891
00:31:53,256 --> 00:31:58,446
Now the delegate of this view is


892
00:31:58,446 --> 00:32:00,036
our app view controller, and the


893
00:32:00,036 --> 00:32:00,946
app view controller is the


894
00:32:00,946 --> 00:32:02,366
object that knows how to change


895
00:32:02,366 --> 00:32:03,756
presentation styles, so I need


896
00:32:03,756 --> 00:32:04,466
to call out to it.


897
00:32:05,176 --> 00:32:06,196
You'll see that this method


898
00:32:06,196 --> 00:32:07,486
hasn't been implemented yet in


899
00:32:07,486 --> 00:32:07,966
my delegate.


900
00:32:07,966 --> 00:32:10,066
So we're going to jump over to


901
00:32:10,066 --> 00:32:11,036
that delegate really quick.


902
00:32:11,036 --> 00:32:14,996
Here is a delegate protocol


903
00:32:14,996 --> 00:32:17,116
declaration where we see that


904
00:32:17,116 --> 00:32:18,136
method hasn't been defined.


905
00:32:18,766 --> 00:32:19,536
So go ahead and add it.


906
00:32:20,026 --> 00:32:22,476
And then we'll jump over to


907
00:32:22,476 --> 00:32:23,346
where this protocol is


908
00:32:23,346 --> 00:32:26,966
implemented and add our new


909
00:32:26,966 --> 00:32:30,736
method that we just added.


910
00:32:30,946 --> 00:32:33,406
Now all we need to do is request


911
00:32:33,406 --> 00:32:35,766
that new presentation style and


912
00:32:35,766 --> 00:32:36,236
that's it.


913
00:32:37,256 --> 00:32:38,466
When I do that, the app view


914
00:32:38,466 --> 00:32:39,746
controller requests that new


915
00:32:39,746 --> 00:32:41,936
presentation style and Messages


916
00:32:41,936 --> 00:32:43,506
will instantiate the new view


917
00:32:43,506 --> 00:32:45,306
controller in that expanded


918
00:32:45,346 --> 00:32:45,986
presentation.


919
00:32:47,376 --> 00:32:49,636
So this is the same thing that


920
00:32:49,636 --> 00:32:50,916
was just implemented here in the


921
00:32:51,276 --> 00:32:51,386
code.


922
00:32:51,566 --> 00:32:52,616
We have the infoButton in the


923
00:32:52,616 --> 00:32:54,646
top right, and when you tap it


924
00:32:54,716 --> 00:32:56,716
we get that nice expanded


925
00:32:56,716 --> 00:32:58,566
presentation with the additional


926
00:32:59,106 --> 00:32:59,326
content.


927
00:33:03,206 --> 00:33:03,626
So that's it.


928
00:33:03,626 --> 00:33:04,806
We have a completed demo that's


929
00:33:04,806 --> 00:33:05,616
showing you -- thank you.


930
00:33:06,516 --> 00:33:10,196
[ Applause ]


931
00:33:10,696 --> 00:33:11,696
So with the completed demo you


932
00:33:11,786 --> 00:33:13,236
see that we can add completely


933
00:33:13,236 --> 00:33:14,956
custom layouts that really add


934
00:33:14,996 --> 00:33:16,416
some richness to that experience


935
00:33:16,416 --> 00:33:17,866
in the transcript, including


936
00:33:17,866 --> 00:33:19,646
inner activity and live updating


937
00:33:19,646 --> 00:33:20,126
content.


938
00:33:24,056 --> 00:33:25,366
So when we think about


939
00:33:25,366 --> 00:33:28,066
interaction with these live


940
00:33:28,066 --> 00:33:29,656
message layouts, we really want


941
00:33:29,656 --> 00:33:30,366
to keep it simple.


942
00:33:30,656 --> 00:33:32,996
Stick to simple button taps and


943
00:33:32,996 --> 00:33:34,966
tap gestures, and let me use the


944
00:33:35,006 --> 00:33:35,546
scroll views.


945
00:33:36,426 --> 00:33:37,616
This app message is being


946
00:33:37,616 --> 00:33:39,136
imbedded in a fairly complicated


947
00:33:39,136 --> 00:33:41,546
UI, the Messages transcript, and


948
00:33:41,546 --> 00:33:42,836
the user's used to interactions


949
00:33:42,836 --> 00:33:44,626
like vertically scrolling the


950
00:33:44,626 --> 00:33:45,706
transcript, horizontally


951
00:33:45,706 --> 00:33:46,786
scrolling the transcript, and


952
00:33:47,176 --> 00:33:48,736
other gestures that take place.


953
00:33:49,386 --> 00:33:50,366
And so if you add too many


954
00:33:50,366 --> 00:33:51,956
complicated things here it can


955
00:33:51,956 --> 00:33:53,236
be disorienting to the user.


956
00:33:54,606 --> 00:33:55,346
The other thing to remember is


957
00:33:55,346 --> 00:33:56,326
that there's no keyboard input


958
00:33:56,326 --> 00:33:57,856
allowed for these app message


959
00:33:57,856 --> 00:33:59,576
views, and so if you want


960
00:33:59,576 --> 00:34:01,066
keyboard input you should


961
00:34:01,066 --> 00:34:02,346
request an expanded presentation


962
00:34:02,346 --> 00:34:04,036
style where your app can use the


963
00:34:04,036 --> 00:34:04,406
keyboard.


964
00:34:04,916 --> 00:34:07,576
Now these views are really light


965
00:34:07,576 --> 00:34:08,396
weight for a reason.


966
00:34:08,396 --> 00:34:09,606
When you think about their


967
00:34:09,606 --> 00:34:11,536
lifecycle, they're only


968
00:34:11,536 --> 00:34:13,096
instantiated when the user comes


969
00:34:13,096 --> 00:34:14,505
into the conversation to look at


970
00:34:15,186 --> 00:34:15,295
it.


971
00:34:15,295 --> 00:34:16,235
As soon as the user leaves the


972
00:34:16,235 --> 00:34:17,686
conversation or leaves the app,


973
00:34:18,396 --> 00:34:20,045
your iMessage app will be torn


974
00:34:20,045 --> 00:34:20,376
down.


975
00:34:20,656 --> 00:34:21,656
So it's not an appropriate place


976
00:34:21,656 --> 00:34:22,946
to put something like a 3D game


977
00:34:22,946 --> 00:34:23,235
engine.


978
00:34:23,815 --> 00:34:27,856
If you do want to do that, you


979
00:34:27,856 --> 00:34:29,226
should request that expanded


980
00:34:29,226 --> 00:34:30,956
presentation style for the user


981
00:34:30,956 --> 00:34:32,616
to take part in your extended


982
00:34:32,616 --> 00:34:33,146
interaction.


983
00:34:33,696 --> 00:34:36,585
Now I want to cover this again


984
00:34:36,585 --> 00:34:37,176
because I think this is


985
00:34:37,176 --> 00:34:38,306
important.


986
00:34:38,956 --> 00:34:40,616
When requesting the expanded


987
00:34:40,616 --> 00:34:41,786
presentation style, your


988
00:34:41,786 --> 00:34:43,196
transcript app view controller


989
00:34:43,196 --> 00:34:44,626
is not reconfigured with new


990
00:34:44,626 --> 00:34:46,286
presentation style -- it's left


991
00:34:46,286 --> 00:34:47,426
in place in the transcript.


992
00:34:48,636 --> 00:34:50,906
If no view controller exist in


993
00:34:50,906 --> 00:34:52,126
the compact or expanded


994
00:34:52,126 --> 00:34:54,016
presentation style, Messages


995
00:34:54,016 --> 00:34:55,335
will instantiate a new object,


996
00:34:55,656 --> 00:34:56,835
configure it accordingly, and


997
00:34:57,136 --> 00:34:58,426
then add it and show it here.


998
00:34:59,286 --> 00:35:01,176
If one does exist then it will


999
00:35:01,176 --> 00:35:02,276
reconfigure it to the new


1000
00:35:02,276 --> 00:35:03,236
presentation style.


1001
00:35:03,996 --> 00:35:05,186
And this is specifically if it


1002
00:35:05,186 --> 00:35:06,576
already has one that is compact


1003
00:35:06,576 --> 00:35:07,166
or expanded.


1004
00:35:07,166 --> 00:35:09,526
It will then change the selected


1005
00:35:09,526 --> 00:35:11,006
message on that view controller


1006
00:35:11,256 --> 00:35:12,226
and you will get the didn't


1007
00:35:12,226 --> 00:35:13,886
select message callback on that


1008
00:35:13,886 --> 00:35:14,456
view controller.


1009
00:35:14,996 --> 00:35:17,016
Now the transcript app view


1010
00:35:17,016 --> 00:35:18,016
controller that's left in place


1011
00:35:18,016 --> 00:35:20,156
as is or the static selected


1012
00:35:20,156 --> 00:35:21,466
message because it always


1013
00:35:21,466 --> 00:35:23,006
represents that message in the


1014
00:35:23,006 --> 00:35:23,516
transcript.


1015
00:35:23,936 --> 00:35:29,016
Now when we talk about lifecycle


1016
00:35:29,016 --> 00:35:31,976
a little more of your iMessage


1017
00:35:31,976 --> 00:35:34,166
app, in iOS 10 these methods on


1018
00:35:34,226 --> 00:35:35,546
MSMessagesAppViewController


1019
00:35:35,546 --> 00:35:38,596
applied specifically to your


1020
00:35:38,596 --> 00:35:40,426
extension lifecycle because


1021
00:35:40,426 --> 00:35:41,936
there was only one instance of


1022
00:35:41,936 --> 00:35:43,136
the view controller created and


1023
00:35:43,276 --> 00:35:45,016
it was closely coupled with the


1024
00:35:45,016 --> 00:35:46,306
lifecycle of your iMessage app,


1025
00:35:46,306 --> 00:35:47,396
so you could rely on it for


1026
00:35:47,396 --> 00:35:48,526
extension lifecycle


1027
00:35:48,926 --> 00:35:49,816
notification.


1028
00:35:51,046 --> 00:35:52,846
However, in iOS 11, we can


1029
00:35:52,846 --> 00:35:55,006
instantiate many instances of


1030
00:35:55,006 --> 00:35:55,906
your principle class.


1031
00:35:56,676 --> 00:35:58,336
So these methods really pertain


1032
00:35:58,336 --> 00:35:59,886
more to the view controller


1033
00:35:59,886 --> 00:36:01,116
lifecycle and you need to think


1034
00:36:01,116 --> 00:36:02,136
of it from that perspective.


1035
00:36:03,536 --> 00:36:04,816
If you do need to pay attention


1036
00:36:04,816 --> 00:36:07,046
to extension lifecycle events of


1037
00:36:07,046 --> 00:36:08,416
your iMessage app, you should


1038
00:36:08,416 --> 00:36:10,786
observe the NS extension related


1039
00:36:10,786 --> 00:36:11,476
notifications.


1040
00:36:14,866 --> 00:36:16,586
Now in a particular instance of


1041
00:36:16,586 --> 00:36:17,616
your transcript app view


1042
00:36:17,616 --> 00:36:19,636
controller is created, the


1043
00:36:19,636 --> 00:36:21,026
lifecycle methods proceed like


1044
00:36:21,026 --> 00:36:21,226
this.


1045
00:36:22,106 --> 00:36:23,266
First, we'll initialize the view


1046
00:36:23,266 --> 00:36:25,346
controller and call viewDidLoad.


1047
00:36:25,346 --> 00:36:29,166
Then we'll call willBecomeActive


1048
00:36:29,166 --> 00:36:30,046
and didBecomeActive with


1049
00:36:30,046 --> 00:36:31,446
conversation as part of the


1050
00:36:31,446 --> 00:36:32,866
Messages API contract.


1051
00:36:33,366 --> 00:36:35,886
Then the view appearance methods


1052
00:36:35,886 --> 00:36:37,886
will be called as your view


1053
00:36:37,886 --> 00:36:38,936
controller is inserted into the


1054
00:36:38,936 --> 00:36:42,036
view hierarchy for display.


1055
00:36:42,166 --> 00:36:43,816
Lastly, contentSizeThatFits will


1056
00:36:43,816 --> 00:36:44,286
be called.


1057
00:36:44,906 --> 00:36:47,716
Now when willBecomeActive and


1058
00:36:47,716 --> 00:36:48,516
didBecomeActive with


1059
00:36:48,516 --> 00:36:49,986
conversation are called, you


1060
00:36:49,986 --> 00:36:51,246
have all the information you


1061
00:36:51,246 --> 00:36:52,516
need to correctly configure your


1062
00:36:52,516 --> 00:36:53,936
view controller by looking at


1063
00:36:53,936 --> 00:36:55,276
that presentation style and


1064
00:36:55,326 --> 00:36:56,296
selected message on the view


1065
00:36:56,296 --> 00:36:56,616
controller.


1066
00:36:59,156 --> 00:37:00,096
Now when thinking about


1067
00:37:00,096 --> 00:37:01,326
contentSizeThatFits getting


1068
00:37:01,326 --> 00:37:03,656
called last, this is because it


1069
00:37:03,656 --> 00:37:05,066
may be called multiple times.


1070
00:37:05,816 --> 00:37:06,686
Think about the Messages


1071
00:37:06,686 --> 00:37:08,416
application on an iPad in split


1072
00:37:08,416 --> 00:37:08,826
view mode.


1073
00:37:08,826 --> 00:37:11,616
As the user changes the size of


1074
00:37:11,616 --> 00:37:13,626
the Messages app, the metrics of


1075
00:37:13,626 --> 00:37:15,076
the Messages application, and


1076
00:37:15,076 --> 00:37:16,006
therefore the transcript,


1077
00:37:16,006 --> 00:37:16,506
change.


1078
00:37:17,406 --> 00:37:18,486
We'll then call into your


1079
00:37:18,486 --> 00:37:20,306
contentSizeThatFits method with


1080
00:37:20,306 --> 00:37:22,566
an updated size or maximum size,


1081
00:37:23,486 --> 00:37:25,286
and you should update your app


1082
00:37:25,336 --> 00:37:26,086
size accordingly.


1083
00:37:29,136 --> 00:37:29,986
It can also be, of course,


1084
00:37:29,986 --> 00:37:31,566
updated for dynamic text size


1085
00:37:31,566 --> 00:37:32,646
changes and locale changes.


1086
00:37:32,726 --> 00:37:36,976
The last thing I want to cover


1087
00:37:36,976 --> 00:37:37,896
is pending messages.


1088
00:37:38,596 --> 00:37:41,406
Now remember, your view


1089
00:37:41,406 --> 00:37:42,766
controller can be configured to


1090
00:37:42,766 --> 00:37:44,546
represent app messages in a


1091
00:37:44,546 --> 00:37:46,136
transcript presentation style


1092
00:37:46,656 --> 00:37:48,306
both for an unsent message and


1093
00:37:48,306 --> 00:37:50,106
the message that has been sent


1094
00:37:50,106 --> 00:37:50,716
in the transcript.


1095
00:37:50,716 --> 00:37:54,486
Now most of the time you should


1096
00:37:54,486 --> 00:37:56,186
keep the same application view


1097
00:37:56,186 --> 00:37:57,906
in both states because the user


1098
00:37:57,906 --> 00:37:59,206
is really previewing the content


1099
00:37:59,206 --> 00:38:00,096
that's going to be sent here.


1100
00:38:00,496 --> 00:38:01,206
But if you do need to


1101
00:38:01,206 --> 00:38:02,596
differentiate between the two,


1102
00:38:03,936 --> 00:38:05,636
you can check the isPending flag


1103
00:38:05,846 --> 00:38:06,826
which is a new property on


1104
00:38:06,966 --> 00:38:09,156
MSMessage that will let you know


1105
00:38:09,156 --> 00:38:10,336
the difference between these two


1106
00:38:11,076 --> 00:38:11,226
states.


1107
00:38:13,336 --> 00:38:14,796
So that's all we have for you


1108
00:38:14,796 --> 00:38:16,336
today to introduce Live Message


1109
00:38:16,336 --> 00:38:16,706
Layouts.


1110
00:38:18,156 --> 00:38:19,276
Remember, this is interactive


1111
00:38:19,356 --> 00:38:20,956
iMessage apps in the transcript,


1112
00:38:20,956 --> 00:38:22,306
which I think is incredibly cool


1113
00:38:22,306 --> 00:38:23,086
and I can't wait to see what you


1114
00:38:23,086 --> 00:38:23,546
build with it.


1115
00:38:24,226 --> 00:38:25,896
We're using the same MSMessage


1116
00:38:25,896 --> 00:38:27,066
app view controller sub class,


1117
00:38:28,346 --> 00:38:29,656
and the new layout, the


1118
00:38:29,656 --> 00:38:31,466
MSMessagesLiveLayout with a new


1119
00:38:31,466 --> 00:38:35,076
presentation style for you to


1120
00:38:35,076 --> 00:38:36,466
use as a tool to build these


1121
00:38:36,466 --> 00:38:37,476
rich new experiences.


1122
00:38:38,826 --> 00:38:39,916
I'm really looking forward to


1123
00:38:39,916 --> 00:38:41,296
what you build with this and I


1124
00:38:41,296 --> 00:38:42,026
think you're going to come up


1125
00:38:42,026 --> 00:38:42,836
with things that we haven't even


1126
00:38:42,836 --> 00:38:43,286
thought of yet.


1127
00:38:43,836 --> 00:38:44,986
And with that, I'd like to bring


1128
00:38:44,986 --> 00:38:46,726
up Eugene to introduce some best


1129
00:38:46,726 --> 00:38:47,776
practices when using the


1130
00:38:47,776 --> 00:38:48,846
Messages framework.


1131
00:38:49,516 --> 00:38:53,500
[ Applause ]


1132
00:39:02,126 --> 00:39:02,926
>> All right.


1133
00:39:03,016 --> 00:39:04,166
Thank you, Stephen.


1134
00:39:04,466 --> 00:39:06,226
Live Message Layouts, super


1135
00:39:06,226 --> 00:39:06,656
exciting.


1136
00:39:07,676 --> 00:39:08,856
So we want to wrap up our talk


1137
00:39:08,856 --> 00:39:11,156
today with just a couple best


1138
00:39:11,156 --> 00:39:12,966
practices tips and tricks for


1139
00:39:12,966 --> 00:39:14,616
your iMessage apps just to give


1140
00:39:14,616 --> 00:39:15,686
your apps that little extra


1141
00:39:15,686 --> 00:39:17,166
shine and polish that we think


1142
00:39:17,166 --> 00:39:18,026
will make them look really


1143
00:39:18,026 --> 00:39:18,346
great.


1144
00:39:18,446 --> 00:39:19,826
So, we have a couple of tips for


1145
00:39:19,826 --> 00:39:20,616
you guys today.


1146
00:39:21,366 --> 00:39:23,046
Let's get into it.


1147
00:39:23,456 --> 00:39:24,276
So the first thing we'd like to


1148
00:39:24,276 --> 00:39:26,376
talk about is the iMessage app


1149
00:39:26,376 --> 00:39:27,416
area insets.


1150
00:39:27,416 --> 00:39:29,086
So this is the area at the


1151
00:39:29,086 --> 00:39:32,126
bottom of the screen underneath


1152
00:39:32,216 --> 00:39:35,856
the app strip as well as at the


1153
00:39:35,856 --> 00:39:37,786
bottom of the screen in expanded


1154
00:39:37,786 --> 00:39:38,116
mode.


1155
00:39:38,496 --> 00:39:40,936
So similar to like navigation


1156
00:39:40,936 --> 00:39:43,476
controllers, Messages UI can


1157
00:39:43,546 --> 00:39:45,776
include the area displayed by


1158
00:39:45,776 --> 00:39:47,106
your application so you can have


1159
00:39:47,106 --> 00:39:48,876
that nice blurred effect when


1160
00:39:48,876 --> 00:39:50,406
scrolling scroll views.


1161
00:39:50,436 --> 00:39:52,986
So to determine your app area


1162
00:39:52,986 --> 00:39:54,906
insets, you can look at the


1163
00:39:54,906 --> 00:39:56,436
UIViewController top and bottom


1164
00:39:56,436 --> 00:39:58,866
layout guides, or new in iOS 11


1165
00:39:59,266 --> 00:40:02,036
check out UIViewsafeAreaInsets.


1166
00:40:02,156 --> 00:40:04,096
These will define all the areas


1167
00:40:04,096 --> 00:40:05,676
of your application's view that


1168
00:40:05,676 --> 00:40:07,076
are un occluded by Messages UI.


1169
00:40:07,886 --> 00:40:09,116
Of course, you can always use


1170
00:40:09,116 --> 00:40:11,696
Autolayout to add constraints to


1171
00:40:11,696 --> 00:40:12,876
the UIViewController's top and


1172
00:40:12,876 --> 00:40:13,746
bottom layout guides.


1173
00:40:14,596 --> 00:40:16,906
So for applications linked on


1174
00:40:17,126 --> 00:40:19,266
iOS 10, we will continue to use


1175
00:40:19,266 --> 00:40:20,246
old legacy insets.


1176
00:40:20,406 --> 00:40:22,106
But a great way to keep up with


1177
00:40:22,106 --> 00:40:23,766
the change in UI Messages and


1178
00:40:23,766 --> 00:40:25,356
have your application adapt


1179
00:40:25,356 --> 00:40:27,146
appropriately is to properly


1180
00:40:27,146 --> 00:40:28,366
adopt either the


1181
00:40:28,366 --> 00:40:30,496
UIViewsafeAreaInsets or


1182
00:40:30,496 --> 00:40:32,706
UIViewController top and bottom


1183
00:40:32,706 --> 00:40:33,486
layout guides.


1184
00:40:34,086 --> 00:40:37,756
Next up we have message summary


1185
00:40:37,756 --> 00:40:38,316
text.


1186
00:40:38,516 --> 00:40:41,086
So iOS 10 introduced MSMessage


1187
00:40:41,256 --> 00:40:42,466
and a property on it called


1188
00:40:42,466 --> 00:40:43,156
summaryText.


1189
00:40:43,856 --> 00:40:45,956
In iOS 10, summaryText was used


1190
00:40:45,956 --> 00:40:49,166
for Messages with an MS Session


1191
00:40:49,166 --> 00:40:50,076
attached to it, so kind of


1192
00:40:50,076 --> 00:40:51,866
session based messaging and we'd


1193
00:40:51,866 --> 00:40:54,286
insert a very small succinct


1194
00:40:54,286 --> 00:40:56,226
summary inline the transcript of


1195
00:40:56,226 --> 00:40:56,686
that message.


1196
00:40:56,686 --> 00:40:59,636
In iOS 11, we are expanding the


1197
00:40:59,636 --> 00:41:01,366
use of the summaryText property


1198
00:41:01,626 --> 00:41:03,466
to all MSMessages sent.


1199
00:41:03,846 --> 00:41:04,876
So where do you see the


1200
00:41:04,876 --> 00:41:05,636
summaryText?


1201
00:41:07,166 --> 00:41:08,926
MSMessage summaryText will now


1202
00:41:08,926 --> 00:41:10,606
be used in the conversation list


1203
00:41:10,606 --> 00:41:12,446
preview as well as places like


1204
00:41:12,626 --> 00:41:14,156
notification center so you can


1205
00:41:14,156 --> 00:41:15,726
give context to your


1206
00:41:15,726 --> 00:41:16,996
application's message


1207
00:41:16,996 --> 00:41:17,746
notifications.


1208
00:41:17,956 --> 00:41:19,186
So this is a really great way


1209
00:41:19,336 --> 00:41:20,926
for users at a quick glance to


1210
00:41:20,926 --> 00:41:22,556
see the content that you send in


1211
00:41:22,556 --> 00:41:23,306
your app message.


1212
00:41:23,786 --> 00:41:26,416
So iOS 11 summaryText and every


1213
00:41:26,446 --> 00:41:27,846
single one here, MSMessages.


1214
00:41:28,386 --> 00:41:32,876
Next up we have stickers.


1215
00:41:32,876 --> 00:41:34,016
So the introduction of sticker


1216
00:41:34,016 --> 00:41:36,346
packs in iOS 10 we're seeing


1217
00:41:36,466 --> 00:41:37,426
tons of them released.


1218
00:41:37,426 --> 00:41:38,656
I absolutely love them, download


1219
00:41:38,656 --> 00:41:39,466
new ones every week.


1220
00:41:39,876 --> 00:41:41,496
Keep up the awesome work on the


1221
00:41:41,496 --> 00:41:42,106
sticker packs.


1222
00:41:42,106 --> 00:41:42,486
We love it.


1223
00:41:43,556 --> 00:41:44,876
We do want to give a couple tips


1224
00:41:44,956 --> 00:41:46,516
about making your sticker packs


1225
00:41:46,626 --> 00:41:48,446
faster and send quicker.


1226
00:41:49,056 --> 00:41:50,996
Overall, sticker pack


1227
00:41:50,996 --> 00:41:52,176
performance is a function of


1228
00:41:52,176 --> 00:41:53,336
your sticker's file size.


1229
00:41:53,846 --> 00:41:55,326
This function of the sticker's


1230
00:41:55,326 --> 00:41:57,486
file size is a function of your


1231
00:41:57,486 --> 00:41:59,366
sticker's pixel size as well as


1232
00:41:59,366 --> 00:42:00,106
its frame rate.


1233
00:42:00,616 --> 00:42:01,716
A really great resource for you


1234
00:42:01,716 --> 00:42:03,436
to look at is the Messages Human


1235
00:42:03,436 --> 00:42:04,696
Interface Guidelines which is


1236
00:42:04,696 --> 00:42:05,606
available in the developer


1237
00:42:05,606 --> 00:42:07,346
portal which will tell you the


1238
00:42:07,346 --> 00:42:08,926
target sticker sizes for either


1239
00:42:08,926 --> 00:42:11,246
the small, medium or large


1240
00:42:11,246 --> 00:42:12,506
stickers that we support.


1241
00:42:13,226 --> 00:42:15,156
In addition, consider the frame


1242
00:42:15,156 --> 00:42:15,956
rate of your sticker.


1243
00:42:16,566 --> 00:42:18,616
Stickers with higher frame rates


1244
00:42:18,766 --> 00:42:20,726
or longer loop times have a


1245
00:42:20,726 --> 00:42:22,556
higher memory overhead and will


1246
00:42:22,556 --> 00:42:23,566
negatively impact the


1247
00:42:23,566 --> 00:42:24,636
performance of your sticker


1248
00:42:24,636 --> 00:42:26,016
application as well as


1249
00:42:26,016 --> 00:42:27,916
negatively impact send times.


1250
00:42:28,426 --> 00:42:30,106
So for quick fast sending


1251
00:42:30,106 --> 00:42:31,506
stickers and quick launching


1252
00:42:31,506 --> 00:42:33,056
sticker apps, make sure your


1253
00:42:33,056 --> 00:42:35,476
stickers are sized correctly and


1254
00:42:35,606 --> 00:42:37,346
either use short loops or lower


1255
00:42:37,416 --> 00:42:37,866
frame rates.


1256
00:42:38,426 --> 00:42:40,066
So looking forward to seeing all


1257
00:42:40,066 --> 00:42:40,966
the new sticker packs you guys


1258
00:42:40,966 --> 00:42:45,626
make in iOS 11 as well.


1259
00:42:45,736 --> 00:42:47,956
And last up on our list is


1260
00:42:47,996 --> 00:42:49,926
MFMessageComposeViewController.


1261
00:42:50,286 --> 00:42:52,116
MSMessageComposeViewController


1262
00:42:52,436 --> 00:42:54,216
is the Messages share sheet that


1263
00:42:54,216 --> 00:42:55,646
can be invoked from your parent


1264
00:42:55,646 --> 00:42:56,376
application.


1265
00:42:57,426 --> 00:42:58,906
So in iOS 10 we introduced a new


1266
00:42:58,906 --> 00:43:00,256
property on the share sheet


1267
00:43:00,546 --> 00:43:01,956
called Message, which


1268
00:43:02,146 --> 00:43:04,036
predictably takes an MSMessage


1269
00:43:04,086 --> 00:43:04,636
instance.


1270
00:43:05,366 --> 00:43:06,806
So if you already have an


1271
00:43:06,986 --> 00:43:09,036
iMessage app, your parent


1272
00:43:09,036 --> 00:43:10,746
companion app can actually send


1273
00:43:10,746 --> 00:43:12,486
the same application balloons


1274
00:43:12,816 --> 00:43:14,206
either a template layout or a


1275
00:43:14,206 --> 00:43:16,126
live Layout that you can send in


1276
00:43:16,126 --> 00:43:17,246
the Messages app itself.


1277
00:43:17,246 --> 00:43:18,376
So you get a very nice


1278
00:43:18,376 --> 00:43:19,916
consistent sharing experience


1279
00:43:20,326 --> 00:43:21,756
between your parent application


1280
00:43:21,946 --> 00:43:22,996
and your iMessage app.


1281
00:43:24,856 --> 00:43:26,676
App balloons that are received,


1282
00:43:26,996 --> 00:43:28,646
can either then be opened within


1283
00:43:28,646 --> 00:43:30,766
your iMessage app or can bounce


1284
00:43:30,806 --> 00:43:32,146
the user out to their parent


1285
00:43:32,146 --> 00:43:34,666
application via the open URL


1286
00:43:34,666 --> 00:43:35,126
command.


1287
00:43:35,406 --> 00:43:37,496
So definitely take a look at


1288
00:43:37,496 --> 00:43:39,096
Message property on


1289
00:43:39,346 --> 00:43:41,106
MFMessageComposeViewController.


1290
00:43:41,696 --> 00:43:44,286
And with that we've wrapped up


1291
00:43:44,286 --> 00:43:44,736
our tips!


1292
00:43:44,736 --> 00:43:46,036
Just a couple things for


1293
00:43:46,036 --> 00:43:46,936
everyone to keep in mind.


1294
00:43:47,846 --> 00:43:48,916
Look at your layout margins.


1295
00:43:49,466 --> 00:43:50,906
Set summaryText on all


1296
00:43:50,906 --> 00:43:52,356
MSMessages in iOS 11.


1297
00:43:53,016 --> 00:43:55,116
Consider sticker sizes and frame


1298
00:43:55,116 --> 00:43:56,666
rate for faster sticker packs.


1299
00:43:56,666 --> 00:43:57,716
And also keep on making awesome


1300
00:43:57,716 --> 00:43:58,226
stickers.


1301
00:43:58,996 --> 00:44:01,556
And finally, you can now send


1302
00:44:01,806 --> 00:44:03,246
app balloons from


1303
00:44:03,246 --> 00:44:04,756
MFMessageComposeViewController.


1304
00:44:04,756 --> 00:44:06,186
So certainly check that out for


1305
00:44:06,186 --> 00:44:07,646
consistent user experience.


1306
00:44:07,736 --> 00:44:11,286
So what did we learn today?


1307
00:44:11,646 --> 00:44:13,076
We went over a couple new things


1308
00:44:13,076 --> 00:44:14,206
with MSMessages app UI.


1309
00:44:15,016 --> 00:44:16,966
We saw the direct send API for


1310
00:44:16,966 --> 00:44:17,866
an awesome new setting


1311
00:44:17,866 --> 00:44:18,936
experience in your iMessage


1312
00:44:20,176 --> 00:44:20,546
apps.


1313
00:44:20,546 --> 00:44:22,216
Stephen and Jay led you through


1314
00:44:22,456 --> 00:44:23,516
Live Message Layouts.


1315
00:44:23,516 --> 00:44:25,126
I cannot wait to see what all of


1316
00:44:25,126 --> 00:44:25,786
you build with that.


1317
00:44:26,566 --> 00:44:28,446
And finally, a couple best


1318
00:44:28,486 --> 00:44:32,126
practices tips and tricks.


1319
00:44:32,256 --> 00:44:33,326
If you'd like more information


1320
00:44:33,706 --> 00:44:36,106
check out our session webpage


1321
00:44:36,106 --> 00:44:36,896
right here.


1322
00:44:38,236 --> 00:44:39,526
In addition, we also have a


1323
00:44:39,526 --> 00:44:40,556
couple related sessions


1324
00:44:40,556 --> 00:44:41,316
happening tomorrow.


1325
00:44:41,596 --> 00:44:44,426
We have, at 10:00 a.m. in this


1326
00:44:44,426 --> 00:44:46,136
hall, Introducing Business Chat,


1327
00:44:46,136 --> 00:44:47,116
which I know all of you are


1328
00:44:47,286 --> 00:44:48,666
probably really excited to hear


1329
00:44:49,236 --> 00:44:49,626
about.


1330
00:44:49,626 --> 00:44:50,936
In addition, we are very lucky


1331
00:44:50,936 --> 00:44:52,076
this year to have one of our


1332
00:44:52,076 --> 00:44:53,756
Messages HI designers who will


1333
00:44:53,756 --> 00:44:56,016
be doing a design short tomorrow


1334
00:44:56,016 --> 00:44:57,876
at 11:00 a.m. in the Executive


1335
00:44:57,876 --> 00:44:58,256
Ballroom.


1336
00:44:58,996 --> 00:45:00,076
Thank you for being here tonight


1337
00:45:00,346 --> 00:45:01,626
and enjoy the bash!


1338
00:45:02,156 --> 00:45:02,436
Thank you!


1339
00:45:03,016 --> 00:45:05,000
[ Applause ]

