1
00:00:17,556 --> 00:00:19,866
>> Hello, I'm Tanya Kancheva and


2
00:00:19,866 --> 00:00:21,456
I'm here to talk about wireless


3
00:00:21,456 --> 00:00:21,916
CarPlay.


4
00:00:23,656 --> 00:00:25,526
wireless CarPlay is perfect for


5
00:00:25,526 --> 00:00:27,776
any trip, you can get in your


6
00:00:27,776 --> 00:00:29,726
car without taking your iPhone


7
00:00:29,776 --> 00:00:32,165
out of your bag or pocket and


8
00:00:32,165 --> 00:00:33,896
start experiencing CarPlay


9
00:00:33,896 --> 00:00:34,636
effortlessly.


10
00:00:36,126 --> 00:00:37,486
The CarPlay experience is the


11
00:00:37,596 --> 00:00:39,586
same whether you are plugged in


12
00:00:39,786 --> 00:00:41,336
or using it wirelessly.


13
00:00:42,856 --> 00:00:44,746
In this session, we will dive


14
00:00:44,746 --> 00:00:47,076
into the details on developing a


15
00:00:47,076 --> 00:00:48,466
wireless CarPlay system.


16
00:00:50,716 --> 00:00:52,596
First, let's start by talking


17
00:00:52,646 --> 00:00:54,436
about the wireless CarPlay


18
00:00:54,436 --> 00:00:55,206
experience.


19
00:00:57,506 --> 00:00:59,116
The first time you use wireless


20
00:00:59,116 --> 00:01:01,076
CarPlay you need to pair your


21
00:01:01,336 --> 00:01:02,766
iPhone to your car.


22
00:01:04,025 --> 00:01:05,976
The simplest way to pair is by


23
00:01:06,016 --> 00:01:07,726
plugging in iPhone using a


24
00:01:07,726 --> 00:01:08,126
cable.


25
00:01:09,586 --> 00:01:10,996
You can also pair without


26
00:01:10,996 --> 00:01:12,736
plugging in by using the car's


27
00:01:12,736 --> 00:01:15,316
UI to add a new device and by


28
00:01:15,316 --> 00:01:16,476
following the onscreen


29
00:01:16,476 --> 00:01:17,096
instructions.


30
00:01:19,426 --> 00:01:21,526
Plugging in iPhone using a cable


31
00:01:21,646 --> 00:01:23,986
is the easiest and fastest way


32
00:01:24,026 --> 00:01:26,336
to pair for wireless CarPlay and


33
00:01:26,376 --> 00:01:28,106
all wireless CarPlay systems


34
00:01:28,426 --> 00:01:29,606
should support this feature.


35
00:01:30,646 --> 00:01:32,006
When iPhone is plugged in


36
00:01:32,286 --> 00:01:33,496
CarPlay starts normally.


37
00:01:35,496 --> 00:01:37,136
If the car supports wireless


38
00:01:37,136 --> 00:01:38,996
CarPlay the user will be


39
00:01:38,996 --> 00:01:40,866
presented with the following


40
00:01:40,866 --> 00:01:41,926
prompt on iPhone.


41
00:01:44,186 --> 00:01:46,926
A simple tap on enable wireless


42
00:01:46,926 --> 00:01:48,606
CarPlay completes the pairing


43
00:01:48,606 --> 00:01:49,186
process.


44
00:01:49,956 --> 00:01:51,886
Be sure to provide a meaningful


45
00:01:51,886 --> 00:01:54,366
display name as in this example,


46
00:01:54,646 --> 00:01:57,116
my car, so it's clear that


47
00:01:57,116 --> 00:01:58,826
iPhone will be associated with


48
00:01:58,826 --> 00:01:59,176
the car.


49
00:02:02,316 --> 00:02:04,826
Once pairing is complete CarPlay


50
00:02:04,826 --> 00:02:06,546
starts automatically the next


51
00:02:06,546 --> 00:02:07,726
time you enter the car.


52
00:02:09,485 --> 00:02:11,496
It's not necessary to require


53
00:02:11,496 --> 00:02:13,186
additional confirmation on the


54
00:02:13,186 --> 00:02:15,956
car's display because CarPlay is


55
00:02:15,956 --> 00:02:18,226
already running and the user has


56
00:02:18,226 --> 00:02:20,326
already chosen to use wireless


57
00:02:20,326 --> 00:02:21,546
CarPlay on iPhone.


58
00:02:22,496 --> 00:02:24,686
As you can see, pairing by


59
00:02:24,746 --> 00:02:27,156
plugging in is simple and


60
00:02:27,156 --> 00:02:27,626
effortless.


61
00:02:30,476 --> 00:02:32,436
The user can also pair without


62
00:02:32,436 --> 00:02:34,066
plugging in and by using the


63
00:02:34,066 --> 00:02:36,776
car's UI to add a new device and


64
00:02:36,776 --> 00:02:38,186
by following the onscreen


65
00:02:38,286 --> 00:02:39,616
instructions.


66
00:02:40,506 --> 00:02:42,426
To begin, the pairing process


67
00:02:42,426 --> 00:02:43,986
needs to be started on both the


68
00:02:43,986 --> 00:02:45,506
car and on iPhone.


69
00:02:48,246 --> 00:02:50,596
To make it easier CarPlay


70
00:02:50,596 --> 00:02:53,046
standardizes a long press on the


71
00:02:53,046 --> 00:02:55,196
Voice Control button to start


72
00:02:55,196 --> 00:02:56,116
the pairing process.


73
00:02:57,156 --> 00:02:58,696
Normally this will start Siri,


74
00:02:59,086 --> 00:03:01,096
but if no phone is connected the


75
00:03:01,126 --> 00:03:02,586
car should immediately prepare


76
00:03:02,586 --> 00:03:03,156
for pairing.


77
00:03:04,846 --> 00:03:06,776
You can also use menus and


78
00:03:06,776 --> 00:03:08,656
settings in the car's native UI


79
00:03:08,656 --> 00:03:10,106
to start the pairing process.


80
00:03:11,096 --> 00:03:12,736
You may offer a CarPlay specific


81
00:03:12,736 --> 00:03:14,936
menu, a general Bluetooth menu


82
00:03:15,066 --> 00:03:15,556
or both.


83
00:03:18,546 --> 00:03:20,356
In CarPlay settings on iPhone


84
00:03:20,856 --> 00:03:22,646
users are encouraged to press


85
00:03:22,646 --> 00:03:23,866
and hold the Voice Control


86
00:03:23,866 --> 00:03:25,846
button on the steering wheel to


87
00:03:25,846 --> 00:03:27,206
start the pairing process.


88
00:03:29,546 --> 00:03:32,066
Once CarPlay setup is started on


89
00:03:32,066 --> 00:03:34,576
the car and iPhone select the


90
00:03:34,576 --> 00:03:36,146
discovered device to start the


91
00:03:36,146 --> 00:03:36,866
pairing process.


92
00:03:39,376 --> 00:03:41,416
Apple recommends that you allow


93
00:03:41,416 --> 00:03:43,336
the user to select the car from


94
00:03:43,386 --> 00:03:43,776
iPhone.


95
00:03:44,696 --> 00:03:47,356
In your native UI simply show


96
00:03:47,356 --> 00:03:49,566
your car's display name so the


97
00:03:49,566 --> 00:03:50,996
user knows what to look for.


98
00:03:54,036 --> 00:03:55,796
If you do allow the user to


99
00:03:55,796 --> 00:03:57,456
initiate selection from the car


100
00:03:58,236 --> 00:03:59,426
you can show a list of


101
00:03:59,426 --> 00:04:00,426
discovered devices.


102
00:04:02,016 --> 00:04:03,616
You can show a less specific to


103
00:04:03,616 --> 00:04:07,186
adding a CarPlay device or you


104
00:04:07,186 --> 00:04:08,566
can show a list of all


105
00:04:08,566 --> 00:04:10,026
discovered Bluetooth devices,


106
00:04:10,236 --> 00:04:11,726
including CarPlay devices.


107
00:04:14,536 --> 00:04:16,286
If the user selects a device


108
00:04:16,505 --> 00:04:18,546
using a general Bluetooth menu


109
00:04:19,026 --> 00:04:20,286
and that device supports


110
00:04:20,286 --> 00:04:22,626
wireless CarPlay, you may decide


111
00:04:22,626 --> 00:04:24,166
to offer to enable CarPlay.


112
00:04:25,116 --> 00:04:26,776
Do not show this screen if the


113
00:04:26,776 --> 00:04:28,976
user selected the device from a


114
00:04:28,976 --> 00:04:30,256
CarPlay specific menu.


115
00:04:32,856 --> 00:04:35,276
Then CarPlay connects and


116
00:04:35,516 --> 00:04:36,766
CarPlay appears on the screen.


117
00:04:37,486 --> 00:04:39,126
From here on the CarPlay


118
00:04:39,126 --> 00:04:40,696
experience is the same as


119
00:04:41,026 --> 00:04:42,886
plugging in until you leave the


120
00:04:42,886 --> 00:04:42,976
car.


121
00:04:47,066 --> 00:04:48,606
Every time the user enters the


122
00:04:48,606 --> 00:04:50,746
car CarPlay reconnects


123
00:04:50,746 --> 00:04:54,376
automatically, iPhone can remain


124
00:04:54,376 --> 00:04:56,626
in your bag or pocket and no


125
00:04:56,626 --> 00:04:58,406
user interaction is necessary.


126
00:04:59,506 --> 00:05:01,886
When CarPlay starts, be sure to


127
00:05:01,886 --> 00:05:03,706
observe the last user mode for


128
00:05:03,706 --> 00:05:05,036
audio in the display.


129
00:05:06,246 --> 00:05:08,456
For details, watch the video


130
00:05:08,456 --> 00:05:10,906
Developing CarPlay Systems Part


131
00:05:10,906 --> 00:05:11,226
1.


132
00:05:14,816 --> 00:05:17,706
With wireless CarPlay it's easy


133
00:05:17,706 --> 00:05:19,546
to pair more than one iPhone


134
00:05:19,706 --> 00:05:20,316
with the car.


135
00:05:21,366 --> 00:05:23,926
In addition, you may have one or


136
00:05:23,926 --> 00:05:26,006
many iPhones plugged in at the


137
00:05:26,106 --> 00:05:26,676
same time.


138
00:05:28,396 --> 00:05:30,146
Provide a device selector in


139
00:05:30,146 --> 00:05:32,346
your native UI that lets the


140
00:05:32,346 --> 00:05:34,446
user choose the active CarPlay


141
00:05:34,446 --> 00:05:34,806
device.


142
00:05:35,866 --> 00:05:38,346
Once CarPlay has started don't


143
00:05:38,346 --> 00:05:39,876
automatically switch to another


144
00:05:39,876 --> 00:05:40,276
device.


145
00:05:41,446 --> 00:05:42,906
Changing the active CarPlay


146
00:05:42,906 --> 00:05:44,646
device should be an explicit


147
00:05:44,746 --> 00:05:45,656
user action.


148
00:05:47,246 --> 00:05:48,746
If you support multiple


149
00:05:48,746 --> 00:05:50,696
Bluetooth devices and have a


150
00:05:50,726 --> 00:05:52,666
concept of favorite or


151
00:05:52,666 --> 00:05:55,456
frequently used devices use the


152
00:05:55,456 --> 00:05:57,386
same mechanism for wireless


153
00:05:57,496 --> 00:05:57,936
CarPlay.


154
00:05:59,516 --> 00:06:02,096
Your device selector shows all


155
00:06:02,096 --> 00:06:04,406
CarPlay devices whether they are


156
00:06:04,476 --> 00:06:06,296
plugged in or paired for


157
00:06:06,296 --> 00:06:07,196
wireless CarPlay.


158
00:06:08,686 --> 00:06:10,316
Indicate the active CarPlay


159
00:06:10,316 --> 00:06:12,836
device using the CarPlay logo.


160
00:06:13,876 --> 00:06:15,906
Never indicate if CarPlay is


161
00:06:15,906 --> 00:06:17,796
running over wireless or wired.


162
00:06:18,626 --> 00:06:19,926
The transfer type should be


163
00:06:19,926 --> 00:06:21,186
transparent to the user.


164
00:06:22,526 --> 00:06:24,476
If you provide on off settings


165
00:06:25,116 --> 00:06:26,686
don't provide separate settings


166
00:06:26,786 --> 00:06:28,466
for wired and wireless CarPlay,


167
00:06:28,956 --> 00:06:30,196
just provide a setting for


168
00:06:30,196 --> 00:06:32,206
Bluetooth or iPod versus


169
00:06:32,206 --> 00:06:32,596
CarPlay.


170
00:06:34,326 --> 00:06:35,896
Be judicious in showing


171
00:06:35,896 --> 00:06:38,256
notifications, only show


172
00:06:38,256 --> 00:06:39,646
notifications when it's


173
00:06:39,646 --> 00:06:41,416
important to let the users know.


174
00:06:42,246 --> 00:06:44,216
Show a subtle notification when


175
00:06:44,216 --> 00:06:46,346
the first iPhone is connected


176
00:06:47,026 --> 00:06:48,996
only if CarPlay will not


177
00:06:48,996 --> 00:06:51,446
immediately become visible or


178
00:06:51,846 --> 00:06:53,596
the CarPlay [inaudible] icon is


179
00:06:53,596 --> 00:06:54,856
not immediately visible.


180
00:06:56,286 --> 00:06:57,916
Show a notification when a


181
00:06:57,916 --> 00:07:00,236
second iPhone is connected over


182
00:07:00,236 --> 00:07:02,446
USB while CarPlay is running.


183
00:07:03,806 --> 00:07:06,526
Do not show notifications when


184
00:07:06,666 --> 00:07:08,666
iPhone joins or leaves the


185
00:07:08,816 --> 00:07:10,896
access point or when it is


186
00:07:10,896 --> 00:07:12,696
reconnected over Bluetooth.


187
00:07:15,436 --> 00:07:17,536
Now that we have seen how to use


188
00:07:17,536 --> 00:07:20,136
wireless CarPlay let's explore


189
00:07:20,236 --> 00:07:21,706
what it takes to develop such a


190
00:07:21,706 --> 00:07:22,186
system.


191
00:07:25,446 --> 00:07:26,686
We'll start with the hardware


192
00:07:26,686 --> 00:07:28,766
requirements, go through setup


193
00:07:28,766 --> 00:07:30,816
and pairing, reconnecting for


194
00:07:30,816 --> 00:07:33,106
CarPlay, and finish with some


195
00:07:33,106 --> 00:07:35,256
considerations for your wireless


196
00:07:35,256 --> 00:07:35,916
architecture.


197
00:07:38,666 --> 00:07:40,026
So, hardware requirements.


198
00:07:40,306 --> 00:07:42,086
wireless CarPlay requires


199
00:07:42,086 --> 00:07:44,586
Bluetooth, a Wi-Fi access point


200
00:07:44,906 --> 00:07:45,836
and location data.


201
00:07:47,956 --> 00:07:50,066
Bluetooth is used to discover


202
00:07:50,126 --> 00:07:51,866
and reconnect CarPlay devices.


203
00:07:53,356 --> 00:07:55,076
To accomplish this the Bluetooth


204
00:07:55,076 --> 00:07:57,386
subsystem needs to implement the


205
00:07:57,386 --> 00:07:59,666
Bluetooth core specification, as


206
00:07:59,666 --> 00:08:00,946
well as support service


207
00:08:00,946 --> 00:08:04,046
discovery, iAP2 protocols and


208
00:08:04,096 --> 00:08:06,236
advertise CarPlay support in its


209
00:08:06,236 --> 00:08:07,806
Bluetooth Extended Inquiry


210
00:08:07,806 --> 00:08:08,636
Response.


211
00:08:11,856 --> 00:08:14,726
The Wi-Fi link is used for all


212
00:08:14,726 --> 00:08:16,676
audio and video transfer to the


213
00:08:16,676 --> 00:08:18,966
CarPlay protocol, as well as


214
00:08:19,116 --> 00:08:20,616
iAP2 data transfer.


215
00:08:21,916 --> 00:08:23,106
The access point must be


216
00:08:23,106 --> 00:08:25,136
certified by the Wi-Fi Alliance


217
00:08:25,716 --> 00:08:27,386
and it is recommended that it


218
00:08:27,436 --> 00:08:30,686
supports the 802.11ac standard


219
00:08:31,106 --> 00:08:33,025
and operates in the 5GHz


220
00:08:33,025 --> 00:08:34,066
frequency band.


221
00:08:35,796 --> 00:08:37,876
In addition, the axis point


222
00:08:37,876 --> 00:08:39,256
needs to support the Apple


223
00:08:39,256 --> 00:08:41,426
Device Information Element and


224
00:08:41,426 --> 00:08:43,346
the Interworking Information


225
00:08:44,135 --> 00:08:44,366
Element.


226
00:08:45,236 --> 00:08:47,406
The location has always been


227
00:08:47,406 --> 00:08:49,736
required for CarPlay, but it


228
00:08:49,736 --> 00:08:51,916
becomes an absolute necessity


229
00:08:52,256 --> 00:08:54,186
with wireless CarPlay as the


230
00:08:54,186 --> 00:08:55,866
driver's phone might be left in


231
00:08:55,866 --> 00:08:57,786
a pocket or a bag and be


232
00:08:57,786 --> 00:08:58,886
completely out of sight.


233
00:09:00,476 --> 00:09:02,426
To provide reliable and precise


234
00:09:02,426 --> 00:09:04,966
location data, the head unit


235
00:09:04,966 --> 00:09:08,136
needs a GNSS receiver, access to


236
00:09:08,136 --> 00:09:09,836
the speed sensor of the vehicle,


237
00:09:10,346 --> 00:09:11,716
as well as the ability to


238
00:09:11,716 --> 00:09:13,416
provide dead reckoning position


239
00:09:13,416 --> 00:09:14,106
information.


240
00:09:15,206 --> 00:09:17,096
Okay, now that we have talked


241
00:09:17,126 --> 00:09:18,196
through the basic hardware


242
00:09:18,196 --> 00:09:20,756
requirements let's talk about


243
00:09:20,836 --> 00:09:22,546
set up and pairing for CarPlay.


244
00:09:25,556 --> 00:09:27,546
First, let's look at what


245
00:09:27,546 --> 00:09:29,366
components are needed to set up


246
00:09:29,366 --> 00:09:30,856
wireless and wired CarPlay.


247
00:09:33,216 --> 00:09:35,476
Of course, one or many USB


248
00:09:35,476 --> 00:09:38,456
ports, a Wi-Fi access point,


249
00:09:39,266 --> 00:09:41,766
Bluetooth module, and an


250
00:09:41,766 --> 00:09:43,186
instance of the CarPlay


251
00:09:43,186 --> 00:09:44,566
communication plugin are


252
00:09:44,566 --> 00:09:45,176
required.


253
00:09:47,336 --> 00:09:49,576
On ignition on or a head unit


254
00:09:49,576 --> 00:09:51,796
restart the components need to


255
00:09:51,796 --> 00:09:53,416
be initialized and set up.


256
00:09:54,616 --> 00:09:57,606
USBs ready for role swap and NCM


257
00:09:57,606 --> 00:09:58,976
communication for wired CarPlay.


258
00:10:00,676 --> 00:10:02,966
BT, Wi-Fi and networking for


259
00:10:02,966 --> 00:10:03,906
wireless CarPlay.


260
00:10:04,966 --> 00:10:07,386
Bonjour and the communication


261
00:10:07,386 --> 00:10:09,116
plugin to enable CarPlay


262
00:10:09,116 --> 00:10:09,706
discovery.


263
00:10:11,736 --> 00:10:13,796
When all those components are


264
00:10:13,796 --> 00:10:15,976
set up the system is ready for


265
00:10:15,976 --> 00:10:16,856
CarPlay connection.


266
00:10:18,096 --> 00:10:20,556
As we saw earlier, there are two


267
00:10:20,556 --> 00:10:22,356
ways to pair iPhone to the car.


268
00:10:23,116 --> 00:10:25,476
If iPhone is plugged in using a


269
00:10:25,476 --> 00:10:28,836
cable out-of-band pairing is


270
00:10:28,836 --> 00:10:30,086
triggered in the background.


271
00:10:31,446 --> 00:10:33,956
Otherwise, a Bluetooth pairing


272
00:10:33,956 --> 00:10:34,976
process is needed.


273
00:10:36,496 --> 00:10:39,606
Setup over USB requires less


274
00:10:39,606 --> 00:10:41,506
user interaction and is the


275
00:10:41,506 --> 00:10:43,156
recommended setup procedure.


276
00:10:46,546 --> 00:10:48,446
Now let's dive into pairing over


277
00:10:48,486 --> 00:10:48,776
USB.


278
00:10:50,716 --> 00:10:52,986
As you see in the diagram, we


279
00:10:52,986 --> 00:10:54,476
have the essential head unit


280
00:10:54,476 --> 00:10:57,266
components on the left-hand side


281
00:10:57,886 --> 00:10:59,466
and iPhone is displayed on the


282
00:10:59,466 --> 00:10:59,836
right.


283
00:11:00,766 --> 00:11:02,666
At this point, the system is


284
00:11:02,706 --> 00:11:04,186
fully booted and ready for


285
00:11:04,186 --> 00:11:04,736
CarPlay.


286
00:11:05,576 --> 00:11:07,046
The head unit is showing the


287
00:11:07,046 --> 00:11:09,596
native user interface as the


288
00:11:09,596 --> 00:11:10,976
user connects over USB.


289
00:11:12,776 --> 00:11:16,356
A USB role switch follows and


290
00:11:16,356 --> 00:11:17,656
iPhone shows that CarPlay's


291
00:11:17,656 --> 00:11:18,226
connected.


292
00:11:21,526 --> 00:11:23,656
With the role switch the unit


293
00:11:23,656 --> 00:11:26,286
also establishes an iAP2 link


294
00:11:26,726 --> 00:11:28,166
declaring support for all


295
00:11:28,166 --> 00:11:29,366
necessary messages.


296
00:11:30,746 --> 00:11:32,296
While the CarPlay session is


297
00:11:32,296 --> 00:11:34,996
starting over USB iPhone asks


298
00:11:35,226 --> 00:11:36,776
the user to enable wireless


299
00:11:36,776 --> 00:11:37,236
CarPlay.


300
00:11:40,686 --> 00:11:43,496
With that CarPlay over USB is


301
00:11:43,496 --> 00:11:44,296
already active.


302
00:11:45,766 --> 00:11:48,226
So, iOS proceeds with setting up


303
00:11:48,226 --> 00:11:50,016
the audio and video streams to


304
00:11:50,016 --> 00:11:51,266
show CarPlay in the car.


305
00:11:55,156 --> 00:11:57,286
Now the user decides to enable


306
00:11:57,286 --> 00:11:58,106
wireless CarPlay.


307
00:12:01,936 --> 00:12:05,136
After user confirmation iOS


308
00:12:05,166 --> 00:12:07,066
generates a Bluetooth link key


309
00:12:07,416 --> 00:12:09,406
and sends it over iAP to the


310
00:12:09,406 --> 00:12:09,946
unit.


311
00:12:11,566 --> 00:12:13,276
The head unit saves the link key


312
00:12:13,276 --> 00:12:14,746
together with the device


313
00:12:14,746 --> 00:12:17,526
transport identifiers and stores


314
00:12:17,526 --> 00:12:19,156
this iPhone as a Bluetooth


315
00:12:19,216 --> 00:12:21,196
paired device set up for


316
00:12:21,196 --> 00:12:21,636
CarPlay.


317
00:12:24,636 --> 00:12:27,606
Once the device is saved the


318
00:12:27,606 --> 00:12:28,926
head unit sends back a


319
00:12:28,926 --> 00:12:30,716
confirmation and out-of-band


320
00:12:30,716 --> 00:12:31,686
pairing is complete.


321
00:12:35,246 --> 00:12:35,906
Let's review.


322
00:12:38,146 --> 00:12:41,046
Without out-of-band pairing the


323
00:12:41,046 --> 00:12:42,906
CarPlay session is established


324
00:12:42,906 --> 00:12:45,726
over USB and is not interrupted.


325
00:12:47,736 --> 00:12:50,176
There is no actual exchange over


326
00:12:50,176 --> 00:12:51,776
BT during this process.


327
00:12:54,196 --> 00:12:56,646
The device needs to be stored as


328
00:12:56,646 --> 00:12:59,196
the last connected BT device or


329
00:12:59,196 --> 00:13:01,516
preferred device so that it can


330
00:13:01,516 --> 00:13:02,826
be reconnected later on.


331
00:13:05,076 --> 00:13:07,036
Hence, a wireless CarPlay


332
00:13:07,036 --> 00:13:09,016
session will start automatically


333
00:13:09,346 --> 00:13:11,936
only after an ignition cycle as


334
00:13:11,936 --> 00:13:13,546
the driver returns to the car.


335
00:13:15,746 --> 00:13:18,316
It's important to note that you


336
00:13:18,316 --> 00:13:19,736
should not start wireless


337
00:13:19,736 --> 00:13:21,356
CarPlay when the driver


338
00:13:21,356 --> 00:13:23,436
disconnects from USB, she might


339
00:13:23,436 --> 00:13:24,576
be just leaving the car.


340
00:13:26,086 --> 00:13:28,066
Now that we have seen the USB


341
00:13:28,066 --> 00:13:30,906
setup for wireless CarPlay let's


342
00:13:30,906 --> 00:13:32,216
take a look at the second


343
00:13:32,216 --> 00:13:34,646
method, pairing over Bluetooth.


344
00:13:35,876 --> 00:13:37,146
There are a couple of ways to


345
00:13:37,146 --> 00:13:38,966
initiate Bluetooth pairing in a


346
00:13:38,966 --> 00:13:39,476
vehicle.


347
00:13:40,646 --> 00:13:42,776
A long press on the Voice


348
00:13:42,776 --> 00:13:43,986
Recognition button on the


349
00:13:43,986 --> 00:13:46,606
steering wheel or through the


350
00:13:46,606 --> 00:13:47,176
native UI.


351
00:13:49,256 --> 00:13:51,316
And with the native UI there are


352
00:13:51,316 --> 00:13:51,916
two options.


353
00:13:51,916 --> 00:13:55,156
A dedicated UI for adding a


354
00:13:55,156 --> 00:13:58,166
CarPlay device or through the


355
00:13:58,166 --> 00:14:00,666
already existing UI for adding a


356
00:14:00,666 --> 00:14:01,536
BT device.


357
00:14:02,926 --> 00:14:04,516
Over the next couple of slides,


358
00:14:04,896 --> 00:14:05,926
we will look into the


359
00:14:05,926 --> 00:14:07,576
differences between these


360
00:14:07,646 --> 00:14:08,456
pairing methods.


361
00:14:11,646 --> 00:14:13,116
No matter which of the three


362
00:14:13,116 --> 00:14:15,036
pairing UIs was used by the


363
00:14:15,036 --> 00:14:18,046
driver to initiate pairing the


364
00:14:18,046 --> 00:14:19,666
head unit becomes discoverable.


365
00:14:21,626 --> 00:14:23,776
The driver also needs to open


366
00:14:23,926 --> 00:14:26,106
either Bluetooth settings or


367
00:14:26,216 --> 00:14:29,696
CarPlay settings on iPhone to


368
00:14:29,696 --> 00:14:31,296
set iOS in a Bluetooth


369
00:14:31,296 --> 00:14:32,696
discoverable mode as well.


370
00:14:34,686 --> 00:14:37,006
Again, this is a very generic


371
00:14:37,006 --> 00:14:39,136
representation of the fact that


372
00:14:39,206 --> 00:14:40,916
both the phone and the head unit


373
00:14:40,986 --> 00:14:42,706
must be set into a discoverable


374
00:14:42,706 --> 00:14:43,016
mode.


375
00:14:46,676 --> 00:14:48,246
Now let's look at the different


376
00:14:48,246 --> 00:14:51,056
options on how to set up the


377
00:14:51,056 --> 00:14:52,956
head unit into a discoverable


378
00:14:52,956 --> 00:14:54,906
mode and how to select which


379
00:14:54,906 --> 00:14:55,826
device to pair to.


380
00:14:58,006 --> 00:14:59,986
In this first variation, the


381
00:14:59,986 --> 00:15:02,586
head unit simply asks the user


382
00:15:02,626 --> 00:15:04,456
to search for the car's name on


383
00:15:04,456 --> 00:15:07,196
the CarPlay or BT settings menus


384
00:15:07,306 --> 00:15:08,046
on iPhone.


385
00:15:09,916 --> 00:15:12,296
The user enters this menu by


386
00:15:12,296 --> 00:15:13,946
either navigating the native UI


387
00:15:14,086 --> 00:15:17,106
to add a new Bluetooth device or


388
00:15:17,226 --> 00:15:18,786
by long pressing on the Voice


389
00:15:18,786 --> 00:15:20,086
Recognition button on the


390
00:15:20,086 --> 00:15:20,716
steering wheel.


391
00:15:22,956 --> 00:15:24,816
iPhone discovers the car and


392
00:15:24,816 --> 00:15:25,396
lists it.


393
00:15:28,016 --> 00:15:30,136
The driver can then select the


394
00:15:30,136 --> 00:15:34,166
car on iPhone and iOS initiates


395
00:15:34,166 --> 00:15:35,526
a Bluetooth pairing request.


396
00:15:37,466 --> 00:15:39,366
This is the simplest and most


397
00:15:39,366 --> 00:15:41,046
straightforward approach to


398
00:15:41,046 --> 00:15:42,426
accomplish Bluetooth pairing.


399
00:15:43,256 --> 00:15:45,596
The second option is for the


400
00:15:45,596 --> 00:15:47,336
driver to select the device from


401
00:15:47,336 --> 00:15:49,396
a list of available Bluetooth


402
00:15:49,396 --> 00:15:51,996
devices on the car's native


403
00:15:51,996 --> 00:15:52,586
interface.


404
00:15:54,346 --> 00:15:56,786
In this case, the head unit is


405
00:15:56,786 --> 00:15:59,186
not only discoverable, but also


406
00:15:59,186 --> 00:16:00,806
scans for BT devices.


407
00:16:02,516 --> 00:16:04,036
Exactly as in the previous


408
00:16:04,036 --> 00:16:06,426
option, the driver enters this


409
00:16:06,426 --> 00:16:08,466
menu by either navigating the


410
00:16:08,466 --> 00:16:10,556
native UI to add a new Bluetooth


411
00:16:10,556 --> 00:16:13,236
device or by long pressing on


412
00:16:13,236 --> 00:16:15,036
the Voice Recognition button on


413
00:16:15,036 --> 00:16:15,726
the steering wheel.


414
00:16:17,076 --> 00:16:19,126
Any BT capable device will be


415
00:16:19,126 --> 00:16:21,616
shown in this list, so the list


416
00:16:21,616 --> 00:16:23,696
might or might not include


417
00:16:23,736 --> 00:16:24,656
CarPlay devices.


418
00:16:25,966 --> 00:16:28,006
That is why it is important to


419
00:16:28,006 --> 00:16:30,706
note that in this option any


420
00:16:30,706 --> 00:16:32,866
mention of Apple CarPlay on the


421
00:16:32,866 --> 00:16:34,626
UI is not recommended.


422
00:16:36,786 --> 00:16:38,776
With this UI, the driver can


423
00:16:38,776 --> 00:16:40,606
select the device to pair to


424
00:16:41,076 --> 00:16:44,066
from the native UI or as before


425
00:16:44,326 --> 00:16:45,216
on the device.


426
00:16:46,796 --> 00:16:48,446
The third option is very


427
00:16:48,446 --> 00:16:51,536
similar, however, this time the


428
00:16:51,536 --> 00:16:54,276
user is explicitly adding a new


429
00:16:54,276 --> 00:16:55,946
CarPlay device from the native


430
00:16:55,946 --> 00:16:56,736
user interface.


431
00:16:58,036 --> 00:17:00,356
The list shows only devices that


432
00:17:00,356 --> 00:17:01,816
actually support wireless


433
00:17:01,816 --> 00:17:02,256
CarPlay.


434
00:17:03,486 --> 00:17:05,556
The head unit must use the Apple


435
00:17:05,556 --> 00:17:07,736
CarPlay Bluetooth EIR to


436
00:17:07,736 --> 00:17:09,366
accomplish this filtering.


437
00:17:10,636 --> 00:17:13,496
Again, as before, the driver


438
00:17:13,496 --> 00:17:15,986
selects either on the car's UI


439
00:17:16,996 --> 00:17:18,606
or on device.


440
00:17:20,665 --> 00:17:22,506
After a device has been selected


441
00:17:23,066 --> 00:17:24,526
the head unit and iPhone


442
00:17:24,596 --> 00:17:26,336
complete Bluetooth secure simple


443
00:17:26,336 --> 00:17:28,906
pairing and connect IP over


444
00:17:28,906 --> 00:17:30,896
Bluetooth and the head unit


445
00:17:30,896 --> 00:17:33,306
identifies support for the


446
00:17:33,306 --> 00:17:34,296
required messages.


447
00:17:35,646 --> 00:17:38,616
When iAP2 connects iOS will


448
00:17:38,656 --> 00:17:40,166
prompt the user to enable


449
00:17:40,166 --> 00:17:41,786
wireless CarPlay on device.


450
00:17:43,216 --> 00:17:44,876
And just as a side note, but a


451
00:17:44,876 --> 00:17:46,856
very important one, connect


452
00:17:46,856 --> 00:17:50,156
additional BT profiles only if


453
00:17:50,156 --> 00:17:51,926
the wireless access point is


454
00:17:51,926 --> 00:17:54,106
operating in the 5GHz band.


455
00:17:55,776 --> 00:17:59,106
Once iAP2 is connected iOS


456
00:17:59,106 --> 00:18:00,716
provides the device transport


457
00:18:00,716 --> 00:18:02,976
identifiers so that the head


458
00:18:02,976 --> 00:18:04,656
unit can store the device as a


459
00:18:04,656 --> 00:18:07,016
CarPlay device and recognize it


460
00:18:07,076 --> 00:18:09,016
over a different transport when


461
00:18:09,016 --> 00:18:10,536
it gets reconnected later on.


462
00:18:12,006 --> 00:18:13,266
The head unit listens to


463
00:18:13,266 --> 00:18:14,686
wireless CarPlay update


464
00:18:14,686 --> 00:18:17,836
notifications and if CarPlay is


465
00:18:17,836 --> 00:18:20,166
enabled on device it may choose


466
00:18:20,166 --> 00:18:22,256
to confirm whether to proceed


467
00:18:22,256 --> 00:18:23,366
with setup for CarPlay.


468
00:18:25,156 --> 00:18:27,216
As we saw earlier, this


469
00:18:27,266 --> 00:18:29,626
confirmation is only needed if


470
00:18:29,626 --> 00:18:31,576
the user selected the device


471
00:18:32,716 --> 00:18:34,676
through the add Bluetooth device


472
00:18:34,676 --> 00:18:35,136
menus.


473
00:18:36,536 --> 00:18:38,436
As the user initiated pairing


474
00:18:38,436 --> 00:18:39,576
through Bluetooth settings on


475
00:18:39,706 --> 00:18:41,646
iPhone we see a similar


476
00:18:41,646 --> 00:18:43,456
confirmation on iPhone as well.


477
00:18:44,806 --> 00:18:47,356
Of course, neither of those


478
00:18:47,356 --> 00:18:49,226
confirmation dialogs will be


479
00:18:49,226 --> 00:18:51,786
shown if the driver initiated


480
00:18:51,836 --> 00:18:53,916
pairing from CarPlay specific


481
00:18:53,916 --> 00:18:54,366
menus.


482
00:18:56,496 --> 00:18:58,666
Next, let's assume the user


483
00:18:58,666 --> 00:19:00,846
confirms on the device first.


484
00:19:01,426 --> 00:19:05,436
When that happens the device


485
00:19:05,436 --> 00:19:08,146
requests to receive the wireless


486
00:19:08,146 --> 00:19:10,226
credentials of the Wi-Fi access


487
00:19:10,226 --> 00:19:10,566
point.


488
00:19:12,466 --> 00:19:14,086
The head unit must wait for the


489
00:19:14,086 --> 00:19:15,596
user confirmation before


490
00:19:15,596 --> 00:19:16,266
responding.


491
00:19:17,476 --> 00:19:19,106
This is the time to get the


492
00:19:19,106 --> 00:19:21,806
user's consent and if needed,


493
00:19:22,026 --> 00:19:23,516
reconfigure the system for


494
00:19:23,516 --> 00:19:24,296
wireless CarPlay.


495
00:19:25,686 --> 00:19:28,226
Now the user confirms on the


496
00:19:28,226 --> 00:19:29,526
native UI as well.


497
00:19:30,826 --> 00:19:32,416
Then the head unit responds with


498
00:19:32,416 --> 00:19:35,396
the credentials and iPhone


499
00:19:35,396 --> 00:19:37,136
starts searching for the access


500
00:19:37,176 --> 00:19:39,986
point and joins it.


501
00:19:40,696 --> 00:19:42,996
From now on, exactly ask for


502
00:19:42,996 --> 00:19:43,966
wired CarPlay.


503
00:19:44,966 --> 00:19:47,186
Bonjour discovery runs and once


504
00:19:47,216 --> 00:19:49,286
the device is found the head


505
00:19:49,286 --> 00:19:51,576
unit initiates a CarPlay session


506
00:19:51,576 --> 00:19:55,216
through CarPlay Control API.


507
00:19:56,376 --> 00:19:59,256
CarPlay session follows, as well


508
00:19:59,306 --> 00:20:01,546
as connection establishment for


509
00:20:01,606 --> 00:20:02,976
iAP2 over CarPlay.


510
00:20:04,476 --> 00:20:07,736
Note that at this point iAP2 is


511
00:20:07,736 --> 00:20:10,156
also still connected over


512
00:20:10,156 --> 00:20:10,686
Bluetooth.


513
00:20:13,776 --> 00:20:15,406
Then iPhone sends a disabled


514
00:20:15,406 --> 00:20:17,236
Bluetooth command and the head


515
00:20:17,236 --> 00:20:19,726
unit must disconnect all


516
00:20:19,726 --> 00:20:21,216
Bluetooth connections to this


517
00:20:21,266 --> 00:20:21,776
device.


518
00:20:23,466 --> 00:20:26,426
Remember that if the access


519
00:20:26,466 --> 00:20:29,976
point is operating in the 2.4GHz


520
00:20:30,076 --> 00:20:32,486
band Bluetooth needs to be


521
00:20:32,486 --> 00:20:33,906
turned off while there's an


522
00:20:34,026 --> 00:20:35,686
active CarPlay session to avoid


523
00:20:35,686 --> 00:20:36,486
interference.


524
00:20:39,416 --> 00:20:41,076
Now that the screen and video


525
00:20:41,076 --> 00:20:42,726
streams are started and the


526
00:20:42,726 --> 00:20:44,936
CarPlay UI is visible on the


527
00:20:44,936 --> 00:20:47,966
screen voila, CarPlay is running


528
00:20:47,966 --> 00:20:49,086
without any wires.


529
00:20:51,336 --> 00:20:53,726
All right, now that we saw how


530
00:20:53,726 --> 00:20:55,156
to set up wireless CarPlay


531
00:20:55,606 --> 00:20:57,196
here's some general points to


532
00:20:57,196 --> 00:20:57,616
consider.


533
00:21:00,106 --> 00:21:02,256
First, after setup is done the


534
00:21:02,256 --> 00:21:04,626
CarPlay UI is expected to show


535
00:21:04,626 --> 00:21:04,766
up.


536
00:21:06,806 --> 00:21:09,176
Then if iPhone is playing music,


537
00:21:09,416 --> 00:21:10,976
music playback will be set up


538
00:21:11,026 --> 00:21:11,596
through CarPlay.


539
00:21:13,516 --> 00:21:15,756
Lastly, the device must be


540
00:21:15,756 --> 00:21:17,826
stored as the last connected BT


541
00:21:17,826 --> 00:21:19,986
device so that it can be


542
00:21:19,986 --> 00:21:21,716
reconnected automatically later


543
00:21:21,716 --> 00:21:21,966
on.


544
00:21:25,086 --> 00:21:26,986
And with that we can conclude


545
00:21:26,986 --> 00:21:28,846
the discussion around setup and


546
00:21:28,886 --> 00:21:31,586
pairing and move to actually


547
00:21:31,586 --> 00:21:33,616
look into how a CarPlay device


548
00:21:33,656 --> 00:21:35,236
is connected when the user


549
00:21:35,236 --> 00:21:36,116
returns to the car.


550
00:21:37,546 --> 00:21:39,266
When you reconnect for CarPlay


551
00:21:39,526 --> 00:21:41,116
you need to take into account


552
00:21:41,256 --> 00:21:42,876
all devices connected to the


553
00:21:42,876 --> 00:21:45,726
system at the moment, as well as


554
00:21:46,346 --> 00:21:48,996
the state of the system before


555
00:21:48,996 --> 00:21:50,086
ignition was turned off.


556
00:21:51,976 --> 00:21:54,226
Whether CarPlay is using USB as


557
00:21:54,226 --> 00:21:56,316
the transport or the wireless


558
00:21:56,316 --> 00:21:58,546
link it's completely transparent


559
00:21:58,546 --> 00:22:01,776
to the user and depends only on


560
00:22:01,776 --> 00:22:03,446
how a device is connected to the


561
00:22:03,446 --> 00:22:05,516
car and in which order the


562
00:22:05,516 --> 00:22:06,476
connections happened.


563
00:22:09,036 --> 00:22:10,926
After deciding which device to


564
00:22:10,926 --> 00:22:13,636
connect to make sure the device


565
00:22:13,786 --> 00:22:15,466
still has CarPlay enabled.


566
00:22:16,736 --> 00:22:18,496
Revert to using legacy


567
00:22:18,496 --> 00:22:20,616
technologies if CarPlay is no


568
00:22:20,616 --> 00:22:21,496
longer available.


569
00:22:23,976 --> 00:22:26,076
Once the reconnection succeeds


570
00:22:26,596 --> 00:22:28,656
restore how the user used the


571
00:22:28,656 --> 00:22:29,696
system last time.


572
00:22:30,646 --> 00:22:32,576
If she was listening to FM radio


573
00:22:32,836 --> 00:22:34,176
continue playing it.


574
00:22:34,716 --> 00:22:36,376
Show the last screen the user


575
00:22:36,376 --> 00:22:38,456
was looking at either a native


576
00:22:38,456 --> 00:22:39,976
application or CarPlay.


577
00:22:41,016 --> 00:22:42,816
The user experience should


578
00:22:42,976 --> 00:22:45,176
simply continue and follow the


579
00:22:45,176 --> 00:22:45,966
user's habit.


580
00:22:48,366 --> 00:22:50,916
Lastly, once a CarPlay session


581
00:22:50,916 --> 00:22:53,246
is running on a device do not


582
00:22:53,246 --> 00:22:53,876
interrupt it.


583
00:22:55,366 --> 00:22:56,986
Imagine the driver is listening


584
00:22:56,986 --> 00:22:58,616
to her favorite song or


585
00:22:58,616 --> 00:23:01,226
navigating and a friend plugs in


586
00:23:01,226 --> 00:23:03,686
to charge it will be disruptive


587
00:23:03,686 --> 00:23:05,586
if music all of a sudden resumed


588
00:23:05,586 --> 00:23:06,576
from the friend's phone.


589
00:23:08,496 --> 00:23:10,676
Now let's review some scenarios


590
00:23:10,996 --> 00:23:12,336
to better understand what it


591
00:23:12,336 --> 00:23:13,956
means when we say the


592
00:23:14,446 --> 00:23:15,856
reconnection depends on the


593
00:23:15,856 --> 00:23:17,896
availability and the order of


594
00:23:17,896 --> 00:23:18,386
events.


595
00:23:19,556 --> 00:23:21,106
In all these scenarios, we


596
00:23:21,106 --> 00:23:23,306
assume that the phone has been


597
00:23:23,306 --> 00:23:24,736
previously paired for wireless


598
00:23:24,736 --> 00:23:27,126
CarPlay and the system has at


599
00:23:27,126 --> 00:23:28,576
least one USB port.


600
00:23:30,386 --> 00:23:32,096
We are going to pay attention to


601
00:23:32,096 --> 00:23:33,776
when iPhone was connected over


602
00:23:33,826 --> 00:23:36,816
USB, identify a common scenario,


603
00:23:37,446 --> 00:23:39,436
and observe which transport is


604
00:23:39,436 --> 00:23:40,756
used to establish a CarPlay


605
00:23:40,756 --> 00:23:41,206
session.


606
00:23:43,676 --> 00:23:44,876
First, let's look at the


607
00:23:44,876 --> 00:23:47,476
scenario where there is just one


608
00:23:47,666 --> 00:23:48,506
iPhone in the car.


609
00:23:49,396 --> 00:23:51,456
The simplest situation is that


610
00:23:51,486 --> 00:23:53,896
the user gets back into the car


611
00:23:54,516 --> 00:23:56,356
for a short drive and keeps


612
00:23:56,356 --> 00:23:57,376
iPhone in the pocket.


613
00:23:58,526 --> 00:24:00,586
A morning commute running small


614
00:24:00,586 --> 00:24:02,286
errands would be the perfect


615
00:24:02,286 --> 00:24:02,856
examples.


616
00:24:04,486 --> 00:24:06,506
As the only available transport


617
00:24:06,506 --> 00:24:09,426
is wireless naturally CarPlay


618
00:24:09,426 --> 00:24:10,556
runs wirelessly.


619
00:24:13,206 --> 00:24:15,946
In the next scenario, the driver


620
00:24:16,016 --> 00:24:17,846
plugs in after the drive has


621
00:24:17,846 --> 00:24:18,306
started.


622
00:24:19,926 --> 00:24:21,906
Typical usage here is just


623
00:24:21,906 --> 00:24:24,296
realizing that the phone needs


624
00:24:24,296 --> 00:24:26,026
to be charged after departing.


625
00:24:28,336 --> 00:24:30,376
In this case, the session has


626
00:24:30,376 --> 00:24:32,046
already started over wireless


627
00:24:32,656 --> 00:24:34,456
and since we do not want any


628
00:24:34,456 --> 00:24:36,966
interruptions CarPlay remains


629
00:24:36,966 --> 00:24:37,716
over wireless.


630
00:24:38,636 --> 00:24:40,616
In the next scenario, the user


631
00:24:40,616 --> 00:24:42,626
simply leaves the phone plugged


632
00:24:42,626 --> 00:24:44,336
in and gets out of the car.


633
00:24:46,286 --> 00:24:47,606
This could be a stopover at the


634
00:24:47,606 --> 00:24:49,946
gas station or simply forgetting


635
00:24:49,946 --> 00:24:52,546
the phone in the car.


636
00:24:52,806 --> 00:24:54,726
Now when the user returns the


637
00:24:54,726 --> 00:24:56,736
device is available to connect


638
00:24:56,736 --> 00:24:58,746
over both USB and wireless.


639
00:24:59,876 --> 00:25:03,116
However, usually the USB stack


640
00:25:03,116 --> 00:25:05,606
resumes faster so CarPlay is


641
00:25:05,606 --> 00:25:07,006
reconnected over USB.


642
00:25:07,886 --> 00:25:09,426
Now let's look at what happens


643
00:25:09,516 --> 00:25:11,486
if the driver plugs in right


644
00:25:11,486 --> 00:25:12,736
after entering the car.


645
00:25:14,176 --> 00:25:16,356
This could be when leaving for a


646
00:25:16,356 --> 00:25:18,536
longer trip or maybe needing to


647
00:25:18,536 --> 00:25:19,516
charge right away.


648
00:25:21,456 --> 00:25:23,726
In this case, as the system is


649
00:25:23,726 --> 00:25:26,206
coming up it will bring up both


650
00:25:26,206 --> 00:25:27,996
the USB and wireless stacks.


651
00:25:29,006 --> 00:25:30,946
Since the timing will depend


652
00:25:30,946 --> 00:25:32,816
heavily on the user's behavior


653
00:25:33,386 --> 00:25:34,636
the CarPlay session will be


654
00:25:34,636 --> 00:25:36,646
started over the first available


655
00:25:36,646 --> 00:25:37,176
transport.


656
00:25:38,686 --> 00:25:41,896
If USB is up while BT or Wi-Fi


657
00:25:42,166 --> 00:25:43,966
are still reconnecting the


658
00:25:43,966 --> 00:25:45,326
session will end up being over


659
00:25:45,406 --> 00:25:45,786
USB.


660
00:25:46,566 --> 00:25:48,316
If wireless reconnected before


661
00:25:48,316 --> 00:25:50,906
USB then the session will run


662
00:25:50,906 --> 00:25:51,656
over wireless.


663
00:25:55,306 --> 00:25:57,066
In the last scenario, we


664
00:25:57,066 --> 00:25:58,716
consider multiple devices in the


665
00:25:58,716 --> 00:25:58,956
car.


666
00:26:00,776 --> 00:26:02,976
The driver might have plugged in


667
00:26:02,976 --> 00:26:04,706
right after entering the car.


668
00:26:06,046 --> 00:26:07,446
This could be a road trip with


669
00:26:07,446 --> 00:26:09,396
friends that need to charge at


670
00:26:09,436 --> 00:26:11,236
some point or want to play music


671
00:26:11,236 --> 00:26:11,946
from their phones.


672
00:26:13,516 --> 00:26:15,836
Again, as before, the session


673
00:26:15,836 --> 00:26:17,926
will initially start depending


674
00:26:17,926 --> 00:26:19,396
on the available transport.


675
00:26:21,036 --> 00:26:22,736
Later on, the driver might


676
00:26:22,736 --> 00:26:24,276
decide to change the active


677
00:26:24,276 --> 00:26:26,506
CarPlay device using the native


678
00:26:26,506 --> 00:26:27,356
user interface.


679
00:26:29,336 --> 00:26:32,646
All right, now let's see how you


680
00:26:32,646 --> 00:26:33,636
can implement all these


681
00:26:33,666 --> 00:26:34,216
scenarios.


682
00:26:35,506 --> 00:26:37,716
We can start by looking at the


683
00:26:37,716 --> 00:26:39,496
flow for wireless reconnection.


684
00:26:41,386 --> 00:26:44,296
First, wait until both Bluetooth


685
00:26:44,416 --> 00:26:46,176
and the access point are fully


686
00:26:46,176 --> 00:26:46,836
operational.


687
00:26:49,626 --> 00:26:51,166
Then check that the last


688
00:26:51,216 --> 00:26:53,046
connected device is marked for


689
00:26:53,046 --> 00:26:54,196
CarPlay on the head unit.


690
00:26:54,276 --> 00:26:59,066
If it is, make sure that there


691
00:26:59,066 --> 00:27:01,266
is no other active CarPlay


692
00:27:01,266 --> 00:27:03,766
session either with the same


693
00:27:03,766 --> 00:27:06,696
device or with another wired or


694
00:27:06,696 --> 00:27:07,766
wireless device.


695
00:27:09,896 --> 00:27:11,486
If there is no other session


696
00:27:11,976 --> 00:27:14,196
proceed with connecting iAP2


697
00:27:14,196 --> 00:27:15,166
over Bluetooth.


698
00:27:17,646 --> 00:27:20,396
Once iAP2 Is connected wait to


699
00:27:20,396 --> 00:27:22,126
receive a notification that


700
00:27:22,126 --> 00:27:23,866
wireless CarPlay is enabled.


701
00:27:26,076 --> 00:27:29,476
If it is wait for the device to


702
00:27:29,476 --> 00:27:31,586
be discovered and connect.


703
00:27:33,816 --> 00:27:35,096
When the connect command is


704
00:27:35,096 --> 00:27:37,726
issued iPhone will check which


705
00:27:37,726 --> 00:27:40,616
interfaces are available and


706
00:27:40,826 --> 00:27:43,106
will initiate the session either


707
00:27:43,106 --> 00:27:45,156
over wireless or wired.


708
00:27:46,506 --> 00:27:49,396
Moving on to USB the flow looks


709
00:27:49,396 --> 00:27:50,216
fairly similar.


710
00:27:50,716 --> 00:27:52,716
You wait until the device gets


711
00:27:52,716 --> 00:27:55,676
connected, you check that there


712
00:27:55,676 --> 00:27:57,506
is no active session as we do


713
00:27:57,506 --> 00:27:58,896
not want to interrupt it.


714
00:27:59,406 --> 00:28:01,556
If there is none check that


715
00:28:01,556 --> 00:28:02,626
CarPlay is enabled.


716
00:28:03,126 --> 00:28:04,436
Then proceed with your role


717
00:28:04,436 --> 00:28:07,366
switch and selecting a device to


718
00:28:07,366 --> 00:28:07,626
connect.


719
00:28:07,706 --> 00:28:11,586
At this point again, iPhone


720
00:28:11,586 --> 00:28:13,816
checks if both the wireless and


721
00:28:13,816 --> 00:28:15,866
wired link are available and


722
00:28:15,866 --> 00:28:17,196
picks one of the two to


723
00:28:17,286 --> 00:28:19,556
establish the session.


724
00:28:20,066 --> 00:28:22,266
Then last user mode is restored


725
00:28:22,526 --> 00:28:23,926
and the driver is all set.


726
00:28:26,396 --> 00:28:28,086
In the previous two slides, we


727
00:28:28,086 --> 00:28:29,546
saw how to automatically


728
00:28:29,546 --> 00:28:31,236
reconnect to the last used


729
00:28:31,236 --> 00:28:31,666
device.


730
00:28:33,276 --> 00:28:34,946
But what happens if there are


731
00:28:34,946 --> 00:28:36,766
multiple CarPlay devices in the


732
00:28:36,766 --> 00:28:37,236
vehicle?


733
00:28:38,746 --> 00:28:40,466
They might be connected just


734
00:28:40,466 --> 00:28:43,056
over USB, just paired for


735
00:28:43,056 --> 00:28:46,386
wireless or both paired for


736
00:28:46,386 --> 00:28:48,396
wireless and connected over USB.


737
00:28:49,866 --> 00:28:51,586
One of those devices will get


738
00:28:51,586 --> 00:28:53,626
reconnected automatically, but


739
00:28:53,926 --> 00:28:56,136
as we mentioned before, the


740
00:28:56,136 --> 00:28:59,136
native UI lists all devices and


741
00:28:59,136 --> 00:29:00,786
lets the driver change the


742
00:29:00,786 --> 00:29:02,076
active CarPlay device.


743
00:29:04,406 --> 00:29:06,476
When that happens, the head unit


744
00:29:06,476 --> 00:29:08,276
follows the same procedures to


745
00:29:08,276 --> 00:29:09,826
reconnect over the available


746
00:29:09,826 --> 00:29:10,496
transport.


747
00:29:12,446 --> 00:29:14,276
Lastly, let's talk about


748
00:29:14,276 --> 00:29:15,946
reconnecting after a session


749
00:29:15,946 --> 00:29:16,526
disconnect.


750
00:29:17,836 --> 00:29:19,206
CarPlay disconnection might


751
00:29:19,206 --> 00:29:20,656
occur for multiple reasons.


752
00:29:21,856 --> 00:29:23,786
The head unit must be aware why


753
00:29:23,786 --> 00:29:25,796
the disconnection happened and


754
00:29:25,796 --> 00:29:27,426
determine if a reconnect is


755
00:29:27,426 --> 00:29:27,936
required.


756
00:29:27,936 --> 00:29:30,846
Here are a couple of common


757
00:29:30,846 --> 00:29:33,046
scenarios and expected outcome.


758
00:29:34,806 --> 00:29:37,116
In situations where the user


759
00:29:37,166 --> 00:29:39,566
unplugs from USB or manually


760
00:29:39,566 --> 00:29:41,006
disconnects from the native UI.


761
00:29:42,566 --> 00:29:44,786
No reconnection is needed as


762
00:29:44,786 --> 00:29:46,546
there was an explicit user


763
00:29:46,546 --> 00:29:48,926
action to terminate the CarPlay


764
00:29:50,636 --> 00:29:50,786
session.


765
00:29:51,816 --> 00:29:53,856
However, if the phone is no


766
00:29:53,856 --> 00:29:56,746
longer reachable for example,


767
00:29:56,746 --> 00:29:58,746
the user walks away, turns off


768
00:29:58,746 --> 00:30:01,656
Wi-Fi or anything similar, the


769
00:30:01,656 --> 00:30:03,316
head unit is expected to do a


770
00:30:03,316 --> 00:30:05,396
fast reconnect to the same


771
00:30:05,396 --> 00:30:07,176
device using CarPlay Control


772
00:30:07,176 --> 00:30:07,486
API.


773
00:30:08,836 --> 00:30:11,636
If that fails then proceed with


774
00:30:11,636 --> 00:30:13,566
the Bluetooth reconnect to


775
00:30:13,566 --> 00:30:15,276
reestablish the CarPlay session.


776
00:30:17,316 --> 00:30:19,196
With this we have explored all


777
00:30:19,196 --> 00:30:20,876
types of CarPlay connections.


778
00:30:22,106 --> 00:30:23,606
Now let's go over some


779
00:30:23,606 --> 00:30:25,436
architectural considerations


780
00:30:25,506 --> 00:30:26,856
when designing a wireless


781
00:30:26,856 --> 00:30:27,776
CarPlay system.


782
00:30:30,656 --> 00:30:32,056
When designing a wireless


783
00:30:32,056 --> 00:30:33,886
system, you want to optimize for


784
00:30:33,886 --> 00:30:34,656
performance.


785
00:30:36,696 --> 00:30:38,146
That means that you have to


786
00:30:38,146 --> 00:30:41,796
decide which Wi-Fi protocol to


787
00:30:41,796 --> 00:30:44,106
support, what configuration to


788
00:30:44,106 --> 00:30:46,916
use and in which frequency band


789
00:30:46,916 --> 00:30:47,536
to operate.


790
00:30:49,656 --> 00:30:51,656
Next, you need to think about


791
00:30:51,926 --> 00:30:53,826
what other wireless technologies


792
00:30:53,826 --> 00:30:55,976
will be used in the vehicle and


793
00:30:55,976 --> 00:30:57,416
potential interferences.


794
00:31:00,036 --> 00:31:02,986
Services like Internet data or


795
00:31:02,986 --> 00:31:05,396
other in-car applications might


796
00:31:05,396 --> 00:31:07,406
also have an impact on the


797
00:31:07,406 --> 00:31:08,166
performance.


798
00:31:10,296 --> 00:31:12,836
With all that in mind you need


799
00:31:12,836 --> 00:31:14,216
to assure that the wireless


800
00:31:14,326 --> 00:31:15,846
performance requirements for


801
00:31:15,846 --> 00:31:17,206
CarPlay are satisfied.


802
00:31:18,196 --> 00:31:19,476
So, what do we recommend for


803
00:31:19,476 --> 00:31:20,296
wireless CarPlay?


804
00:31:21,106 --> 00:31:23,196
First, we really recommend that


805
00:31:23,196 --> 00:31:24,906
your wireless access point


806
00:31:24,906 --> 00:31:26,786
operates in the 5GHz band.


807
00:31:27,986 --> 00:31:29,306
It offers more channels to


808
00:31:29,306 --> 00:31:31,836
choose from, it's less prone to


809
00:31:31,836 --> 00:31:34,786
interference, and it is the


810
00:31:34,786 --> 00:31:36,136
least congested band.


811
00:31:36,686 --> 00:31:39,366
Please do use 5GHz whenever


812
00:31:39,366 --> 00:31:39,876
possible.


813
00:31:44,106 --> 00:31:46,986
Even though 2.4GHz is not


814
00:31:46,986 --> 00:31:48,496
recommended and is highly


815
00:31:48,496 --> 00:31:51,276
congested in some regulatory


816
00:31:51,276 --> 00:31:52,986
domains you might have to use


817
00:31:53,636 --> 00:31:53,706
it.


818
00:31:54,436 --> 00:31:57,466
Then you need to be very aware


819
00:31:57,466 --> 00:32:00,576
of coexistent scenarios and you


820
00:32:00,576 --> 00:32:02,166
must disable the Bluetooth stack


821
00:32:02,246 --> 00:32:04,226
completely while there is an


822
00:32:04,326 --> 00:32:05,446
active CarPlay session.


823
00:32:07,766 --> 00:32:10,196
If you offer LTE connectivity on


824
00:32:10,196 --> 00:32:12,696
Band 40 your choices of


825
00:32:12,696 --> 00:32:15,086
operating channels become even


826
00:32:15,086 --> 00:32:15,996
more limited.


827
00:32:18,076 --> 00:32:20,256
Remember if you are designing a


828
00:32:20,256 --> 00:32:22,656
system which will operate in


829
00:32:22,656 --> 00:32:25,386
both bands you need to consider


830
00:32:25,436 --> 00:32:26,946
how the user experience will be


831
00:32:26,946 --> 00:32:27,496
impacted.


832
00:32:28,326 --> 00:32:30,936
In 5GHz other Bluetooth devices


833
00:32:31,116 --> 00:32:32,996
may be paired and connected in


834
00:32:32,996 --> 00:32:36,246
parallel, whereas in 2.4GHz,


835
00:32:36,796 --> 00:32:38,976
adding or connecting a second


836
00:32:38,976 --> 00:32:40,396
Bluetooth device is not


837
00:32:40,396 --> 00:32:40,896
possible.


838
00:32:45,086 --> 00:32:46,986
Some systems might choose to


839
00:32:46,986 --> 00:32:48,856
deploy multiple access points or


840
00:32:48,856 --> 00:32:51,656
dual band APs to offer a variety


841
00:32:51,656 --> 00:32:52,856
of in-car services and


842
00:32:52,856 --> 00:32:53,516
applications.


843
00:32:55,516 --> 00:32:57,146
If these access points are


844
00:32:57,146 --> 00:32:58,856
operating in the same frequency


845
00:32:58,856 --> 00:33:00,986
band they need to use different


846
00:33:00,986 --> 00:33:02,876
channels to avoid interference.


847
00:33:04,756 --> 00:33:07,286
If the access points use the


848
00:33:07,286 --> 00:33:10,556
same SSID and password they need


849
00:33:10,556 --> 00:33:12,046
to offer the same set of


850
00:33:12,176 --> 00:33:14,956
services to prevent inconsistent


851
00:33:14,956 --> 00:33:15,686
experience.


852
00:33:16,806 --> 00:33:18,856
And lastly, using hidden


853
00:33:18,856 --> 00:33:21,286
networks is not recommended for


854
00:33:21,286 --> 00:33:21,716
CarPlay.


855
00:33:25,256 --> 00:33:27,546
Finally, let's look at how to


856
00:33:27,546 --> 00:33:29,026
provide Internet data


857
00:33:29,026 --> 00:33:30,286
connectivity to iPhone.


858
00:33:31,976 --> 00:33:33,446
The head unit communicates the


859
00:33:33,446 --> 00:33:35,026
state of the Internet


860
00:33:35,076 --> 00:33:37,596
connectivity dynamically through


861
00:33:37,596 --> 00:33:40,586
the Apple Device IE and through


862
00:33:40,636 --> 00:33:41,656
the Networking IE.


863
00:33:43,456 --> 00:33:45,936
Notifications need to descend on


864
00:33:45,936 --> 00:33:46,366
changes.


865
00:33:47,206 --> 00:33:49,906
For example, to state that the


866
00:33:49,906 --> 00:33:51,576
data communication module is


867
00:33:51,576 --> 00:33:54,446
available on the system or that


868
00:33:54,476 --> 00:33:55,666
there is a failure with that


869
00:33:55,666 --> 00:33:59,586
module or that the service


870
00:33:59,586 --> 00:34:00,856
contract has expired.


871
00:34:02,866 --> 00:34:05,006
Temporary loss of connection due


872
00:34:05,006 --> 00:34:07,336
to poor cell coverage does not


873
00:34:07,336 --> 00:34:08,525
need to be communicated to


874
00:34:08,656 --> 00:34:09,016
iPhone.


875
00:34:11,266 --> 00:34:12,716
For more information about this


876
00:34:12,716 --> 00:34:14,485
session check out the session


877
00:34:14,485 --> 00:34:15,036
website.


878
00:34:16,585 --> 00:34:17,746
If you're interested in


879
00:34:17,746 --> 00:34:19,766
developing CarPlay apps check


880
00:34:19,766 --> 00:34:21,735
out the Enabling Your App for


881
00:34:21,735 --> 00:34:22,686
CarPlay session.


882
00:34:23,806 --> 00:34:25,906
Also, refer to the videos from


883
00:34:25,906 --> 00:34:27,746
last year for basic information


884
00:34:27,746 --> 00:34:28,466
about CarPlay.

