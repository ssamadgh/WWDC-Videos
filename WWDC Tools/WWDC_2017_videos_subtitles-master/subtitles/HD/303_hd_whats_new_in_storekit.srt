1
00:00:20,806 --> 00:00:21,556
>> Good morning, everyone.


2
00:00:22,516 --> 00:00:26,636
[ Applause ]


3
00:00:27,136 --> 00:00:28,096
Welcome to What's New in


4
00:00:28,096 --> 00:00:28,656
StoreKit.


5
00:00:29,116 --> 00:00:30,256
My name is Pete Hare, and I'm an


6
00:00:30,256 --> 00:00:31,736
engineer on the App Store Team


7
00:00:31,736 --> 00:00:33,586
here, at Apple.


8
00:00:33,796 --> 00:00:35,286
In-app purchases represent a


9
00:00:35,286 --> 00:00:36,996
huge percentage of revenue,


10
00:00:37,086 --> 00:00:38,286
generated by apps on the App


11
00:00:38,286 --> 00:00:38,636
Store.


12
00:00:38,636 --> 00:00:40,116
So, to be able to implement them


13
00:00:40,116 --> 00:00:41,546
and to sell content to your


14
00:00:41,546 --> 00:00:42,036
users.


15
00:00:42,086 --> 00:00:42,956
And to provide a great


16
00:00:42,956 --> 00:00:43,836
experience throughout this


17
00:00:43,836 --> 00:00:44,836
process, is becoming


18
00:00:45,066 --> 00:00:46,576
increasingly important for you


19
00:00:46,576 --> 00:00:47,386
and your business.


20
00:00:48,366 --> 00:00:49,326
Now, we're working on ways for


21
00:00:49,326 --> 00:00:50,416
you to do all of these things,


22
00:00:50,416 --> 00:00:51,476
even more effectively.


23
00:00:51,476 --> 00:00:52,926
And we're here, today, to talk


24
00:00:52,926 --> 00:00:54,056
to you about some enhancements


25
00:00:54,056 --> 00:00:55,016
to the StoreKit framework.


26
00:00:55,746 --> 00:00:57,306
StoreKit is the framework that


27
00:00:57,306 --> 00:00:58,536
powers in-app purchases, amongst


28
00:00:58,586 --> 00:00:59,536
some other store related


29
00:00:59,786 --> 00:01:00,396
abilities.


30
00:01:00,706 --> 00:01:01,376
But we've got some new


31
00:01:01,376 --> 00:01:02,886
advancements in iOS 11.


32
00:01:03,556 --> 00:01:04,635
Firstly, you're going to have


33
00:01:04,635 --> 00:01:05,826
the ability now, to promote your


34
00:01:05,826 --> 00:01:07,496
in-app purchases directly in the


35
00:01:07,496 --> 00:01:08,076
App Store app.


36
00:01:08,606 --> 00:01:09,906
So, a user can buy an in-app


37
00:01:09,906 --> 00:01:11,476
purchase and complete that in


38
00:01:11,476 --> 00:01:12,366
your own application.


39
00:01:13,116 --> 00:01:14,936
Secondly, we're introducing some


40
00:01:14,936 --> 00:01:15,876
enhancements to the


41
00:01:15,876 --> 00:01:17,236
subscription, auto-renewable


42
00:01:17,236 --> 00:01:18,096
subscription flows.


43
00:01:18,306 --> 00:01:19,366
We've got new server to server


44
00:01:19,366 --> 00:01:20,806
subscription notifications.


45
00:01:20,806 --> 00:01:21,966
This is really going to make


46
00:01:21,966 --> 00:01:22,876
your lives easier if you're


47
00:01:22,876 --> 00:01:23,816
dealing with auto-renewable


48
00:01:23,816 --> 00:01:24,516
subscriptions.


49
00:01:24,616 --> 00:01:24,786
Yeah.


50
00:01:25,516 --> 00:01:28,556
[ Applause ]


51
00:01:29,056 --> 00:01:30,376
We've also got some new detailed


52
00:01:30,376 --> 00:01:32,076
subscription status information


53
00:01:32,236 --> 00:01:33,246
when you're dealing with service


54
00:01:33,246 --> 00:01:33,876
side management.


55
00:01:33,876 --> 00:01:34,596
This is going to give you much


56
00:01:34,636 --> 00:01:36,036
greater insight into some of


57
00:01:36,036 --> 00:01:37,186
those business questions about


58
00:01:37,186 --> 00:01:38,506
individual users and their


59
00:01:38,506 --> 00:01:39,426
subscription states.


60
00:01:39,766 --> 00:01:41,976
We also, introduced earlier this


61
00:01:41,976 --> 00:01:43,236
year, the ability for you to


62
00:01:43,236 --> 00:01:44,506
respond to user's reviews on the


63
00:01:44,506 --> 00:01:44,956
App Store.


64
00:01:45,286 --> 00:01:46,426
And along with that, we have


65
00:01:46,426 --> 00:01:47,666
some new enhancements in the


66
00:01:47,666 --> 00:01:49,086
ways you can ask for ratings and


67
00:01:49,086 --> 00:01:49,666
reviews.


68
00:01:50,356 --> 00:01:51,996
Now, before we go into some of


69
00:01:51,996 --> 00:01:53,456
these new features, I'd like to


70
00:01:53,456 --> 00:01:54,966
start with an overview of the


71
00:01:54,966 --> 00:01:56,246
in-app purchase process.


72
00:01:56,286 --> 00:01:57,496
So, let's look at implementing


73
00:01:57,496 --> 00:01:58,456
in-app purchases in your


74
00:01:58,456 --> 00:01:59,046
application.


75
00:02:00,236 --> 00:02:02,386
Now, in app purchases haven't


76
00:02:02,386 --> 00:02:03,156
really changed much.


77
00:02:03,156 --> 00:02:04,546
They were introduced in iOS 3.


78
00:02:04,886 --> 00:02:07,006
An in-app purchase is really the


79
00:02:07,006 --> 00:02:08,175
ability for you to sell digital


80
00:02:08,175 --> 00:02:09,705
content or a service inside your


81
00:02:09,705 --> 00:02:09,816
app.


82
00:02:10,705 --> 00:02:11,716
So, when it comes to physical


83
00:02:11,716 --> 00:02:13,206
goods or services, it's not


84
00:02:13,206 --> 00:02:14,236
really appropriate for in-app


85
00:02:14,236 --> 00:02:14,676
purchases.


86
00:02:14,676 --> 00:02:15,706
We provide things like Apple


87
00:02:15,706 --> 00:02:17,326
Pay, and you can implement your


88
00:02:17,326 --> 00:02:18,256
own payment systems to


89
00:02:18,256 --> 00:02:19,516
accomplish selling physical


90
00:02:19,516 --> 00:02:19,856
goods.


91
00:02:20,016 --> 00:02:20,836
But when it comes to digital


92
00:02:20,836 --> 00:02:22,326
services, that's what in-app


93
00:02:22,326 --> 00:02:24,706
purchases are good for.


94
00:02:24,896 --> 00:02:26,066
We have four different types of


95
00:02:26,066 --> 00:02:27,086
in-app purchases that you can


96
00:02:27,086 --> 00:02:27,466
use.


97
00:02:28,276 --> 00:02:29,706
Firstly, we have consumable


98
00:02:29,706 --> 00:02:30,246
products.


99
00:02:30,486 --> 00:02:31,496
Now, this type of in-app


100
00:02:31,496 --> 00:02:32,666
purchase is the kind of in-app


101
00:02:32,666 --> 00:02:34,176
purchase that can be consumed,


102
00:02:34,176 --> 00:02:35,646
as the name suggests, and used


103
00:02:35,646 --> 00:02:36,306
up by a user.


104
00:02:36,446 --> 00:02:38,226
So, this might be gold coins in


105
00:02:38,226 --> 00:02:39,916
a game that a user buys and


106
00:02:39,916 --> 00:02:40,566
maybe spends.


107
00:02:40,866 --> 00:02:42,066
And it doesn't persist around


108
00:02:42,066 --> 00:02:43,486
subsequent restores or new


109
00:02:43,486 --> 00:02:44,086
devices.


110
00:02:45,176 --> 00:02:46,846
The second kind is a


111
00:02:46,846 --> 00:02:47,986
non-consumable product.


112
00:02:48,456 --> 00:02:50,296
It's a little different than the


113
00:02:50,296 --> 00:02:51,276
consumable product in that it


114
00:02:51,276 --> 00:02:52,026
does persist.


115
00:02:52,026 --> 00:02:52,986
So, this might be more


116
00:02:52,986 --> 00:02:53,956
appropriate for things like


117
00:02:54,446 --> 00:02:55,786
unlocking a pro feature in your


118
00:02:55,786 --> 00:02:56,706
application, or maybe,


119
00:02:56,866 --> 00:02:57,826
downloading a level pack for a


120
00:02:57,826 --> 00:02:57,936
game.


121
00:03:00,346 --> 00:03:01,566
We also offer two different


122
00:03:01,566 --> 00:03:02,866
types of subscription products.


123
00:03:02,866 --> 00:03:04,466
We have the nonrenewing


124
00:03:04,466 --> 00:03:05,206
subscriptions.


125
00:03:05,206 --> 00:03:07,116
Now, as the name suggests, this


126
00:03:07,116 --> 00:03:08,056
is the type of subscription


127
00:03:08,056 --> 00:03:08,626
product that doesn't


128
00:03:08,626 --> 00:03:10,236
automatically charge the user at


129
00:03:10,236 --> 00:03:11,506
the end of the billing period.


130
00:03:11,506 --> 00:03:12,556
You can kind of think of this


131
00:03:12,556 --> 00:03:14,336
one like a consumable product


132
00:03:14,336 --> 00:03:16,316
with an expiry date on it.


133
00:03:16,546 --> 00:03:17,616
And of course, the last type is


134
00:03:17,616 --> 00:03:18,406
the auto-renewable


135
00:03:18,406 --> 00:03:19,256
subscriptions.


136
00:03:20,116 --> 00:03:21,666
So, we open the categories of


137
00:03:21,666 --> 00:03:23,396
auto-renewable subscriptions to


138
00:03:23,616 --> 00:03:24,736
a much wider array of


139
00:03:24,736 --> 00:03:25,576
categories, last year.


140
00:03:25,576 --> 00:03:26,516
And have seen some great uptake


141
00:03:26,516 --> 00:03:26,886
of that.


142
00:03:27,656 --> 00:03:28,766
In this particular talk, we're


143
00:03:28,766 --> 00:03:29,636
just going to focus on these


144
00:03:29,706 --> 00:03:30,906
first two types, though.


145
00:03:30,906 --> 00:03:31,906
Mostly, consumable and


146
00:03:31,906 --> 00:03:32,586
non-consumable.


147
00:03:32,586 --> 00:03:33,686
We're going to be going into


148
00:03:33,686 --> 00:03:35,076
subscriptions in much greater


149
00:03:35,076 --> 00:03:36,456
detail, in the Advanced talk,


150
00:03:36,456 --> 00:03:37,116
this afternoon.


151
00:03:37,336 --> 00:03:39,146
It's at 1:50 p.m. in the Grand


152
00:03:39,146 --> 00:03:39,746
Ballroom A.


153
00:03:39,746 --> 00:03:40,476
So, if you're dealing with


154
00:03:40,696 --> 00:03:42,086
subscriptions in a particularly


155
00:03:42,086 --> 00:03:43,066
service side environment, I


156
00:03:43,066 --> 00:03:44,086
definitely encourage you to come


157
00:03:44,086 --> 00:03:44,746
along to that session.


158
00:03:44,746 --> 00:03:45,526
We've got some great new


159
00:03:45,856 --> 00:03:46,566
enhancements, there.


160
00:03:47,806 --> 00:03:48,836
So, let's look at how to


161
00:03:48,836 --> 00:03:50,266
implement in-app purchases in


162
00:03:50,266 --> 00:03:50,956
your application.


163
00:03:51,896 --> 00:03:53,936
It starts with loading up your


164
00:03:53,936 --> 00:03:55,216
in-app identifiers in your


165
00:03:55,216 --> 00:03:55,716
application.


166
00:03:55,876 --> 00:03:57,166
We're going to dive into each of


167
00:03:57,166 --> 00:03:57,916
these steps in a little more


168
00:03:57,916 --> 00:03:58,336
detail.


169
00:03:58,336 --> 00:03:59,016
But I'll just give you an


170
00:03:59,016 --> 00:03:59,436
overview, now.


171
00:03:59,926 --> 00:04:02,286
Using those in-app identifiers,


172
00:04:02,286 --> 00:04:03,706
you can fetch localized product


173
00:04:03,706 --> 00:04:04,926
information from the App Store.


174
00:04:05,486 --> 00:04:06,876
And once you have that localized


175
00:04:06,876 --> 00:04:08,336
information for the products,


176
00:04:08,886 --> 00:04:10,766
you can display in-app UI to the


177
00:04:10,766 --> 00:04:11,046
user.


178
00:04:11,886 --> 00:04:12,706
This gives the user an


179
00:04:12,706 --> 00:04:14,206
opportunity to tap that Buy


180
00:04:14,206 --> 00:04:15,846
button and agree to purchase it,


181
00:04:16,125 --> 00:04:17,185
at which point it's up to you to


182
00:04:17,185 --> 00:04:19,346
go ahead and request a payment.


183
00:04:20,236 --> 00:04:22,466
The user then, elects to buy


184
00:04:22,466 --> 00:04:23,186
your in-app purchase and


185
00:04:23,186 --> 00:04:24,146
authenticate the payment.


186
00:04:24,746 --> 00:04:25,706
And it's up to you, to then


187
00:04:25,706 --> 00:04:27,036
process the transaction that


188
00:04:27,036 --> 00:04:28,066
comes back from StoreKit.


189
00:04:28,426 --> 00:04:30,836
Once the transaction's been


190
00:04:30,836 --> 00:04:32,436
processed, it's up to you to


191
00:04:32,436 --> 00:04:33,236
unlock the content.


192
00:04:33,236 --> 00:04:34,236
Make that in-app purchase


193
00:04:34,236 --> 00:04:35,106
available to the user.


194
00:04:36,276 --> 00:04:37,886
And finally, the last step is to


195
00:04:37,886 --> 00:04:39,016
finish the transaction.


196
00:04:39,836 --> 00:04:41,406
So, let's dive into the first


197
00:04:41,406 --> 00:04:42,606
step, loading the in-app


198
00:04:42,606 --> 00:04:42,976
identifiers.


199
00:04:45,676 --> 00:04:46,996
The in-app identifiers are


200
00:04:46,996 --> 00:04:48,346
really just kind of product


201
00:04:48,346 --> 00:04:49,796
skews that you set up in iTunes


202
00:04:49,796 --> 00:04:50,146
Connect.


203
00:04:50,496 --> 00:04:51,516
Each product that you sell has


204
00:04:51,516 --> 00:04:52,336
its own identifier.


205
00:04:52,336 --> 00:04:54,006
And when it comes to loading


206
00:04:54,006 --> 00:04:54,966
these in your applications, you


207
00:04:54,966 --> 00:04:56,256
can do it a couple of ways.


208
00:04:56,256 --> 00:04:57,766
Firstly, you can just bake them


209
00:04:57,766 --> 00:04:59,026
directly into your application.


210
00:04:59,376 --> 00:05:00,236
So, in this case, I've just got


211
00:05:00,236 --> 00:05:01,136
an array of strings.


212
00:05:02,066 --> 00:05:03,226
Or the other way, of course, is


213
00:05:03,226 --> 00:05:05,116
to maybe fetch them from your


214
00:05:05,776 --> 00:05:07,256
own server.


215
00:05:07,426 --> 00:05:08,506
Either one of these techniques


216
00:05:08,506 --> 00:05:09,386
will work, but the important


217
00:05:09,386 --> 00:05:10,456
thing is that you just have this


218
00:05:10,456 --> 00:05:11,916
set of strings, these in-app


219
00:05:11,916 --> 00:05:13,536
identifiers that you can use to


220
00:05:13,536 --> 00:05:14,696
go ahead and fetch product


221
00:05:14,696 --> 00:05:15,476
information for.


222
00:05:16,266 --> 00:05:17,766
Which is the next step.


223
00:05:18,716 --> 00:05:21,266
So, if you have these, it's just


224
00:05:21,266 --> 00:05:22,566
a simple step to go ahead and


225
00:05:22,566 --> 00:05:23,766
load up the product information.


226
00:05:23,766 --> 00:05:25,386
Let's look at the code for it.


227
00:05:26,276 --> 00:05:28,546
You take that set of identifiers


228
00:05:28,676 --> 00:05:29,926
and you pass it through to an


229
00:05:29,926 --> 00:05:31,496
SKProductsRequest initializer.


230
00:05:32,726 --> 00:05:34,736
Set a delegate on that request.


231
00:05:34,856 --> 00:05:36,026
And then, just kick it off using


232
00:05:36,516 --> 00:05:38,296
the start method.


233
00:05:38,356 --> 00:05:40,006
Now, you've set a delegate


234
00:05:40,006 --> 00:05:41,156
method on this so you'll get a


235
00:05:41,156 --> 00:05:42,506
response in the didReceive


236
00:05:42,506 --> 00:05:43,496
response callback.


237
00:05:43,496 --> 00:05:46,766
So, inside this callback you'll


238
00:05:46,766 --> 00:05:48,176
receive an array of products


239
00:05:48,216 --> 00:05:49,096
that match those in-app


240
00:05:49,096 --> 00:05:50,926
identifiers that you've sent up


241
00:05:50,926 --> 00:05:51,776
in the request.


242
00:05:52,496 --> 00:05:53,196
Now, you can loop through these


243
00:05:53,236 --> 00:05:53,636
products.


244
00:05:53,636 --> 00:05:54,726
And we'll just highlight some of


245
00:05:54,726 --> 00:05:56,326
the fields that are included on


246
00:05:56,326 --> 00:05:57,766
these product objects.


247
00:05:57,766 --> 00:05:58,976
There's a localized title and a


248
00:05:58,976 --> 00:06:00,716
localized description for that


249
00:06:00,716 --> 00:06:01,096
product.


250
00:06:02,226 --> 00:06:03,486
There's also localized price


251
00:06:03,486 --> 00:06:05,036
information about that product


252
00:06:05,236 --> 00:06:06,386
in the store that, that user's


253
00:06:06,386 --> 00:06:06,946
logged into.


254
00:06:07,526 --> 00:06:09,916
And we also have the information


255
00:06:09,916 --> 00:06:10,986
here, about any downloadable


256
00:06:10,986 --> 00:06:12,566
content that might be associated


257
00:06:12,566 --> 00:06:14,986
with this product.


258
00:06:15,246 --> 00:06:16,736
So, one more important point,


259
00:06:16,736 --> 00:06:17,496
here, just to highlight, is that


260
00:06:17,496 --> 00:06:18,416
you shouldn't cache the


261
00:06:18,416 --> 00:06:19,716
SKProduct that comes back in


262
00:06:19,716 --> 00:06:20,196
this point.


263
00:06:20,736 --> 00:06:22,456
It's really important that you


264
00:06:22,456 --> 00:06:23,336
get up to date product


265
00:06:23,336 --> 00:06:24,746
information, by performing these


266
00:06:24,746 --> 00:06:25,646
requests regularly.


267
00:06:25,976 --> 00:06:27,126
Because things like currency can


268
00:06:27,126 --> 00:06:27,716
fluctuate.


269
00:06:27,926 --> 00:06:29,236
You know, a user might log out,


270
00:06:29,236 --> 00:06:30,256
log into a different store


271
00:06:30,256 --> 00:06:30,516
front.


272
00:06:30,516 --> 00:06:31,656
So, the locale might change.


273
00:06:31,836 --> 00:06:32,976
Make sure that as often as you


274
00:06:32,976 --> 00:06:34,576
need to, you're requesting new


275
00:06:34,576 --> 00:06:35,766
product information from the App


276
00:06:35,766 --> 00:06:36,936
Store, and not holding onto an


277
00:06:36,936 --> 00:06:38,366
instance of these SKProducts.


278
00:06:39,346 --> 00:06:41,046
But now, you have your SKProduct


279
00:06:41,046 --> 00:06:41,966
object and you're ready to go


280
00:06:41,966 --> 00:06:43,636
ahead and show an actual in-app


281
00:06:43,636 --> 00:06:44,476
UI to the user.


282
00:06:45,276 --> 00:06:46,436
So, when it comes to showing the


283
00:06:46,436 --> 00:06:47,706
UI, of course, this is really up


284
00:06:47,706 --> 00:06:48,456
to your application.


285
00:06:48,456 --> 00:06:49,566
And every application's a little


286
00:06:49,566 --> 00:06:50,816
different in how you're going to


287
00:06:50,816 --> 00:06:51,566
present the products to the


288
00:06:51,566 --> 00:06:52,046
users.


289
00:06:52,596 --> 00:06:55,576
It can have a large effect on


290
00:06:55,576 --> 00:06:56,006
sales.


291
00:06:56,006 --> 00:06:56,946
So, I'd encourage you to really


292
00:06:56,946 --> 00:06:57,896
be careful about how you


293
00:06:57,896 --> 00:06:58,576
structure this UI.


294
00:06:58,696 --> 00:07:00,416
And if you want to learn a bit


295
00:07:00,416 --> 00:07:01,226
more about that, we've got some


296
00:07:01,226 --> 00:07:02,396
information online on our


297
00:07:02,396 --> 00:07:03,926
developer website, here, to


298
00:07:03,926 --> 00:07:04,286
check out.


299
00:07:04,286 --> 00:07:05,506
This has useful tips about how


300
00:07:05,506 --> 00:07:06,876
to format this particular page


301
00:07:07,156 --> 00:07:09,106
in a way that can, you know,


302
00:07:09,386 --> 00:07:10,276
improve your sales.


303
00:07:10,786 --> 00:07:13,366
One tip, though, just on


304
00:07:13,436 --> 00:07:14,576
formatting the product price.


305
00:07:14,576 --> 00:07:15,786
So, when it comes to the product


306
00:07:15,786 --> 00:07:17,406
price, this is the technique you


307
00:07:17,406 --> 00:07:18,576
can use to actually display that


308
00:07:18,576 --> 00:07:19,476
in your UI.


309
00:07:19,536 --> 00:07:20,576
Create a number formatter


310
00:07:20,576 --> 00:07:20,956
object.


311
00:07:21,816 --> 00:07:22,966
Set the number style to be the


312
00:07:22,996 --> 00:07:23,906
currency style.


313
00:07:24,616 --> 00:07:26,816
And then, set the locale to be


314
00:07:26,816 --> 00:07:28,146
the product price locale.


315
00:07:28,146 --> 00:07:29,216
Now, this is a really important


316
00:07:29,216 --> 00:07:29,626
step.


317
00:07:29,836 --> 00:07:30,856
Because if you don't do this,


318
00:07:30,856 --> 00:07:31,726
it's going to default to the


319
00:07:31,726 --> 00:07:33,226
system device locale.


320
00:07:33,356 --> 00:07:34,416
Which may not actually match the


321
00:07:34,416 --> 00:07:35,386
store that the user's logged


322
00:07:35,386 --> 00:07:35,706
into.


323
00:07:35,976 --> 00:07:36,806
So, the user might be logged


324
00:07:36,806 --> 00:07:37,676
into say, the Chinese


325
00:07:37,676 --> 00:07:39,436
storefront, but have the device


326
00:07:39,436 --> 00:07:40,416
set to U.S. English.


327
00:07:40,696 --> 00:07:41,486
That's important that all the


328
00:07:41,486 --> 00:07:42,716
pricing and currency stuff


329
00:07:42,876 --> 00:07:44,216
matches what they're seeing in


330
00:07:44,216 --> 00:07:44,756
the App Store.


331
00:07:45,026 --> 00:07:45,936
So, make sure you set the


332
00:07:45,966 --> 00:07:47,606
product's price locale under the


333
00:07:47,606 --> 00:07:48,346
number formatting, here.


334
00:07:49,076 --> 00:07:50,356
But once you've done that, you


335
00:07:50,356 --> 00:07:51,586
can just take a string from the


336
00:07:51,586 --> 00:07:52,946
number formatter, and you've got


337
00:07:52,946 --> 00:07:54,456
yourself a formatted string that


338
00:07:54,456 --> 00:07:56,476
you can display in your UI.


339
00:07:58,396 --> 00:08:00,346
Another point, here, don't


340
00:08:00,546 --> 00:08:01,906
perform any currency conversion


341
00:08:01,906 --> 00:08:02,306
yourself.


342
00:08:02,306 --> 00:08:03,266
There's no need to actually


343
00:08:03,526 --> 00:08:04,396
convert currency.


344
00:08:04,396 --> 00:08:05,926
You can let StoreKit handle all


345
00:08:05,926 --> 00:08:06,436
this for you.


346
00:08:06,716 --> 00:08:07,956
So, just take that number and


347
00:08:08,016 --> 00:08:09,096
price locale that you get and


348
00:08:09,096 --> 00:08:10,066
let the number formatter do the


349
00:08:10,066 --> 00:08:10,556
job for you.


350
00:08:12,456 --> 00:08:13,386
The next step, though, once


351
00:08:13,386 --> 00:08:14,866
you've displayed your UI, is to


352
00:08:14,866 --> 00:08:15,606
request a payment.


353
00:08:15,606 --> 00:08:16,716
So, at this point, hopefully the


354
00:08:16,716 --> 00:08:18,006
user's elected to buy your


355
00:08:18,006 --> 00:08:18,586
in-app purchase.


356
00:08:18,586 --> 00:08:19,606
They've hit that Buy button.


357
00:08:19,856 --> 00:08:21,046
So, at this point it's up to you


358
00:08:21,046 --> 00:08:21,976
to go ahead and request a


359
00:08:21,976 --> 00:08:22,856
payment of the user.


360
00:08:23,726 --> 00:08:24,856
Again, this is a really simple


361
00:08:24,856 --> 00:08:25,076
step.


362
00:08:25,076 --> 00:08:26,066
It's just a couple of lines.


363
00:08:26,636 --> 00:08:28,036
You take that SKProduct that the


364
00:08:28,036 --> 00:08:29,766
user's agreed to buy, pass it


365
00:08:29,766 --> 00:08:32,476
into an SKPayment initializer to


366
00:08:32,476 --> 00:08:33,496
create a payment object.


367
00:08:34,135 --> 00:08:35,496
Then, you add that payment to


368
00:08:35,496 --> 00:08:37,336
the SKPaymentQueue's default


369
00:08:37,336 --> 00:08:37,626
queue.


370
00:08:39,385 --> 00:08:40,306
Now, as soon as you add the


371
00:08:40,306 --> 00:08:41,395
payment to the default queue,


372
00:08:42,155 --> 00:08:44,006
the user sees this great new


373
00:08:44,006 --> 00:08:45,676
looking in-app purchase payment


374
00:08:45,676 --> 00:08:46,006
sheet.


375
00:08:46,006 --> 00:08:47,166
So, this is new in iOS 11.


376
00:08:48,516 --> 00:08:52,806
[ Applause ]


377
00:08:53,306 --> 00:08:54,236
And the user, of course, can


378
00:08:54,236 --> 00:08:55,566
just authenticate the purchase


379
00:08:55,566 --> 00:08:57,336
using Touch ID, and then,


380
00:08:57,336 --> 00:08:58,786
continue using your app.


381
00:08:59,036 --> 00:09:00,026
So, we think this is a much


382
00:09:00,026 --> 00:09:00,926
improved design that's going to


383
00:09:00,926 --> 00:09:02,266
make that experience a lot nicer


384
00:09:02,266 --> 00:09:02,856
for users.


385
00:09:04,126 --> 00:09:04,816
Now, at this point, I'll just


386
00:09:04,816 --> 00:09:05,966
take a quick sidestep to talk a


387
00:09:05,966 --> 00:09:07,396
bit about detecting irregular


388
00:09:07,396 --> 00:09:07,926
activity.


389
00:09:08,476 --> 00:09:09,936
So, the ability to detect


390
00:09:09,936 --> 00:09:11,466
irregular activity gives us


391
00:09:11,466 --> 00:09:12,636
warning signs if potentially


392
00:09:12,636 --> 00:09:13,736
something fishy might be going


393
00:09:13,736 --> 00:09:15,296
on in this particular process.


394
00:09:15,826 --> 00:09:16,986
Now, Apple has an advanced


395
00:09:16,986 --> 00:09:18,446
engine to detect and block


396
00:09:18,446 --> 00:09:19,646
irregular activity before it


397
00:09:19,646 --> 00:09:20,946
happens, in the best cases.


398
00:09:21,446 --> 00:09:22,556
But there are some cases where


399
00:09:22,556 --> 00:09:24,646
this happens after a payment's


400
00:09:24,646 --> 00:09:25,016
gone through.


401
00:09:25,016 --> 00:09:26,266
And it can only detect it after


402
00:09:26,516 --> 00:09:27,016
the fact.


403
00:09:27,916 --> 00:09:29,636
Now, in those cases, we refund


404
00:09:29,836 --> 00:09:30,916
developers or users as


405
00:09:30,916 --> 00:09:31,756
appropriate, but that's not a


406
00:09:31,756 --> 00:09:32,476
great experience.


407
00:09:32,476 --> 00:09:34,116
So, we try to ask for a little


408
00:09:34,116 --> 00:09:35,456
collaboration from you, at this


409
00:09:35,496 --> 00:09:36,956
point, to help us detect these


410
00:09:36,956 --> 00:09:37,676
things a little earlier.


411
00:09:38,456 --> 00:09:39,406
Now, I'll just go through an


412
00:09:39,406 --> 00:09:40,426
illustration that'll probably


413
00:09:41,096 --> 00:09:42,106
demonstrate what I'm talking


414
00:09:42,106 --> 00:09:42,616
about a bit better.


415
00:09:42,616 --> 00:09:45,506
Let's say I have three devices,


416
00:09:45,506 --> 00:09:45,716
here.


417
00:09:46,246 --> 00:09:47,196
Three different users that are


418
00:09:47,196 --> 00:09:48,576
logged into different Apple IDs.


419
00:09:49,486 --> 00:09:50,886
These three users are purchasing


420
00:09:50,886 --> 00:09:52,666
the same gold coin product from


421
00:09:52,666 --> 00:09:53,836
the App Store from your


422
00:09:53,836 --> 00:09:54,396
application.


423
00:09:55,286 --> 00:09:56,356
Now, this is a really normal


424
00:09:56,356 --> 00:09:56,766
scenario.


425
00:09:56,766 --> 00:09:57,936
This happens millions of times


426
00:09:57,936 --> 00:09:58,966
from millions of users around


427
00:09:58,966 --> 00:09:59,676
the world, every day.


428
00:10:00,926 --> 00:10:02,206
But let's add in another piece


429
00:10:02,206 --> 00:10:03,306
of information to this puzzle


430
00:10:03,306 --> 00:10:04,426
that changes the picture, quite


431
00:10:04,426 --> 00:10:04,786
a lot.


432
00:10:05,096 --> 00:10:06,446
Let's say that these three users


433
00:10:06,446 --> 00:10:07,596
buy gold coins in your


434
00:10:07,596 --> 00:10:09,186
application, but all these


435
00:10:09,186 --> 00:10:10,956
separate IDs are actually


436
00:10:10,956 --> 00:10:12,466
cashing these gold coins into


437
00:10:12,466 --> 00:10:14,246
the same game account on your


438
00:10:14,246 --> 00:10:14,506
server.


439
00:10:15,436 --> 00:10:16,416
Suddenly, this picture looks


440
00:10:16,416 --> 00:10:17,366
highly suspicious.


441
00:10:18,786 --> 00:10:19,876
So, how do we detect these sort


442
00:10:19,876 --> 00:10:21,206
of scenarios earlier on in the


443
00:10:21,206 --> 00:10:21,796
process?


444
00:10:22,076 --> 00:10:23,756
We ask you to provide an account


445
00:10:23,756 --> 00:10:25,226
identifier with this payment


446
00:10:25,226 --> 00:10:25,506
step.


447
00:10:26,336 --> 00:10:26,926
Now, this is really for


448
00:10:26,926 --> 00:10:27,986
applications that have their own


449
00:10:27,986 --> 00:10:28,866
account management.


450
00:10:29,256 --> 00:10:30,676
So, if you've got, say, a server


451
00:10:30,676 --> 00:10:31,806
account and a user is logged in


452
00:10:31,806 --> 00:10:32,546
as a particular user.


453
00:10:33,296 --> 00:10:34,576
And we ask for an opaque


454
00:10:34,576 --> 00:10:35,726
identifier at this step.


455
00:10:36,666 --> 00:10:37,646
Now, what is an opaque


456
00:10:37,646 --> 00:10:38,216
identifier?


457
00:10:38,336 --> 00:10:40,176
Well, we don't really want you


458
00:10:40,176 --> 00:10:41,496
to give us actual information


459
00:10:41,496 --> 00:10:41,996
about the user.


460
00:10:41,996 --> 00:10:43,276
We already know the user's Apple


461
00:10:43,366 --> 00:10:44,456
ID, so don't give us that.


462
00:10:44,746 --> 00:10:45,996
We don't want to know what the


463
00:10:45,996 --> 00:10:47,996
actual username is for the user


464
00:10:47,996 --> 00:10:48,756
or the password.


465
00:10:48,756 --> 00:10:49,576
We don't want to know any of


466
00:10:49,576 --> 00:10:49,986
these details.


467
00:10:49,986 --> 00:10:51,226
What we suggest here, is that


468
00:10:51,226 --> 00:10:53,436
you create a hash of the account


469
00:10:53,566 --> 00:10:54,426
name, or something like this,


470
00:10:54,426 --> 00:10:54,596
right.


471
00:10:54,596 --> 00:10:55,686
This just gives us a unique


472
00:10:55,686 --> 00:10:57,126
identifier to be able to match


473
00:10:57,126 --> 00:10:58,656
these payments across different


474
00:10:58,656 --> 00:11:00,286
Apple IDs and associate them


475
00:11:00,286 --> 00:11:00,566
together.


476
00:11:01,456 --> 00:11:03,336
It's a really simple step to be


477
00:11:03,336 --> 00:11:03,716
able to do this.


478
00:11:03,716 --> 00:11:04,746
When you create the SKPayment


479
00:11:04,746 --> 00:11:06,006
that we just saw a moment ago,


480
00:11:06,006 --> 00:11:07,306
there's just an extra step you


481
00:11:07,306 --> 00:11:07,606
can do.


482
00:11:07,606 --> 00:11:08,816
Which is to set the application


483
00:11:08,816 --> 00:11:09,276
username.


484
00:11:09,276 --> 00:11:11,346
And here, you can just set that


485
00:11:11,346 --> 00:11:12,446
hash of the account name, and


486
00:11:12,446 --> 00:11:13,726
that'll just help us detect the


487
00:11:13,726 --> 00:11:14,936
irregular activity earlier on,


488
00:11:14,936 --> 00:11:15,706
in the process.


489
00:11:16,266 --> 00:11:18,516
So, that's a really simple step


490
00:11:18,516 --> 00:11:20,116
you can do to make your payments


491
00:11:20,116 --> 00:11:21,096
a little more secure in your


492
00:11:22,166 --> 00:11:22,233
app.


493
00:11:23,636 --> 00:11:24,726
Once the user's authenticated


494
00:11:24,726 --> 00:11:25,856
they payment, though, the credit


495
00:11:25,856 --> 00:11:26,536
card's charged.


496
00:11:26,846 --> 00:11:27,656
And it's up to you to go ahead


497
00:11:27,656 --> 00:11:29,016
and process the transaction that


498
00:11:29,016 --> 00:11:30,466
comes down from StoreKit.


499
00:11:31,236 --> 00:11:32,216
So, let's see what that looks


500
00:11:32,216 --> 00:11:32,456
like.


501
00:11:33,016 --> 00:11:33,976
Right at the beginning of your


502
00:11:33,976 --> 00:11:35,056
application lifecycle.


503
00:11:35,176 --> 00:11:36,806
And here, I'm doing it at the


504
00:11:36,806 --> 00:11:38,576
didFinishLaunchingWithOptions


505
00:11:38,856 --> 00:11:39,826
app delegate method.


506
00:11:40,146 --> 00:11:41,346
It's important to set a


507
00:11:41,346 --> 00:11:43,116
transaction observer onto the


508
00:11:43,116 --> 00:11:44,036
SKPayment queue.


509
00:11:44,846 --> 00:11:46,296
Now, here I'm adding the actual


510
00:11:46,296 --> 00:11:47,736
AppDelegate, itself, as my


511
00:11:47,736 --> 00:11:49,426
SKPayment transaction observer.


512
00:11:49,426 --> 00:11:50,826
But you could use another object


513
00:11:50,826 --> 00:11:51,826
if you want to actually monitor


514
00:11:51,826 --> 00:11:52,636
these transactions.


515
00:11:52,906 --> 00:11:53,976
The really important thing here,


516
00:11:53,976 --> 00:11:55,036
is that it's happening as early


517
00:11:55,036 --> 00:11:56,476
on in the application lifecycle,


518
00:11:56,476 --> 00:11:56,936
as possible.


519
00:11:57,576 --> 00:11:59,016
See, transactions can come into


520
00:11:59,256 --> 00:12:00,906
this transaction observer any


521
00:12:00,906 --> 00:12:02,326
point during your application


522
00:12:02,326 --> 00:12:02,696
lifecycle.


523
00:12:02,696 --> 00:12:03,576
So, make sure that you're


524
00:12:03,576 --> 00:12:04,386
registering it right at the


525
00:12:04,386 --> 00:12:04,756
start.


526
00:12:05,826 --> 00:12:07,006
But once that's registered,


527
00:12:07,226 --> 00:12:08,296
you're ready to start receiving


528
00:12:08,296 --> 00:12:09,766
transactions in the callbacks.


529
00:12:10,616 --> 00:12:11,636
There's this one callback


530
00:12:11,636 --> 00:12:13,036
updated transactions, which is


531
00:12:13,256 --> 00:12:14,526
kind of the center of where this


532
00:12:14,526 --> 00:12:15,176
all happens.


533
00:12:16,076 --> 00:12:16,836
You receive an array of


534
00:12:16,836 --> 00:12:18,076
transactions that come in, and


535
00:12:18,076 --> 00:12:19,496
you can check the transaction


536
00:12:19,496 --> 00:12:20,306
state on each of these


537
00:12:20,306 --> 00:12:20,996
transactions.


538
00:12:21,836 --> 00:12:22,686
And you'll look for a


539
00:12:22,686 --> 00:12:23,956
transaction in the purchased


540
00:12:24,046 --> 00:12:24,416
state.


541
00:12:25,026 --> 00:12:26,006
This is a transaction that's


542
00:12:26,006 --> 00:12:27,386
StoreKit deems appropriate for


543
00:12:27,386 --> 00:12:29,036
you to go ahead and check for


544
00:12:29,036 --> 00:12:31,106
validity and unlock content for,


545
00:12:31,106 --> 00:12:31,616
accordingly.


546
00:12:32,696 --> 00:12:33,986
There are some other states


547
00:12:33,986 --> 00:12:35,206
here, that we won't go into in


548
00:12:35,206 --> 00:12:35,616
this talk.


549
00:12:35,616 --> 00:12:36,876
But one of the ones that I will


550
00:12:36,876 --> 00:12:38,256
call out, is the deferred state.


551
00:12:38,806 --> 00:12:41,216
A transaction can come through


552
00:12:41,216 --> 00:12:42,256
in a deferred state if the user


553
00:12:42,256 --> 00:12:43,766
has asked to buy turned on.


554
00:12:44,726 --> 00:12:46,566
So, a child might ask to buy an


555
00:12:46,566 --> 00:12:48,046
in-app purchase and a request


556
00:12:48,046 --> 00:12:49,106
goes to their parent for


557
00:12:49,106 --> 00:12:50,256
approval to actually approve the


558
00:12:50,256 --> 00:12:50,826
purchase.


559
00:12:51,206 --> 00:12:52,096
And that could take anywhere


560
00:12:52,096 --> 00:12:54,196
between seconds, minutes, weeks,


561
00:12:54,466 --> 00:12:55,136
who knows how long.


562
00:12:55,136 --> 00:12:56,496
So, it's important if something


563
00:12:56,496 --> 00:12:57,546
comes through in this deferred


564
00:12:57,546 --> 00:12:58,596
state, while they're waiting for


565
00:12:58,596 --> 00:12:59,746
an approval, that you allow


566
00:12:59,976 --> 00:13:00,976
access to the application.


567
00:13:00,976 --> 00:13:02,096
Allow them to keep using your


568
00:13:02,096 --> 00:13:03,196
app, and don't let them get


569
00:13:03,196 --> 00:13:04,606
stuck on any kind of modal


570
00:13:04,606 --> 00:13:05,986
loading spinners or things like


571
00:13:06,016 --> 00:13:06,256
that.


572
00:13:06,886 --> 00:13:07,946
The transaction will eventually


573
00:13:07,946 --> 00:13:09,026
come through as a purchased one,


574
00:13:09,026 --> 00:13:09,946
once it does get approved.


575
00:13:09,946 --> 00:13:11,156
And you can just handle it like


576
00:13:11,156 --> 00:13:12,166
any purchase transaction.


577
00:13:13,476 --> 00:13:15,556
In order to test out deferred


578
00:13:15,556 --> 00:13:16,686
transactions, we provide a way


579
00:13:16,686 --> 00:13:17,366
for you to do this.


580
00:13:17,566 --> 00:13:18,886
You can create a mutable payment


581
00:13:18,886 --> 00:13:19,326
object.


582
00:13:20,086 --> 00:13:20,706
And you can set the


583
00:13:20,706 --> 00:13:22,666
simulatesAskToBuy flag on this


584
00:13:22,666 --> 00:13:23,056
object.


585
00:13:23,336 --> 00:13:24,286
Now, this is effective when


586
00:13:24,286 --> 00:13:25,176
you're using the Sandbox


587
00:13:25,176 --> 00:13:25,756
environment.


588
00:13:25,986 --> 00:13:26,706
We're not going to go into the


589
00:13:26,706 --> 00:13:27,796
Sandbox as much, this talk.


590
00:13:27,796 --> 00:13:29,196
But this is what it looks like,


591
00:13:29,196 --> 00:13:29,576
in code.


592
00:13:29,576 --> 00:13:31,726
You just set that


593
00:13:31,926 --> 00:13:33,676
simulatesAskToBuyInSandbox flag


594
00:13:33,676 --> 00:13:34,096
to true.


595
00:13:34,096 --> 00:13:35,116
And this just means that when


596
00:13:35,266 --> 00:13:36,696
you're testing out developing


597
00:13:36,696 --> 00:13:37,696
in-app purchases, this


598
00:13:37,696 --> 00:13:38,826
particular transaction's going


599
00:13:38,826 --> 00:13:40,236
to come through in the updated


600
00:13:40,236 --> 00:13:41,926
transactions call a deferred


601
00:13:41,926 --> 00:13:42,456
transaction.


602
00:13:42,456 --> 00:13:43,736
So, you can just test out how


603
00:13:43,736 --> 00:13:44,776
you handle those particular


604
00:13:44,776 --> 00:13:45,276
cases.


605
00:13:45,276 --> 00:13:48,326
When it comes to handling


606
00:13:48,326 --> 00:13:49,826
errors, couple of points to


607
00:13:49,826 --> 00:13:50,106
remember.


608
00:13:50,106 --> 00:13:51,326
Now, not all errors that come


609
00:13:51,326 --> 00:13:52,626
through this process are equal.


610
00:13:53,216 --> 00:13:54,256
And that means you really need


611
00:13:54,256 --> 00:13:55,176
to pay attention to the error


612
00:13:55,176 --> 00:13:56,536
code that comes through with a


613
00:13:56,536 --> 00:13:57,196
transaction.


614
00:13:57,706 --> 00:13:59,296
So, maybe don't show an alert


615
00:13:59,296 --> 00:14:00,766
unless it's absolutely necessary


616
00:14:00,766 --> 00:14:01,836
to inform your user of a


617
00:14:01,836 --> 00:14:02,396
particular error.


618
00:14:03,066 --> 00:14:04,016
You know, we see things like


619
00:14:04,276 --> 00:14:05,756
maybe a user cancels a payment,


620
00:14:05,966 --> 00:14:07,686
which has a specific error code.


621
00:14:08,276 --> 00:14:09,126
And you don't need to show an


622
00:14:09,126 --> 00:14:10,486
alert that says user cancelled


623
00:14:10,536 --> 00:14:11,026
to the user.


624
00:14:11,106 --> 00:14:12,296
You know, they hit the Cancel


625
00:14:12,296 --> 00:14:12,956
button, they know they


626
00:14:12,956 --> 00:14:13,426
cancelled.


627
00:14:13,876 --> 00:14:14,616
You don't need to let them know,


628
00:14:14,616 --> 00:14:14,836
again.


629
00:14:15,386 --> 00:14:17,326
It's also important to let


630
00:14:17,326 --> 00:14:18,706
StoreKit handle the transaction


631
00:14:18,706 --> 00:14:19,786
flow as much as possible.


632
00:14:20,276 --> 00:14:21,296
And this means that you don't


633
00:14:21,296 --> 00:14:22,646
need to ask for confirmation for


634
00:14:22,646 --> 00:14:23,676
things like in-app purchases,


635
00:14:23,676 --> 00:14:25,386
once they elect to buy it.


636
00:14:25,386 --> 00:14:26,446
We have that nice new payment


637
00:14:26,446 --> 00:14:27,376
sheet to do that for you.


638
00:14:27,546 --> 00:14:28,716
And you can let StoreKit handle


639
00:14:29,346 --> 00:14:29,486
that.


640
00:14:30,276 --> 00:14:32,056
Now, once a transaction comes


641
00:14:32,106 --> 00:14:33,416
through in the purchase state, I


642
00:14:33,416 --> 00:14:34,436
mentioned that it's important


643
00:14:34,436 --> 00:14:35,616
for you to verify that


644
00:14:35,616 --> 00:14:36,186
transaction.


645
00:14:36,456 --> 00:14:37,216
How do we do that?


646
00:14:37,216 --> 00:14:38,696
How are we sure that money has


647
00:14:38,696 --> 00:14:39,786
actually changed hands?


648
00:14:39,786 --> 00:14:41,566
Well, we use the application


649
00:14:41,566 --> 00:14:43,776
receipt to do this.


650
00:14:44,136 --> 00:14:45,216
This application receipt is


651
00:14:45,216 --> 00:14:46,386
really just like any receipt you


652
00:14:46,386 --> 00:14:47,486
get in the department store.


653
00:14:47,786 --> 00:14:49,936
It's a proof of purchase that is


654
00:14:49,936 --> 00:14:51,286
evidence that the user has


655
00:14:51,286 --> 00:14:52,276
bought something they say


656
00:14:52,276 --> 00:14:52,816
they've bought.


657
00:14:52,936 --> 00:14:55,316
So, in this particular case,


658
00:14:55,316 --> 00:14:56,976
it's a trusted record of the app


659
00:14:56,976 --> 00:14:58,086
and any in-app purchases that


660
00:14:58,086 --> 00:14:59,096
have occurred for a particular


661
00:14:59,096 --> 00:14:59,616
application.


662
00:15:00,416 --> 00:15:01,556
Every app actually has an app


663
00:15:01,556 --> 00:15:02,596
receipt, because it includes


664
00:15:02,596 --> 00:15:03,906
information about initial app


665
00:15:03,906 --> 00:15:06,116
purchases and even information


666
00:15:06,176 --> 00:15:07,366
about the original free app


667
00:15:07,416 --> 00:15:08,156
downloads, as well.


668
00:15:08,946 --> 00:15:10,556
This document's stored on the


669
00:15:10,556 --> 00:15:12,246
user's device, and it's issued


670
00:15:12,246 --> 00:15:13,376
and put there by the App Store.


671
00:15:14,236 --> 00:15:15,466
And it's also a signed and


672
00:15:15,466 --> 00:15:16,476
verifiable document.


673
00:15:16,476 --> 00:15:17,696
So, you can be sure that this is


674
00:15:17,696 --> 00:15:19,026
a document issued by Apple.


675
00:15:19,206 --> 00:15:20,766
And you can use certificates to


676
00:15:20,766 --> 00:15:22,006
actually check that that's the


677
00:15:22,006 --> 00:15:22,406
case.


678
00:15:23,626 --> 00:15:25,366
Finally, it's for your app, on


679
00:15:25,366 --> 00:15:26,306
that device only.


680
00:15:26,306 --> 00:15:27,756
So, this receipt document can't


681
00:15:27,756 --> 00:15:29,006
be shared across devices.


682
00:15:29,006 --> 00:15:30,396
And it can't be shared amongst


683
00:15:30,396 --> 00:15:31,976
applications on the same device.


684
00:15:33,386 --> 00:15:34,506
Now, to be sure that the


685
00:15:34,506 --> 00:15:35,606
document that you're using to


686
00:15:35,606 --> 00:15:36,796
check these transactions is


687
00:15:36,946 --> 00:15:38,056
indeed a valid one, you do what


688
00:15:38,056 --> 00:15:39,306
we call receipt validation.


689
00:15:40,026 --> 00:15:41,186
Receipt validation can be done a


690
00:15:41,186 --> 00:15:41,946
couple of ways.


691
00:15:42,426 --> 00:15:43,696
You can do it directly on the


692
00:15:43,696 --> 00:15:45,236
user's device using on device


693
00:15:45,236 --> 00:15:45,966
validation.


694
00:15:45,966 --> 00:15:46,906
And you can unlock features,


695
00:15:46,906 --> 00:15:47,416
accordingly.


696
00:15:48,306 --> 00:15:49,746
Well, the other way is to use


697
00:15:49,746 --> 00:15:50,966
server to server validation.


698
00:15:51,046 --> 00:15:52,386
So, you can take that encrypted


699
00:15:52,386 --> 00:15:53,956
receipt data, and you can send


700
00:15:53,956 --> 00:15:54,836
it up to your server.


701
00:15:55,266 --> 00:15:56,526
And from there you can send it


702
00:15:56,526 --> 00:15:57,656
over to the App Store server, in


703
00:15:57,656 --> 00:15:59,066
order to perform some of those


704
00:15:59,066 --> 00:15:59,666
checks for you.


705
00:15:59,666 --> 00:16:02,076
We're not going to go into the


706
00:16:02,076 --> 00:16:03,006
details about receipt


707
00:16:03,006 --> 00:16:03,476
validation.


708
00:16:03,476 --> 00:16:04,616
And this talk that's going to be


709
00:16:04,616 --> 00:16:05,426
talked about, again, in the


710
00:16:05,426 --> 00:16:06,176
Advanced Session, this


711
00:16:06,176 --> 00:16:06,676
afternoon.


712
00:16:06,676 --> 00:16:07,866
I'm going to talk about you


713
00:16:07,866 --> 00:16:08,776
know, how to read in this


714
00:16:08,776 --> 00:16:10,246
receipt data from the device.


715
00:16:10,246 --> 00:16:11,276
And also, how to do the server


716
00:16:11,276 --> 00:16:13,236
to server exchanges for that,


717
00:16:13,236 --> 00:16:13,436
too.


718
00:16:14,416 --> 00:16:16,156
But once you've confirmed that


719
00:16:16,156 --> 00:16:17,236
this receipt is an authentic


720
00:16:17,236 --> 00:16:18,796
document, you can go ahead and


721
00:16:18,796 --> 00:16:20,586
read in transactions and ensure


722
00:16:20,586 --> 00:16:21,696
that this transaction that's


723
00:16:21,696 --> 00:16:22,846
come through in this process is


724
00:16:22,846 --> 00:16:23,786
present in the receipt.


725
00:16:23,786 --> 00:16:24,816
And that means that you've got a


726
00:16:24,816 --> 00:16:26,776
valid purchase ready to go ahead


727
00:16:26,776 --> 00:16:28,976
with for the next step.


728
00:16:29,096 --> 00:16:30,486
Which is to unlock the content


729
00:16:30,486 --> 00:16:31,456
for your in-app purchase.


730
00:16:31,896 --> 00:16:32,706
This is, obviously, a pretty


731
00:16:32,706 --> 00:16:33,276
important step.


732
00:16:34,006 --> 00:16:35,116
To make the functionality that


733
00:16:35,116 --> 00:16:36,396
the user's bought, available to


734
00:16:36,396 --> 00:16:36,746
the user.


735
00:16:37,196 --> 00:16:38,346
This is the step where you might


736
00:16:38,346 --> 00:16:39,776
download any additional content


737
00:16:39,776 --> 00:16:40,686
and make it available to the


738
00:16:40,686 --> 00:16:40,996
user.


739
00:16:41,816 --> 00:16:43,256
If you are downloading content


740
00:16:43,256 --> 00:16:44,176
for in-app purchases, there's a


741
00:16:44,176 --> 00:16:46,976
couple of ways you can do this.


742
00:16:47,176 --> 00:16:48,676
Apple actually offers two


743
00:16:48,676 --> 00:16:50,106
techniques for you to use, as


744
00:16:50,106 --> 00:16:50,456
well.


745
00:16:50,526 --> 00:16:52,306
We have on-demand resources,


746
00:16:52,306 --> 00:16:53,206
which is an API that we


747
00:16:53,206 --> 00:16:54,166
introduced a couple of years,


748
00:16:54,166 --> 00:16:54,416
ago.


749
00:16:54,776 --> 00:16:55,916
And we also have what I


750
00:16:55,916 --> 00:16:56,466
mentioned earlier.


751
00:16:56,466 --> 00:16:57,856
The hosted in-app purchase


752
00:16:58,066 --> 00:16:59,016
downloadable content.


753
00:16:59,016 --> 00:17:00,096
So, you can associate


754
00:17:00,096 --> 00:17:01,636
downloadable content through


755
00:17:01,686 --> 00:17:03,726
iTunes Connect that's accessed


756
00:17:03,786 --> 00:17:05,406
through the SKProduct object,


757
00:17:05,406 --> 00:17:05,846
directly.


758
00:17:06,566 --> 00:17:07,996
Of course, the other way is just


759
00:17:08,326 --> 00:17:09,386
to host the content, yourself,


760
00:17:09,386 --> 00:17:10,026
on your own server.


761
00:17:10,445 --> 00:17:11,336
Which is perfectly okay.


762
00:17:11,336 --> 00:17:12,556
But if you do that, I just


763
00:17:12,556 --> 00:17:13,506
encourage you to remember to use


764
00:17:13,506 --> 00:17:14,506
the appropriate background


765
00:17:14,705 --> 00:17:15,675
downloading APIs.


766
00:17:15,675 --> 00:17:17,425
Use NSURL session to make sure


767
00:17:17,425 --> 00:17:18,606
that these downloads aren't


768
00:17:18,606 --> 00:17:19,415
interrupted, you know, when a


769
00:17:19,415 --> 00:17:20,945
user exits your application.


770
00:17:22,195 --> 00:17:23,766
Once you've unlocked your


771
00:17:23,766 --> 00:17:25,106
content, maybe you've made that


772
00:17:25,165 --> 00:17:26,576
pro version of your application


773
00:17:26,576 --> 00:17:27,406
available to the user.


774
00:17:28,226 --> 00:17:29,406
You can go ahead and finish the


775
00:17:29,406 --> 00:17:29,956
transaction.


776
00:17:29,956 --> 00:17:30,816
This is the last step in


777
00:17:30,816 --> 00:17:32,056
implementing in-app purchases.


778
00:17:32,606 --> 00:17:34,426
So, it's important to finish all


779
00:17:34,426 --> 00:17:35,656
transactions that come through


780
00:17:35,656 --> 00:17:36,196
this process.


781
00:17:36,196 --> 00:17:37,296
Even if they're in like an error


782
00:17:37,296 --> 00:17:38,606
state, you got to finish all


783
00:17:38,606 --> 00:17:39,726
transactions that come through


784
00:17:39,726 --> 00:17:40,236
in this flow.


785
00:17:40,636 --> 00:17:41,546
And that includes when you're


786
00:17:41,546 --> 00:17:42,546
dealing with auto-renewable


787
00:17:42,546 --> 00:17:43,126
subscriptions.


788
00:17:43,126 --> 00:17:45,406
Any renewal transactions that


789
00:17:45,406 --> 00:17:46,566
come in this flow, as well.


790
00:17:46,566 --> 00:17:48,516
So, any of those, billing period


791
00:17:48,516 --> 00:17:49,906
renewals that come through, you


792
00:17:49,906 --> 00:17:50,886
have to make sure you take all


793
00:17:50,886 --> 00:17:52,216
of these through this process to


794
00:17:52,266 --> 00:17:52,716
finish them.


795
00:17:53,776 --> 00:17:55,566
If you don't finish the


796
00:17:55,566 --> 00:17:56,466
transaction, they actually


797
00:17:56,466 --> 00:17:57,496
remain on the payment queue.


798
00:17:57,496 --> 00:17:58,196
And they're going to keep on


799
00:17:58,256 --> 00:17:59,436
popping up in that updated


800
00:17:59,436 --> 00:18:01,006
transactions callback on every


801
00:18:01,006 --> 00:18:01,616
app launch.


802
00:18:01,826 --> 00:18:02,626
So, make sure that you are


803
00:18:02,626 --> 00:18:03,776
finishing them properly and


804
00:18:03,776 --> 00:18:04,796
getting them out of that payment


805
00:18:04,796 --> 00:18:05,026
queue.


806
00:18:05,726 --> 00:18:06,516
In fact, when it comes to


807
00:18:06,516 --> 00:18:07,626
auto-renewable subscriptions,


808
00:18:07,626 --> 00:18:09,646
we've got some details around


809
00:18:09,646 --> 00:18:11,756
billing retry that relies on up


810
00:18:11,756 --> 00:18:13,026
to date knowledge around the


811
00:18:13,026 --> 00:18:14,126
state of all these renewal


812
00:18:14,126 --> 00:18:14,816
transactions.


813
00:18:15,036 --> 00:18:16,066
So, It's really important that


814
00:18:16,066 --> 00:18:18,656
you do keep these finished and


815
00:18:18,656 --> 00:18:19,266
up to date.


816
00:18:20,316 --> 00:18:21,946
When it comes to finishing them,


817
00:18:21,946 --> 00:18:22,846
it's actually just one line of


818
00:18:22,846 --> 00:18:23,096
code.


819
00:18:23,096 --> 00:18:24,426
So, there's no excuses.


820
00:18:24,776 --> 00:18:25,876
You just pass the transaction


821
00:18:25,876 --> 00:18:26,436
through to the finished


822
00:18:26,436 --> 00:18:27,346
transaction callback.


823
00:18:27,666 --> 00:18:28,996
This is a API on the


824
00:18:28,996 --> 00:18:30,326
SKPaymentQueue's default queue.


825
00:18:30,886 --> 00:18:33,406
But once you do that, you've


826
00:18:33,406 --> 00:18:34,916
finished the transaction, that's


827
00:18:34,916 --> 00:18:35,906
the last step in actually


828
00:18:35,906 --> 00:18:36,986
implementing the in-app purchase


829
00:18:36,986 --> 00:18:37,736
flow on a device.


830
00:18:37,736 --> 00:18:39,686
So, the user's now got access to


831
00:18:39,686 --> 00:18:40,546
that in-app purchase that


832
00:18:40,546 --> 00:18:41,156
they've paid for.


833
00:18:42,316 --> 00:18:43,476
A couple of tips just while


834
00:18:43,476 --> 00:18:44,136
we're on the subject.


835
00:18:44,406 --> 00:18:46,056
When you're in app review, you


836
00:18:46,056 --> 00:18:47,576
must have a Restore button if


837
00:18:47,576 --> 00:18:50,376
you've got non-consumable or


838
00:18:50,376 --> 00:18:51,636
auto-renewable subscription


839
00:18:51,636 --> 00:18:52,706
products in your application.


840
00:18:52,706 --> 00:18:54,236
And this Restore button has to


841
00:18:54,236 --> 00:18:55,836
be a separate button from the


842
00:18:55,836 --> 00:18:56,876
actual purchase button.


843
00:18:57,186 --> 00:18:58,096
So, it can be somewhere in your


844
00:18:58,096 --> 00:18:58,806
app, maybe buried in your


845
00:18:58,806 --> 00:18:59,476
settings, somewhere.


846
00:18:59,476 --> 00:19:01,656
But it's just a tool to allow


847
00:19:01,656 --> 00:19:02,766
users to restore completed


848
00:19:02,766 --> 00:19:03,366
transactions.


849
00:19:03,366 --> 00:19:04,946
And it's not just a backup tool.


850
00:19:05,156 --> 00:19:06,406
You know. People use this all


851
00:19:06,406 --> 00:19:07,196
the time when they're dealing


852
00:19:07,196 --> 00:19:08,206
with maybe a new device.


853
00:19:08,206 --> 00:19:09,206
If they go and buy a new iPad,


854
00:19:09,206 --> 00:19:10,726
and they want to unlock the


855
00:19:10,726 --> 00:19:12,246
content that they've paid for on


856
00:19:12,246 --> 00:19:12,756
their phone.


857
00:19:13,096 --> 00:19:13,836
They use that Restore


858
00:19:13,836 --> 00:19:15,016
Transactions feature to be able


859
00:19:15,016 --> 00:19:15,466
to do that.


860
00:19:15,466 --> 00:19:16,416
So, it's important you have a


861
00:19:16,416 --> 00:19:17,696
Restore Transactions button,


862
00:19:17,696 --> 00:19:19,216
somewhere in your application.


863
00:19:20,056 --> 00:19:21,166
As I mentioned, though, it does


864
00:19:21,166 --> 00:19:22,436
only restore transactions for


865
00:19:22,436 --> 00:19:23,366
non-consumable and


866
00:19:23,366 --> 00:19:24,816
auto-renewable subscription


867
00:19:24,816 --> 00:19:25,276
products.


868
00:19:25,896 --> 00:19:27,106
So, if you're selling consumable


869
00:19:27,106 --> 00:19:28,206
products or non-renewing


870
00:19:28,206 --> 00:19:29,336
subscriptions, you've got to


871
00:19:29,336 --> 00:19:30,346
persist the state of those


872
00:19:30,346 --> 00:19:31,136
things, yourself.


873
00:19:31,386 --> 00:19:32,246
So, maybe you've got a game


874
00:19:32,246 --> 00:19:33,616
account, you might associate it


875
00:19:33,616 --> 00:19:34,636
with that account information


876
00:19:34,636 --> 00:19:35,676
somewhere on your own server.


877
00:19:35,816 --> 00:19:38,686
In order to actually restore


878
00:19:38,686 --> 00:19:40,066
them, this is the API for it.


879
00:19:40,996 --> 00:19:41,096
It's


880
00:19:41,096 --> 00:19:42,696
restoreCompletedTransactions as


881
00:19:42,696 --> 00:19:43,446
the method, and it's on the


882
00:19:43,446 --> 00:19:44,346
default payment queue.


883
00:19:44,896 --> 00:19:46,406
If you call that, that's going


884
00:19:46,406 --> 00:19:47,686
to cause all the completed


885
00:19:47,686 --> 00:19:49,006
transactions in those categories


886
00:19:49,196 --> 00:19:50,686
to reappear on the updated


887
00:19:50,686 --> 00:19:51,656
transactions callback.


888
00:19:51,996 --> 00:19:52,956
So, you can just do the same


889
00:19:52,956 --> 00:19:54,886
process that we just saw, check


890
00:19:54,886 --> 00:19:55,876
for them being in the purchase


891
00:19:55,876 --> 00:19:57,276
state, do receipt validation,


892
00:19:57,276 --> 00:19:58,296
unlock all the features


893
00:19:58,296 --> 00:19:58,816
accordingly.


894
00:20:00,116 --> 00:20:01,346
There's a couple more APIs


895
00:20:01,346 --> 00:20:02,456
around the restoring completed


896
00:20:02,456 --> 00:20:02,976
transactions.


897
00:20:03,096 --> 00:20:04,356
You can understand if it's


898
00:20:04,356 --> 00:20:05,516
finished or if there was an


899
00:20:05,516 --> 00:20:06,716
error with a particular process.


900
00:20:06,766 --> 00:20:08,466
But the real thing to do, here,


901
00:20:08,466 --> 00:20:09,356
is just if you have a


902
00:20:09,356 --> 00:20:10,696
transaction observer registered


903
00:20:10,696 --> 00:20:11,836
early on in your application.


904
00:20:11,836 --> 00:20:13,056
You can just handle all of these


905
00:20:13,056 --> 00:20:14,106
transactions as they come


906
00:20:14,106 --> 00:20:15,366
through that updated


907
00:20:15,366 --> 00:20:16,366
transactions callback.


908
00:20:18,276 --> 00:20:20,316
So, just to summarize this


909
00:20:20,316 --> 00:20:21,316
process that we just talked


910
00:20:21,316 --> 00:20:21,656
about.


911
00:20:21,656 --> 00:20:22,876
Always observe the payment queue


912
00:20:22,876 --> 00:20:23,786
and make sure you're doing it as


913
00:20:23,786 --> 00:20:25,176
early on in your application


914
00:20:25,176 --> 00:20:27,476
lifecycle, as possible.


915
00:20:27,476 --> 00:20:28,756
Use an SKProducts request to


916
00:20:28,756 --> 00:20:30,546
request localized information


917
00:20:30,776 --> 00:20:31,876
about the products from the App


918
00:20:31,876 --> 00:20:32,266
Store.


919
00:20:32,516 --> 00:20:33,386
And use that to display


920
00:20:33,386 --> 00:20:34,946
localized pricing information.


921
00:20:35,266 --> 00:20:36,246
Use that technique we just saw


922
00:20:36,246 --> 00:20:37,156
with the number formatter, to


923
00:20:37,156 --> 00:20:38,816
make sure that your price is


924
00:20:38,816 --> 00:20:40,196
being displayed in the user's


925
00:20:40,906 --> 00:20:42,056
store locale.


926
00:20:42,206 --> 00:20:44,996
Use the receipt to actually


927
00:20:44,996 --> 00:20:46,276
validate that the purchase has


928
00:20:46,276 --> 00:20:47,106
taken place.


929
00:20:47,696 --> 00:20:49,256
This is an important security


930
00:20:49,256 --> 00:20:50,506
step and we'll talk a bit more


931
00:20:50,506 --> 00:20:51,476
about that, this afternoon.


932
00:20:51,576 --> 00:20:53,176
You got to remember to make the


933
00:20:53,176 --> 00:20:54,526
content available to the user.


934
00:20:54,526 --> 00:20:55,566
So, make sure they get what


935
00:20:55,566 --> 00:20:56,186
they've paid for.


936
00:20:57,326 --> 00:20:59,186
And then, finish the transaction


937
00:20:59,186 --> 00:21:00,306
at the end of this process.


938
00:21:00,416 --> 00:21:01,096
Make sure that you call


939
00:21:01,096 --> 00:21:02,376
finishTransaction and pass in


940
00:21:02,376 --> 00:21:03,366
that transaction object.


941
00:21:03,706 --> 00:21:04,616
And then, somewhere in your app,


942
00:21:04,846 --> 00:21:06,376
have a Restore button to allow


943
00:21:06,376 --> 00:21:08,026
users to restore completed


944
00:21:08,026 --> 00:21:09,676
transactions onto that device.


945
00:21:10,596 --> 00:21:11,616
So, that's a bit about


946
00:21:11,956 --> 00:21:13,236
implementing in-app purchases


947
00:21:13,406 --> 00:21:14,236
and that process.


948
00:21:14,896 --> 00:21:16,486
Next, we're going to discuss the


949
00:21:16,486 --> 00:21:17,836
new ability to promote in-app


950
00:21:18,106 --> 00:21:19,346
purchases, directly in the App


951
00:21:19,346 --> 00:21:19,886
Store app.


952
00:21:20,146 --> 00:21:21,126
And to talk a bit more about


953
00:21:21,126 --> 00:21:22,246
that, I'd like to invite Ross


954
00:21:22,246 --> 00:21:23,346
LeBeau up onto the stage.


955
00:21:24,516 --> 00:21:32,946
[ Applause ]


956
00:21:33,446 --> 00:21:34,386
>> Hi. I'm Ross.


957
00:21:34,386 --> 00:21:36,046
I'm an engineer on the App Store


958
00:21:36,046 --> 00:21:36,306
team.


959
00:21:37,156 --> 00:21:38,646
And today, I'm excited to tell


960
00:21:38,646 --> 00:21:39,686
you about our latest addition to


961
00:21:39,686 --> 00:21:40,206
the App Store.


962
00:21:41,376 --> 00:21:42,336
It's called Promoting In-App


963
00:21:42,336 --> 00:21:42,906
Purchases.


964
00:21:43,446 --> 00:21:44,546
And it's a great way to reach an


965
00:21:44,546 --> 00:21:45,426
even wider audience with


966
00:21:45,426 --> 00:21:46,226
everything your app has to


967
00:21:46,226 --> 00:21:46,546
offer.


968
00:21:49,166 --> 00:21:50,716
So, before today, if a user


969
00:21:50,716 --> 00:21:51,926
wasn't actively using your app,


970
00:21:52,436 --> 00:21:53,256
your in-app purchases were


971
00:21:53,256 --> 00:21:54,066
pretty hard to find.


972
00:21:55,496 --> 00:21:57,496
But starting in iOS 11, your


973
00:21:57,496 --> 00:21:58,276
in-app purchases will be


974
00:21:58,276 --> 00:21:59,446
discoverable, right in the App


975
00:21:59,446 --> 00:21:59,716
Store.


976
00:22:00,806 --> 00:22:01,716
They'll be visible on your app


977
00:22:01,716 --> 00:22:02,036
page.


978
00:22:03,206 --> 00:22:03,916
They'll be eligible for


979
00:22:03,956 --> 00:22:04,736
editorial feature.


980
00:22:05,726 --> 00:22:06,566
And they can even show up in


981
00:22:06,566 --> 00:22:07,256
search results.


982
00:22:08,686 --> 00:22:10,486
Not only that, but users will be


983
00:22:10,486 --> 00:22:11,896
able to begin a purchase right


984
00:22:11,896 --> 00:22:12,866
from the App Store itself.


985
00:22:14,466 --> 00:22:15,376
We think this will be a huge


986
00:22:15,376 --> 00:22:16,596
improvement to how users view


987
00:22:16,596 --> 00:22:17,436
your in-app purchases.


988
00:22:19,666 --> 00:22:20,496
So, how does it all work?


989
00:22:21,686 --> 00:22:22,916
Well, promoting your in-app


990
00:22:22,916 --> 00:22:23,896
purchases is easy.


991
00:22:24,386 --> 00:22:25,746
You'll need to do to things.


992
00:22:26,946 --> 00:22:28,886
First, choose up to 20 in-app


993
00:22:28,886 --> 00:22:30,656
purchases to promote per app,


994
00:22:31,016 --> 00:22:32,046
and set them up in iTunes


995
00:22:32,046 --> 00:22:33,056
Connect with an accompanying


996
00:22:33,056 --> 00:22:33,426
image.


997
00:22:34,466 --> 00:22:35,736
Then, implement a single


998
00:22:35,736 --> 00:22:37,106
delegate method in your app to


999
00:22:37,106 --> 00:22:38,306
handle the purchase info sent to


1000
00:22:38,306 --> 00:22:39,096
you from the App Store.


1001
00:22:39,776 --> 00:22:41,236
In most cases, this


1002
00:22:41,236 --> 00:22:42,356
implementation can be just a


1003
00:22:42,356 --> 00:22:43,396
single line of code, and


1004
00:22:43,396 --> 00:22:44,386
StoreKit will handle the rest of


1005
00:22:44,386 --> 00:22:45,316
the transaction for you.


1006
00:22:47,136 --> 00:22:51,906
Also, if you want, you can


1007
00:22:52,146 --> 00:22:53,046
override the order and


1008
00:22:53,046 --> 00:22:54,306
visibility that they show up in,


1009
00:22:54,546 --> 00:22:55,006
locally.


1010
00:22:56,056 --> 00:22:57,316
Now, this isn't required, but it


1011
00:22:57,316 --> 00:22:58,266
can be useful in a variety of


1012
00:22:58,266 --> 00:22:59,006
situations.


1013
00:22:59,566 --> 00:23:02,196
So, we've already gone into


1014
00:23:02,196 --> 00:23:03,456
detail on how to do the iTunes


1015
00:23:03,456 --> 00:23:04,706
Connect setup in the What's New


1016
00:23:04,706 --> 00:23:05,796
in iTunes Connect session.


1017
00:23:06,116 --> 00:23:06,826
That was yesterday.


1018
00:23:07,186 --> 00:23:07,986
If you missed it, you can just


1019
00:23:07,986 --> 00:23:08,656
catch it online.


1020
00:23:09,326 --> 00:23:11,156
But for now, let's dive in and


1021
00:23:11,156 --> 00:23:12,016
take a look at handling your


1022
00:23:12,016 --> 00:23:13,156
transaction info when it's sent


1023
00:23:13,156 --> 00:23:13,896
to you from the App Store.


1024
00:23:17,316 --> 00:23:18,696
So, a user has clicked to


1025
00:23:18,696 --> 00:23:19,606
purchase one of your in-app


1026
00:23:19,606 --> 00:23:20,586
purchases in the App Store.


1027
00:23:22,066 --> 00:23:23,456
StoreKit will automatically open


1028
00:23:23,456 --> 00:23:25,146
your app and send information


1029
00:23:25,146 --> 00:23:26,946
about the transaction to you via


1030
00:23:26,946 --> 00:23:28,286
a new delegate method on the


1031
00:23:28,286 --> 00:23:29,756
SKPaymentTransaction observer


1032
00:23:29,756 --> 00:23:30,196
protocol.


1033
00:23:30,196 --> 00:23:31,966
Now, you already have an object


1034
00:23:32,026 --> 00:23:33,106
implementing this protocol,


1035
00:23:33,236 --> 00:23:34,346
doing things like observing a


1036
00:23:34,346 --> 00:23:35,626
transaction state, as Pete was


1037
00:23:35,626 --> 00:23:36,336
talking about earlier.


1038
00:23:37,156 --> 00:23:38,506
So, you can put your new code


1039
00:23:38,506 --> 00:23:39,676
for promoting in-app purchases


1040
00:23:39,826 --> 00:23:40,636
right next to your already


1041
00:23:40,636 --> 00:23:41,226
existing code.


1042
00:23:43,116 --> 00:23:44,386
It's good to know that if your


1043
00:23:44,386 --> 00:23:45,686
app isn't already installed, the


1044
00:23:46,186 --> 00:23:48,196
App Store will download or


1045
00:23:48,196 --> 00:23:49,416
prompt the user to buy it.


1046
00:23:49,876 --> 00:23:50,936
In this case, it can't be opened


1047
00:23:50,936 --> 00:23:52,276
automatically, so instead, the


1048
00:23:52,426 --> 00:23:53,266
user will receive a


1049
00:23:53,266 --> 00:23:53,956
notification.


1050
00:23:54,376 --> 00:23:55,836
And when they tap on that, then


1051
00:23:55,836 --> 00:23:57,006
your app will open and be sent


1052
00:23:57,006 --> 00:23:57,926
the transaction info.


1053
00:24:01,216 --> 00:24:03,146
So, what's the code look like?


1054
00:24:04,236 --> 00:24:06,296
Well, this is all the new code


1055
00:24:06,296 --> 00:24:07,076
you need to get started


1056
00:24:07,076 --> 00:24:08,216
promoting in-app purchases.


1057
00:24:09,586 --> 00:24:10,466
StoreKit will send you the


1058
00:24:10,466 --> 00:24:12,366
SKPayment queue, the SKPayment,


1059
00:24:12,456 --> 00:24:13,296
and the SKProduct.


1060
00:24:13,506 --> 00:24:14,326
Which is everything you need to


1061
00:24:14,326 --> 00:24:15,156
handle the transaction.


1062
00:24:15,706 --> 00:24:16,766
And the SKPayment will already


1063
00:24:16,766 --> 00:24:18,056
be set up with the SKProduct on


1064
00:24:18,056 --> 00:24:18,123
it.


1065
00:24:19,826 --> 00:24:21,956
When you return true, the user


1066
00:24:21,956 --> 00:24:23,196
will be shown that nice new


1067
00:24:23,196 --> 00:24:24,186
in-app purchase payment sheet,


1068
00:24:24,696 --> 00:24:25,366
so they can complete the


1069
00:24:25,366 --> 00:24:25,966
transaction.


1070
00:24:26,246 --> 00:24:26,806
And that's it.


1071
00:24:26,976 --> 00:24:27,336
We're done.


1072
00:24:27,936 --> 00:24:28,426
Time to ship it.


1073
00:24:30,606 --> 00:24:31,056
Oh, all right.


1074
00:24:31,056 --> 00:24:32,266
Well, what if the user is in the


1075
00:24:32,266 --> 00:24:33,046
middle of onboarding?


1076
00:24:33,046 --> 00:24:34,446
Or if they're creating an


1077
00:24:34,446 --> 00:24:34,776
account?


1078
00:24:34,776 --> 00:24:36,246
Or if they've already unlocked


1079
00:24:36,246 --> 00:24:38,976
the item they're trying to buy?


1080
00:24:39,926 --> 00:24:41,496
Well, in this case, you can hold


1081
00:24:41,496 --> 00:24:42,636
onto the payment and return


1082
00:24:42,636 --> 00:24:43,116
false.


1083
00:24:44,356 --> 00:24:45,376
Then, when the user is done


1084
00:24:45,376 --> 00:24:46,326
onboarding or whatever they


1085
00:24:46,326 --> 00:24:48,366
needed to do, simply add the


1086
00:24:48,366 --> 00:24:49,496
payment to the payment queue as


1087
00:24:49,496 --> 00:24:50,506
you would with a normal in-app


1088
00:24:50,506 --> 00:24:50,926
purchase.


1089
00:24:52,216 --> 00:24:53,516
It's important that you add the


1090
00:24:53,516 --> 00:24:54,556
SKPayment that was sent to you


1091
00:24:54,556 --> 00:24:55,796
in this delegate method and not


1092
00:24:55,796 --> 00:24:56,786
create a new one with the same


1093
00:24:56,786 --> 00:24:57,206
product.


1094
00:24:58,686 --> 00:24:59,686
If for some reason you need to


1095
00:24:59,686 --> 00:25:01,036
cancel the transaction entirely,


1096
00:25:01,766 --> 00:25:03,056
just return false and no other


1097
00:25:03,056 --> 00:25:03,876
action is required.


1098
00:25:04,596 --> 00:25:07,656
If you're going to cancel or


1099
00:25:07,656 --> 00:25:09,226
defer a payment, you should


1100
00:25:09,226 --> 00:25:10,306
definitely consider letting the


1101
00:25:10,306 --> 00:25:11,216
user know, in some way.


1102
00:25:12,086 --> 00:25:13,166
What you don't want, is for the


1103
00:25:13,166 --> 00:25:14,626
user to tap on the in-app


1104
00:25:14,656 --> 00:25:16,266
purchase in the App Store, be


1105
00:25:16,266 --> 00:25:17,306
brought to your app, and then,


1106
00:25:17,306 --> 00:25:17,946
nothing happens.


1107
00:25:18,756 --> 00:25:19,596
They're going to think there's a


1108
00:25:19,596 --> 00:25:22,976
bug, and that's not good.


1109
00:25:24,026 --> 00:25:25,316
Okay. So, now you've got this


1110
00:25:25,316 --> 00:25:25,756
all set up.


1111
00:25:25,886 --> 00:25:26,876
You want to test it.


1112
00:25:26,876 --> 00:25:29,016
Right. Well, your in-app


1113
00:25:29,016 --> 00:25:30,446
purchases won't actually show up


1114
00:25:30,446 --> 00:25:31,756
in the App Store, until you've


1115
00:25:31,756 --> 00:25:34,076
submitted a binary that has this


1116
00:25:34,076 --> 00:25:34,876
delegate method.


1117
00:25:34,926 --> 00:25:36,036
So, we know you can handle the


1118
00:25:36,236 --> 00:25:36,956
transactions.


1119
00:25:38,586 --> 00:25:39,946
So, instead, we've created a


1120
00:25:39,946 --> 00:25:41,206
system URL for you to use.


1121
00:25:42,466 --> 00:25:44,106
This URL has the ITMS services


1122
00:25:44,136 --> 00:25:45,726
protocol and three parameters.


1123
00:25:46,466 --> 00:25:47,786
The first parameter is action,


1124
00:25:47,786 --> 00:25:48,806
and that's always purchase


1125
00:25:48,806 --> 00:25:49,116
intent.


1126
00:25:50,316 --> 00:25:51,526
The next parameter is bundleID,


1127
00:25:51,526 --> 00:25:52,646
which is of course, the bundle


1128
00:25:52,646 --> 00:25:53,246
ID for your app.


1129
00:25:53,246 --> 00:25:55,096
And the last one is


1130
00:25:55,146 --> 00:25:56,156
productIdentifier, which you


1131
00:25:56,156 --> 00:25:57,026
fill in with the product


1132
00:25:57,026 --> 00:25:58,316
identifier of the in-app


1133
00:25:58,316 --> 00:25:59,236
purchase you want to test.


1134
00:26:01,386 --> 00:26:02,476
And once you've constructed this


1135
00:26:02,476 --> 00:26:04,486
URL like so, you can simple send


1136
00:26:04,486 --> 00:26:06,546
it to yourself in an iMessage or


1137
00:26:06,546 --> 00:26:08,196
an email, and tap it on your


1138
00:26:08,196 --> 00:26:08,666
device.


1139
00:26:09,856 --> 00:26:10,926
You'll now it's working, because


1140
00:26:10,926 --> 00:26:11,686
your app will be opened


1141
00:26:11,686 --> 00:26:12,246
automatically.


1142
00:26:13,096 --> 00:26:14,236
And you can test its behavior


1143
00:26:14,236 --> 00:26:14,556
from there.


1144
00:26:17,926 --> 00:26:19,266
All right.


1145
00:26:19,266 --> 00:26:20,746
Now, we've gone over how to


1146
00:26:20,746 --> 00:26:21,926
handle the payment info when


1147
00:26:21,926 --> 00:26:22,596
it's sent to you from the App


1148
00:26:22,596 --> 00:26:22,856
Store.


1149
00:26:23,856 --> 00:26:25,126
Let's take a look at the more


1150
00:26:25,126 --> 00:26:25,756
advanced setup.


1151
00:26:28,386 --> 00:26:29,666
When you set up your promoted


1152
00:26:29,666 --> 00:26:30,656
in-app purchases in iTunes


1153
00:26:30,686 --> 00:26:32,236
Connect, you'll be able to


1154
00:26:32,236 --> 00:26:34,236
choose a default order that they


1155
00:26:34,236 --> 00:26:35,436
appear in on your app page.


1156
00:26:36,126 --> 00:26:37,216
You'll also be able to choose to


1157
00:26:37,216 --> 00:26:38,476
set some to hidden, so that they


1158
00:26:38,476 --> 00:26:39,106
don't appear, at all.


1159
00:26:40,386 --> 00:26:41,506
Then, when your app is running


1160
00:26:41,506 --> 00:26:43,696
on the device, you can set


1161
00:26:43,696 --> 00:26:45,316
overrides for these, locally, to


1162
00:26:45,316 --> 00:26:46,546
change the order of visibility.


1163
00:26:47,886 --> 00:26:49,336
So, for example, if you're


1164
00:26:49,336 --> 00:26:51,266
making a racing game you may


1165
00:26:51,266 --> 00:26:52,486
want to hide in-app purchases


1166
00:26:52,486 --> 00:26:53,776
for a car until the user has


1167
00:26:53,776 --> 00:26:54,816
actually unlocked that car.


1168
00:26:55,786 --> 00:26:59,336
Then, when they do, you can move


1169
00:26:59,336 --> 00:27:00,716
that in-app purchase to the top


1170
00:27:00,716 --> 00:27:02,016
of the list and unhide it.


1171
00:27:02,766 --> 00:27:03,536
So, they've just unlocked the


1172
00:27:03,536 --> 00:27:04,956
car, and now they'll see the


1173
00:27:04,956 --> 00:27:06,216
most relevant in-app purchase


1174
00:27:06,216 --> 00:27:07,256
right at the front of the list.


1175
00:27:08,906 --> 00:27:09,936
it's important to know that


1176
00:27:09,936 --> 00:27:11,326
these are not synched across the


1177
00:27:11,326 --> 00:27:11,696
bases.


1178
00:27:11,726 --> 00:27:13,926
They're stored locally on each


1179
00:27:14,596 --> 00:27:14,816
device.


1180
00:27:15,836 --> 00:27:16,996
So, if you need to replicate the


1181
00:27:16,996 --> 00:27:18,426
same behavior, you should make


1182
00:27:18,426 --> 00:27:20,126
sure that your app locally can


1183
00:27:20,306 --> 00:27:21,236
reproduce the results.


1184
00:27:21,266 --> 00:27:24,726
All right.


1185
00:27:24,726 --> 00:27:25,866
Let's take a look at some


1186
00:27:25,866 --> 00:27:26,916
specific examples.


1187
00:27:27,836 --> 00:27:30,706
Here, we have an app called


1188
00:27:30,706 --> 00:27:31,616
Forest Explorer.


1189
00:27:31,786 --> 00:27:33,546
This is an app we made up that


1190
00:27:33,546 --> 00:27:35,416
helps people discover and travel


1191
00:27:35,416 --> 00:27:37,746
to destinations.


1192
00:27:37,746 --> 00:27:41,206
This app doesn't exist in the


1193
00:27:41,206 --> 00:27:41,606
App Store.


1194
00:27:41,776 --> 00:27:42,786
It's only this presentation.


1195
00:27:43,876 --> 00:27:45,106
So, here we're promoting three


1196
00:27:45,106 --> 00:27:45,786
app purchases.


1197
00:27:45,786 --> 00:27:46,946
We have the Pro Subscription,


1198
00:27:47,276 --> 00:27:48,246
which upgrades the level of


1199
00:27:48,246 --> 00:27:49,706
detail the user sees and maps


1200
00:27:49,706 --> 00:27:50,256
and directions.


1201
00:27:51,146 --> 00:27:52,856
We have the Fishing Hotspots and


1202
00:27:52,856 --> 00:27:53,876
the Hidden Beaches packs.


1203
00:27:54,216 --> 00:27:55,216
Which simply unlock more


1204
00:27:55,216 --> 00:27:56,596
destinations that follow those


1205
00:27:56,596 --> 00:27:57,006
themes.


1206
00:27:58,756 --> 00:28:00,756
So, one thing you may want to do


1207
00:28:00,756 --> 00:28:02,576
is, say a user has purchased the


1208
00:28:02,616 --> 00:28:03,576
Pro Subscription in-app


1209
00:28:03,636 --> 00:28:06,166
purchase, is hide this from your


1210
00:28:06,166 --> 00:28:06,696
app page.


1211
00:28:06,936 --> 00:28:08,376
So, this is not something that


1212
00:28:08,376 --> 00:28:09,356
StoreKit or the App Store does,


1213
00:28:09,356 --> 00:28:09,986
automatically.


1214
00:28:10,736 --> 00:28:12,316
If they buy this and then, go to


1215
00:28:12,316 --> 00:28:13,556
the App Store, they'll still see


1216
00:28:13,556 --> 00:28:14,366
it there on your list.


1217
00:28:15,246 --> 00:28:16,276
Which might not make sense,


1218
00:28:16,316 --> 00:28:17,046
because they can't buy it,


1219
00:28:17,046 --> 00:28:17,366
again.


1220
00:28:18,596 --> 00:28:19,806
So, instead, what you can do is


1221
00:28:19,876 --> 00:28:21,116
use the local visibility


1222
00:28:21,116 --> 00:28:23,716
override to hide the app


1223
00:28:23,716 --> 00:28:24,136
purchase.


1224
00:28:24,286 --> 00:28:25,446
And then, they'll only see items


1225
00:28:25,446 --> 00:28:26,336
that are relevant to them on


1226
00:28:26,336 --> 00:28:26,966
your app page.


1227
00:28:29,876 --> 00:28:30,726
So, what's the code look like


1228
00:28:30,726 --> 00:28:30,976
for this?


1229
00:28:34,756 --> 00:28:35,256
Here it is.


1230
00:28:35,406 --> 00:28:37,256
First, you want to start by


1231
00:28:37,336 --> 00:28:38,836
fetching the SKProduct so you


1232
00:28:38,836 --> 00:28:39,606
have the most up to date


1233
00:28:39,606 --> 00:28:40,626
information from the server.


1234
00:28:41,236 --> 00:28:42,406
Here, we'll fetch the info for


1235
00:28:42,406 --> 00:28:43,406
the Pro Subscription in-app


1236
00:28:43,406 --> 00:28:43,826
purchase.


1237
00:28:45,626 --> 00:28:47,766
Then, we have a new class for


1238
00:28:47,766 --> 00:28:48,756
dealing with these local


1239
00:28:48,756 --> 00:28:49,746
overrides called


1240
00:28:49,916 --> 00:28:51,306
SKProductStorePromotion


1241
00:28:51,306 --> 00:28:51,806
Controller.


1242
00:28:52,906 --> 00:28:53,876
You'll want to get the default


1243
00:28:53,876 --> 00:28:54,336
controller.


1244
00:28:56,056 --> 00:28:57,466
And then, passing your SKProduct


1245
00:28:57,586 --> 00:28:58,326
to the update


1246
00:28:58,326 --> 00:28:59,576
StorePromotionVisibility


1247
00:28:59,636 --> 00:29:00,376
forProduct method.


1248
00:29:00,906 --> 00:29:01,996
Along with the new visibility


1249
00:29:01,996 --> 00:29:02,696
you want to set it to.


1250
00:29:03,506 --> 00:29:04,606
So, here we want to hide the Pro


1251
00:29:04,606 --> 00:29:05,706
Subscription, since the user


1252
00:29:05,706 --> 00:29:06,416
just purchased it.


1253
00:29:08,466 --> 00:29:09,346
That's all there is to it.


1254
00:29:09,416 --> 00:29:09,856
Pretty simple.


1255
00:29:11,456 --> 00:29:12,366
Now, if you want to check to see


1256
00:29:12,366 --> 00:29:13,456
what overrides you've already


1257
00:29:15,756 --> 00:29:17,556
set, start again by fetching the


1258
00:29:17,646 --> 00:29:18,176
SKProduct.


1259
00:29:18,526 --> 00:29:19,416
Here, we'll look at the Hidden


1260
00:29:19,416 --> 00:29:19,876
Beaches pack.


1261
00:29:21,426 --> 00:29:22,606
So, pass this into the fetch


1262
00:29:22,606 --> 00:29:24,006
StorePromotionVisibilityFor


1263
00:29:24,006 --> 00:29:24,656
Product method.


1264
00:29:24,956 --> 00:29:27,256
And what we can see here, is the


1265
00:29:27,256 --> 00:29:28,726
visibility is done, default.


1266
00:29:29,116 --> 00:29:30,076
Now, this is because we haven't


1267
00:29:30,076 --> 00:29:31,046
set any overrides, yet.


1268
00:29:31,046 --> 00:29:32,726
And it means that it will be


1269
00:29:32,726 --> 00:29:34,056
hidden or shown based on what


1270
00:29:34,056 --> 00:29:35,186
you've set as a default in


1271
00:29:35,216 --> 00:29:35,856
iTunes Connect.


1272
00:29:39,766 --> 00:29:41,016
Okay. So, we've talked about


1273
00:29:41,116 --> 00:29:42,126
overriding the visibility.


1274
00:29:42,606 --> 00:29:43,776
How about changing the order


1275
00:29:43,776 --> 00:29:44,666
that your in-app purchases


1276
00:29:44,666 --> 00:29:45,706
appear in on your app page?


1277
00:29:47,806 --> 00:29:48,656
Let's go back to Forest


1278
00:29:48,656 --> 00:29:49,156
Explorer.


1279
00:29:51,216 --> 00:29:52,826
Now, maybe you've been looking


1280
00:29:52,826 --> 00:29:54,136
at your metrics, and you notice


1281
00:29:54,176 --> 00:29:55,636
that this user is going to a lot


1282
00:29:55,636 --> 00:29:56,146
of beaches.


1283
00:29:57,426 --> 00:29:58,616
Could make sense to move the


1284
00:29:58,616 --> 00:29:59,916
Hidden Beaches back to the front


1285
00:29:59,916 --> 00:30:01,776
of the list so that they're more


1286
00:30:01,776 --> 00:30:02,446
likely to see it.


1287
00:30:02,996 --> 00:30:04,056
And since it's something that's


1288
00:30:04,056 --> 00:30:05,216
interesting to them, they might


1289
00:30:05,216 --> 00:30:05,976
be more likely to buy it.


1290
00:30:10,426 --> 00:30:11,336
Now, the code for this looks


1291
00:30:11,336 --> 00:30:12,936
very similar to updating


1292
00:30:13,166 --> 00:30:14,036
visibility overrides.


1293
00:30:14,996 --> 00:30:16,166
You'll want to fetch the


1294
00:30:16,166 --> 00:30:17,996
SKProducts for every in-app


1295
00:30:17,996 --> 00:30:18,966
purchase you want to override


1296
00:30:18,966 --> 00:30:20,136
the order of, so here we'll do


1297
00:30:20,136 --> 00:30:20,556
all three.


1298
00:30:20,556 --> 00:30:21,676
We'll do the Pro Subscription,


1299
00:30:21,856 --> 00:30:23,326
Fishing Hotspots, and the Hidden


1300
00:30:23,326 --> 00:30:23,706
Beaches.


1301
00:30:24,866 --> 00:30:26,976
Then, create an array that has


1302
00:30:26,976 --> 00:30:28,306
these in-app purchases in the


1303
00:30:28,306 --> 00:30:29,406
order that you want to override


1304
00:30:29,406 --> 00:30:30,016
them to be.


1305
00:30:30,626 --> 00:30:31,616
So, move the Hidden Beaches to


1306
00:30:31,616 --> 00:30:31,976
the front.


1307
00:30:33,796 --> 00:30:35,566
Finally, pass this array into


1308
00:30:35,566 --> 00:30:36,956
the updateStorePromotionOrder


1309
00:30:36,956 --> 00:30:37,256
method.


1310
00:30:37,886 --> 00:30:39,376
And there you go.


1311
00:30:39,376 --> 00:30:39,986
It's been updated.


1312
00:30:39,986 --> 00:30:43,736
Now, if we want to view the


1313
00:30:43,736 --> 00:30:44,636
overrides we may have set,


1314
00:30:44,636 --> 00:30:44,986
already.


1315
00:30:45,936 --> 00:30:47,326
Once again, it's very similar.


1316
00:30:48,446 --> 00:30:49,116
Grab the default


1317
00:30:49,116 --> 00:30:50,736
storePromotionController and


1318
00:30:50,736 --> 00:30:51,256
simply use the


1319
00:30:51,326 --> 00:30:52,326
fetchStorePromotionalOrder


1320
00:30:52,326 --> 00:30:52,696
method.


1321
00:30:54,396 --> 00:30:56,696
Here, we can see that we get an


1322
00:30:56,696 --> 00:30:57,856
array back and Hidden Beaches is


1323
00:30:57,856 --> 00:30:59,096
in front, since we've just set


1324
00:30:59,096 --> 00:30:59,706
that override.


1325
00:31:01,786 --> 00:31:03,926
Now, you don't need to use every


1326
00:31:03,926 --> 00:31:04,976
in-app purchase in your array


1327
00:31:04,976 --> 00:31:05,886
when you set the overrides.


1328
00:31:06,006 --> 00:31:07,436
You can actually use any subset


1329
00:31:07,436 --> 00:31:08,266
of them that you want.


1330
00:31:08,996 --> 00:31:10,216
If you do, what'll happen is


1331
00:31:10,296 --> 00:31:11,826
that subset will be shown at the


1332
00:31:11,826 --> 00:31:14,126
front of the list in the order


1333
00:31:14,126 --> 00:31:15,226
you've specified the override


1334
00:31:15,226 --> 00:31:15,536
for.


1335
00:31:16,176 --> 00:31:16,926
The rest of your in-app


1336
00:31:16,926 --> 00:31:18,746
purchases will be shown after


1337
00:31:18,746 --> 00:31:20,056
those, in the same relative


1338
00:31:20,056 --> 00:31:21,096
order as you've set in iTunes


1339
00:31:21,096 --> 00:31:21,326
Connect.


1340
00:31:23,116 --> 00:31:24,476
Also, you can receive an empty


1341
00:31:24,476 --> 00:31:25,266
array from this method.


1342
00:31:25,706 --> 00:31:26,686
This would mean that you haven't


1343
00:31:26,686 --> 00:31:28,136
set any order overrides, at all.


1344
00:31:29,016 --> 00:31:30,366
And similarly, you could pass in


1345
00:31:30,366 --> 00:31:32,236
an empty array to the update


1346
00:31:32,236 --> 00:31:32,596
method.


1347
00:31:32,806 --> 00:31:34,066
And that would be the same as


1348
00:31:34,556 --> 00:31:35,786
cancelling all the overrides.


1349
00:31:36,346 --> 00:31:38,116
You can think of this as using


1350
00:31:38,116 --> 00:31:39,306
the empty set of overrides.


1351
00:31:40,026 --> 00:31:43,716
So, this is all the code there


1352
00:31:43,716 --> 00:31:44,566
is for promoting in-app


1353
00:31:44,566 --> 00:31:45,096
purchases.


1354
00:31:46,146 --> 00:31:48,256
The new delegate method and the


1355
00:31:48,256 --> 00:31:49,536
test URL are available, right


1356
00:31:49,536 --> 00:31:50,606
now, in the Seed we sent out,


1357
00:31:50,606 --> 00:31:51,266
earlier this week.


1358
00:31:52,126 --> 00:31:53,886
And this order and visibility


1359
00:31:53,886 --> 00:31:55,296
override will be available in a


1360
00:31:55,296 --> 00:31:56,646
later Seed.


1361
00:31:57,636 --> 00:32:00,116
To recap on promoting in-app


1362
00:32:00,116 --> 00:32:02,786
purchases, it's a great way to


1363
00:32:02,786 --> 00:32:03,836
make them more discoverable, by


1364
00:32:03,836 --> 00:32:04,856
promoting them in the App Store.


1365
00:32:06,276 --> 00:32:07,426
You'll choose up to 20 to


1366
00:32:07,426 --> 00:32:09,026
promote per app and set them up


1367
00:32:09,026 --> 00:32:09,796
in iTunes Connect.


1368
00:32:11,256 --> 00:32:12,866
Then, a user can tap in the App


1369
00:32:12,866 --> 00:32:14,446
Store to begin the purchase.


1370
00:32:16,626 --> 00:32:18,006
The transaction info will be


1371
00:32:18,006 --> 00:32:19,226
sent to your app as it's opened


1372
00:32:19,226 --> 00:32:21,036
automatically via a new delegate


1373
00:32:21,036 --> 00:32:22,336
method on the SKPayment


1374
00:32:22,336 --> 00:32:23,656
transaction observer protocol.


1375
00:32:25,646 --> 00:32:28,446
Finally, if you want, you can


1376
00:32:28,446 --> 00:32:29,366
override the order and


1377
00:32:29,366 --> 00:32:30,446
visibility of they appear on


1378
00:32:30,446 --> 00:32:31,736
your app page, locally at


1379
00:32:31,736 --> 00:32:32,116
runtime.


1380
00:32:33,436 --> 00:32:34,366
Now, I'm really excited to see


1381
00:32:34,366 --> 00:32:35,466
how you all will use promoting


1382
00:32:35,526 --> 00:32:36,546
app purchases in your apps.


1383
00:32:36,966 --> 00:32:38,426
But for now, I hand the stage


1384
00:32:38,426 --> 00:32:39,516
back over to Pete, so he can


1385
00:32:39,516 --> 00:32:40,386
tell you what's new in working


1386
00:32:40,386 --> 00:32:41,246
with customer reviews.


1387
00:32:42,516 --> 00:32:47,546
[ Applause ]


1388
00:32:48,046 --> 00:32:48,596
>> Thanks, Ross.


1389
00:32:49,716 --> 00:32:51,166
I can't wait to try out Forest


1390
00:32:51,166 --> 00:32:51,596
Explorer.


1391
00:32:51,786 --> 00:32:53,096
Looks like a great app.


1392
00:32:53,666 --> 00:32:55,046
Well, now we've learned a bit


1393
00:32:55,046 --> 00:32:55,926
about implementing in-app


1394
00:32:55,926 --> 00:32:57,126
purchases and how to promote


1395
00:32:57,126 --> 00:32:57,966
them in the App Store.


1396
00:32:58,286 --> 00:32:59,326
Let's look at some ways you can


1397
00:32:59,326 --> 00:33:00,546
now interact with your


1398
00:33:00,546 --> 00:33:01,186
customers.


1399
00:33:01,926 --> 00:33:03,866
So, in iOS 11 we've got this


1400
00:33:03,866 --> 00:33:05,026
great new looking App Store


1401
00:33:05,026 --> 00:33:05,396
design.


1402
00:33:05,846 --> 00:33:07,226
And this is a product page.


1403
00:33:07,226 --> 00:33:08,446
If you scroll down the product


1404
00:33:08,446 --> 00:33:10,446
page, this is the new ratings


1405
00:33:10,446 --> 00:33:11,946
and reviews section, with a new


1406
00:33:11,946 --> 00:33:13,206
unified rating there.


1407
00:33:13,336 --> 00:33:14,996
And the user can just swipe


1408
00:33:15,076 --> 00:33:16,846
through different reviews in


1409
00:33:16,846 --> 00:33:18,456
order to read information about


1410
00:33:18,906 --> 00:33:19,956
user's experience with your


1411
00:33:19,956 --> 00:33:20,316
apps.


1412
00:33:20,666 --> 00:33:21,956
So, what's new in this regard?


1413
00:33:21,956 --> 00:33:23,476
Well, we've got a few new


1414
00:33:23,476 --> 00:33:23,976
features, here.


1415
00:33:23,976 --> 00:33:25,116
The first one, you can now


1416
00:33:25,116 --> 00:33:26,586
choose when you want your rating


1417
00:33:26,586 --> 00:33:27,236
to reset.


1418
00:33:27,536 --> 00:33:28,226
When you release your


1419
00:33:28,226 --> 00:33:29,676
application, you can decide if


1420
00:33:29,676 --> 00:33:30,406
this is something you want to


1421
00:33:30,406 --> 00:33:30,926
happen or not.


1422
00:33:30,926 --> 00:33:32,636
Previously, this would reset


1423
00:33:32,636 --> 00:33:33,996
your rating every single time.


1424
00:33:33,996 --> 00:33:35,386
So, now it's kind of up to you.


1425
00:33:35,526 --> 00:33:35,636
Yeah.


1426
00:33:36,516 --> 00:33:40,046
[ Applause ]


1427
00:33:40,546 --> 00:33:41,926
We've also, recently added the


1428
00:33:41,926 --> 00:33:43,086
ability for you to respond to


1429
00:33:43,086 --> 00:33:44,216
reviews on the App Store.


1430
00:33:44,216 --> 00:33:45,466
So, you can have that dialog


1431
00:33:45,606 --> 00:33:46,556
with consumers, now.


1432
00:33:47,126 --> 00:33:48,666
There's also some new ways for


1433
00:33:48,666 --> 00:33:49,616
you to ask for ratings and


1434
00:33:49,616 --> 00:33:50,356
reviews by the


1435
00:33:50,426 --> 00:33:51,906
SKStoreReviewController.


1436
00:33:52,766 --> 00:33:54,546
And finally, we added a new deep


1437
00:33:54,546 --> 00:33:56,886
link in iOS 10.3, that can link


1438
00:33:56,886 --> 00:33:58,166
directly to be able to write a


1439
00:33:58,166 --> 00:33:59,136
review in the App Store.


1440
00:34:00,086 --> 00:34:02,216
We also have added Helpfulness


1441
00:34:02,216 --> 00:34:03,596
and Report a Concern to iOS.


1442
00:34:03,696 --> 00:34:05,556
So, what does that look like?


1443
00:34:06,006 --> 00:34:08,176
Well, a user can now 3D Touch on


1444
00:34:08,226 --> 00:34:09,376
a review itself, and they get


1445
00:34:09,406 --> 00:34:10,906
presented with this Helpful or


1446
00:34:10,906 --> 00:34:12,116
Not Helpful menu.


1447
00:34:12,116 --> 00:34:13,446
They can mark them as helpful or


1448
00:34:13,446 --> 00:34:13,976
not helpful.


1449
00:34:13,976 --> 00:34:15,426
They can even report a concern


1450
00:34:15,426 --> 00:34:17,746
directly in the iOS app.


1451
00:34:18,556 --> 00:34:20,496
And when it comes to responding


1452
00:34:20,496 --> 00:34:21,806
to reviews, we introduced this


1453
00:34:21,806 --> 00:34:23,005
in iOS 10.3.


1454
00:34:23,146 --> 00:34:24,156
And the response has been really


1455
00:34:24,156 --> 00:34:24,716
fantastic.


1456
00:34:25,255 --> 00:34:26,426
We think users have loved this


1457
00:34:26,426 --> 00:34:27,106
feature and we've seen


1458
00:34:27,106 --> 00:34:28,786
developers really utilizing this


1459
00:34:28,786 --> 00:34:29,386
in a great way.


1460
00:34:29,616 --> 00:34:31,156
And when you respond to a user's


1461
00:34:31,156 --> 00:34:32,146
review, the user gets a


1462
00:34:32,146 --> 00:34:33,565
notification on their device,


1463
00:34:33,565 --> 00:34:35,536
informing them of your response.


1464
00:34:36,126 --> 00:34:37,485
They also get an email, as well,


1465
00:34:38,016 --> 00:34:40,116
detailing that response to their


1466
00:34:40,116 --> 00:34:40,466
review.


1467
00:34:40,466 --> 00:34:41,866
Now, down at the bottom of this


1468
00:34:41,866 --> 00:34:43,306
email, we actually have a link


1469
00:34:43,306 --> 00:34:44,496
for them to be able to update


1470
00:34:44,496 --> 00:34:44,896
their review.


1471
00:34:44,896 --> 00:34:45,446
So, we give them that


1472
00:34:45,446 --> 00:34:47,166
opportunity to tap that link.


1473
00:34:47,446 --> 00:34:48,356
And they get a chance to


1474
00:34:48,356 --> 00:34:49,755
actually edit their rating and


1475
00:34:49,755 --> 00:34:51,045
perhaps change their review, as


1476
00:34:51,045 --> 00:34:51,446
well.


1477
00:34:52,016 --> 00:34:53,416
And we've found that as users


1478
00:34:53,416 --> 00:34:54,186
are doing this, when they're


1479
00:34:54,186 --> 00:34:55,456
updating their reviews after


1480
00:34:55,456 --> 00:34:57,106
receiving a response, across the


1481
00:34:57,106 --> 00:34:58,036
board we've seen an average


1482
00:34:58,036 --> 00:34:59,876
increase of 1.5 stars per


1483
00:34:59,876 --> 00:35:00,286
review.


1484
00:35:00,686 --> 00:35:02,016
So, as you can see, it's a


1485
00:35:02,016 --> 00:35:03,436
really great opportunity to see


1486
00:35:03,546 --> 00:35:04,266
a better rating.


1487
00:35:04,266 --> 00:35:05,316
A better experience for the


1488
00:35:05,316 --> 00:35:07,056
user, and also, a better rating


1489
00:35:07,056 --> 00:35:08,216
for your app on the App Store,


1490
00:35:08,216 --> 00:35:08,706
entirely.


1491
00:35:09,766 --> 00:35:11,006
So, for more information about


1492
00:35:11,006 --> 00:35:12,426
this, we have a guide online


1493
00:35:12,426 --> 00:35:13,776
about some techniques and the


1494
00:35:13,776 --> 00:35:15,146
best ways to respond to reviews


1495
00:35:15,146 --> 00:35:15,996
and to interact with your


1496
00:35:15,996 --> 00:35:16,536
customers.


1497
00:35:16,906 --> 00:35:18,126
And we also chatted about this


1498
00:35:18,126 --> 00:35:19,096
in the What's New in iTunes


1499
00:35:19,096 --> 00:35:20,066
Connect session, yesterday.


1500
00:35:20,066 --> 00:35:21,466
So, if you weren't able to make


1501
00:35:21,466 --> 00:35:22,736
that, I'd encourage you to check


1502
00:35:22,736 --> 00:35:25,256
out the video for that, too.


1503
00:35:25,806 --> 00:35:26,616
When it comes to receiving


1504
00:35:26,616 --> 00:35:27,936
reviews, there's a couple of


1505
00:35:27,936 --> 00:35:29,206
ways you can do this, now.


1506
00:35:29,206 --> 00:35:30,846
You can prompt the user for


1507
00:35:30,846 --> 00:35:31,596
reviews in the


1508
00:35:31,596 --> 00:35:33,716
SKStoreReviewController class.


1509
00:35:34,026 --> 00:35:35,196
And we also provide this deep


1510
00:35:35,196 --> 00:35:36,056
link to be able to write a


1511
00:35:36,056 --> 00:35:37,336
review in the App Store,


1512
00:35:37,336 --> 00:35:37,756
directly.


1513
00:35:38,646 --> 00:35:40,026
So first, let's look at the


1514
00:35:40,026 --> 00:35:41,406
SKStoreReviewController.


1515
00:35:41,406 --> 00:35:42,556
This was a class that we


1516
00:35:42,756 --> 00:35:44,936
introduced in iOS 10.3 And it


1517
00:35:44,936 --> 00:35:46,606
provides a really nice clean


1518
00:35:46,606 --> 00:35:47,566
interface for the user to be


1519
00:35:47,566 --> 00:35:48,886
able to rate your application


1520
00:35:49,086 --> 00:35:49,926
without leaving it.


1521
00:35:50,066 --> 00:35:51,246
So, they can now, just tap a


1522
00:35:51,246 --> 00:35:53,226
star, hit submit, and rate your


1523
00:35:53,226 --> 00:35:54,406
application in a really seamless


1524
00:35:54,406 --> 00:35:55,016
experience.


1525
00:35:55,016 --> 00:35:56,086
They can ever write a review


1526
00:35:56,316 --> 00:35:56,926
without leaving your


1527
00:35:56,926 --> 00:35:58,586
application, now.


1528
00:35:58,836 --> 00:35:59,856
Now, if you're asking for


1529
00:35:59,856 --> 00:36:01,516
reviews using another kind of


1530
00:36:01,516 --> 00:36:03,176
alert or modal prompt, I just


1531
00:36:03,176 --> 00:36:04,346
highly encourage you to start


1532
00:36:04,346 --> 00:36:05,686
adopting this API, because at


1533
00:36:05,686 --> 00:36:06,746
some point in the future, we are


1534
00:36:06,746 --> 00:36:07,736
going to start requiring that


1535
00:36:07,736 --> 00:36:09,376
any modal presentation, any


1536
00:36:09,376 --> 00:36:11,886
modal prompts for reviews do use


1537
00:36:11,886 --> 00:36:12,966
this API, instead.


1538
00:36:12,966 --> 00:36:14,366
And there are some restrictions


1539
00:36:14,366 --> 00:36:15,716
in place for how this API can be


1540
00:36:15,716 --> 00:36:16,116
used.


1541
00:36:17,026 --> 00:36:18,496
There's a limited number of


1542
00:36:18,496 --> 00:36:19,736
requests per device.


1543
00:36:19,816 --> 00:36:21,876
So, we limit the amount of times


1544
00:36:21,876 --> 00:36:23,236
a user gets bombarded with these


1545
00:36:23,236 --> 00:36:23,776
alerts.


1546
00:36:23,776 --> 00:36:24,786
And the user can actually now,


1547
00:36:24,786 --> 00:36:26,306
in iOS 11, switch it off in the


1548
00:36:26,306 --> 00:36:26,856
Setting app.


1549
00:36:26,856 --> 00:36:27,686
So, they can go into the App


1550
00:36:27,686 --> 00:36:29,276
Store Settings, hit a toggle to


1551
00:36:29,276 --> 00:36:30,736
actually turn off these prompts


1552
00:36:30,736 --> 00:36:31,366
for ratings.


1553
00:36:31,836 --> 00:36:32,956
So, we think this is going to be


1554
00:36:32,956 --> 00:36:34,016
a better experience for users


1555
00:36:34,016 --> 00:36:35,086
and for developers, alike.


1556
00:36:36,356 --> 00:36:37,706
A couple of tips for


1557
00:36:38,106 --> 00:36:40,586
implementing this.


1558
00:36:40,586 --> 00:36:41,656
The SKStoreReviewController is a


1559
00:36:41,656 --> 00:36:42,536
prompt, so it's kind of


1560
00:36:42,536 --> 00:36:43,556
interruptive by nature.


1561
00:36:43,686 --> 00:36:45,366
So, think about doing this thing


1562
00:36:45,366 --> 00:36:46,686
at the end of maybe, some kind


1563
00:36:46,686 --> 00:36:47,486
of user interaction.


1564
00:36:47,676 --> 00:36:49,136
Maybe after a user has completed


1565
00:36:49,136 --> 00:36:49,696
a task.


1566
00:36:49,996 --> 00:36:51,436
Maybe, then use that opportunity


1567
00:36:51,436 --> 00:36:52,466
to ask them for a rating or


1568
00:36:52,466 --> 00:36:52,766
review.


1569
00:36:52,766 --> 00:36:53,946
Don't interrupt them when


1570
00:36:53,946 --> 00:36:54,476
they're in the middle of


1571
00:36:54,476 --> 00:36:54,846
something.


1572
00:36:55,946 --> 00:36:57,246
It's also, not appropriate to


1573
00:36:57,246 --> 00:36:58,616
use this API from a button.


1574
00:36:58,716 --> 00:36:59,606
Because you're not kind of


1575
00:36:59,606 --> 00:37:01,056
guaranteed to have UI presented


1576
00:37:01,056 --> 00:37:02,356
to the user, based on those


1577
00:37:02,356 --> 00:37:03,346
restrictions we just saw.


1578
00:37:03,876 --> 00:37:05,916
So, it's not appropriate to use


1579
00:37:05,916 --> 00:37:07,086
from some kind of embedded link


1580
00:37:07,086 --> 00:37:07,846
in your application.


1581
00:37:08,606 --> 00:37:09,796
But when you do want to do it,


1582
00:37:09,796 --> 00:37:10,656
this is what is looks like in


1583
00:37:10,656 --> 00:37:10,986
code.


1584
00:37:11,186 --> 00:37:12,196
It's just one line of code.


1585
00:37:12,696 --> 00:37:13,826
But you can wrap it in your own


1586
00:37:13,826 --> 00:37:14,506
business logic.


1587
00:37:14,506 --> 00:37:15,846
So, in this example here, we're


1588
00:37:15,846 --> 00:37:16,676
checking to see if this


1589
00:37:16,726 --> 00:37:18,386
particular user is the kind of


1590
00:37:18,386 --> 00:37:19,486
user that we want to ask a


1591
00:37:19,486 --> 00:37:19,946
review of.


1592
00:37:21,016 --> 00:37:22,226
And if we determine that they


1593
00:37:22,226 --> 00:37:24,066
are, we can call the request


1594
00:37:24,066 --> 00:37:25,846
review method on the


1595
00:37:25,846 --> 00:37:26,976
SKStoreReviewController.


1596
00:37:27,056 --> 00:37:28,026
And that's the only thing you


1597
00:37:28,026 --> 00:37:28,786
need to call.


1598
00:37:28,786 --> 00:37:29,996
And that'll present that rating


1599
00:37:29,996 --> 00:37:31,196
prompt to a user while they're


1600
00:37:31,196 --> 00:37:32,126
using your application.


1601
00:37:32,716 --> 00:37:35,726
The other way, of course, is


1602
00:37:35,726 --> 00:37:36,836
this new deep link to write a


1603
00:37:36,836 --> 00:37:37,656
review that I mentioned.


1604
00:37:39,056 --> 00:37:40,216
So, this was also actually


1605
00:37:40,216 --> 00:37:41,726
introduced in iOS 10.3, but


1606
00:37:41,726 --> 00:37:42,586
we're talking a bit about it,


1607
00:37:42,586 --> 00:37:42,876
now.


1608
00:37:43,166 --> 00:37:44,726
This provides you a link to open


1609
00:37:44,726 --> 00:37:46,016
your app page in the App Store.


1610
00:37:46,276 --> 00:37:47,496
But straightaway actually


1611
00:37:47,496 --> 00:37:48,756
presents the write review sheet,


1612
00:37:48,756 --> 00:37:49,916
or the edit review in the case


1613
00:37:49,916 --> 00:37:50,836
of they've already written one.


1614
00:37:51,406 --> 00:37:52,746
And this is more appropriate for


1615
00:37:52,746 --> 00:37:53,866
thing like user initiated


1616
00:37:53,866 --> 00:37:54,246
actions.


1617
00:37:54,246 --> 00:37:55,256
So, in the case that maybe you


1618
00:37:55,256 --> 00:37:56,736
do want a persistent link in


1619
00:37:56,736 --> 00:37:57,836
your app, maybe a button in your


1620
00:37:57,836 --> 00:37:58,936
Settings to write a review for


1621
00:37:58,936 --> 00:37:59,896
your app in the App Store.


1622
00:38:00,306 --> 00:38:01,716
And it's a little different to


1623
00:38:01,716 --> 00:38:02,946
the SKStoreReviewController, in


1624
00:38:02,946 --> 00:38:03,356
that sense.


1625
00:38:03,356 --> 00:38:04,296
You can kind of think about it


1626
00:38:04,296 --> 00:38:05,266
as being the opposite.


1627
00:38:05,596 --> 00:38:06,856
So, it's more appropriate from a


1628
00:38:06,856 --> 00:38:08,726
button in your Settings, or some


1629
00:38:08,846 --> 00:38:09,956
embedded content in your


1630
00:38:09,956 --> 00:38:10,386
application.


1631
00:38:10,386 --> 00:38:11,336
Because it provides that


1632
00:38:11,556 --> 00:38:12,916
consistent experience, a


1633
00:38:12,916 --> 00:38:14,436
guaranteed action that's going


1634
00:38:14,926 --> 00:38:15,546
to happen.


1635
00:38:15,546 --> 00:38:16,666
However, it's not appropriate to


1636
00:38:16,666 --> 00:38:17,476
use from an alert.


1637
00:38:17,606 --> 00:38:18,876
I mentioned if you're going to


1638
00:38:18,876 --> 00:38:20,326
use alerts to prompt users for


1639
00:38:20,326 --> 00:38:21,136
reviews, make sure that you


1640
00:38:21,136 --> 00:38:21,976
start to adopt


1641
00:38:21,976 --> 00:38:23,186
SKStoreReviewController,


1642
00:38:23,186 --> 00:38:23,556
instead.


1643
00:38:24,146 --> 00:38:27,856
This is how you actually form


1644
00:38:27,856 --> 00:38:28,316
the deep link.


1645
00:38:28,626 --> 00:38:31,836
You take you app page URL, which


1646
00:38:31,836 --> 00:38:32,966
you can get online from the Link


1647
00:38:32,966 --> 00:38:34,006
Maker website, if you don't know


1648
00:38:34,006 --> 00:38:34,696
what that is, already.


1649
00:38:35,026 --> 00:38:36,256
And you just append the query


1650
00:38:36,256 --> 00:38:37,616
parameter action equals write


1651
00:38:37,726 --> 00:38:38,866
review onto the end of it.


1652
00:38:38,866 --> 00:38:40,056
And that just means when the


1653
00:38:40,056 --> 00:38:41,306
user arrives at your app page,


1654
00:38:41,476 --> 00:38:42,436
they get presented with that


1655
00:38:42,436 --> 00:38:43,146
Write Review sheet.


1656
00:38:44,226 --> 00:38:47,286
So, for more information about


1657
00:38:47,506 --> 00:38:48,596
ratings and reviews and some of


1658
00:38:48,596 --> 00:38:49,486
the changes we introduced


1659
00:38:49,486 --> 00:38:50,146
earlier, this year, I'd


1660
00:38:50,146 --> 00:38:51,356
encourage you to check out the


1661
00:38:51,356 --> 00:38:52,286
developer website, here.


1662
00:38:52,756 --> 00:38:53,696
We've got some more information,


1663
00:38:53,696 --> 00:38:53,846
there.


1664
00:38:54,566 --> 00:38:56,796
So, we've covered a few of the


1665
00:38:56,796 --> 00:38:58,456
new features, today, for what's


1666
00:38:58,456 --> 00:38:59,176
new in StoreKit.


1667
00:38:59,476 --> 00:39:00,136
Just to recap.


1668
00:39:00,576 --> 00:39:01,836
We talked about the way to


1669
00:39:01,836 --> 00:39:02,966
implement in-app purchases in


1670
00:39:03,116 --> 00:39:04,266
your application, that seven


1671
00:39:04,266 --> 00:39:05,386
step flow for implementing


1672
00:39:05,386 --> 00:39:06,126
in-app purchases.


1673
00:39:06,576 --> 00:39:07,796
Ross, got up here and discussed


1674
00:39:07,796 --> 00:39:08,846
some of the newer ways that you


1675
00:39:08,846 --> 00:39:09,726
can promote your in-app


1676
00:39:09,726 --> 00:39:10,966
purchases, directly in the App


1677
00:39:10,966 --> 00:39:11,276
Store.


1678
00:39:11,276 --> 00:39:12,476
So, you can now sell content to


1679
00:39:12,476 --> 00:39:13,176
your users while they're


1680
00:39:13,176 --> 00:39:14,186
browsing the App Store app.


1681
00:39:14,996 --> 00:39:16,286
We've got that new App Store


1682
00:39:16,286 --> 00:39:17,706
design, featuring the new


1683
00:39:17,896 --> 00:39:19,136
Ratings and Reviews section,


1684
00:39:19,396 --> 00:39:20,766
including developer responses.


1685
00:39:20,976 --> 00:39:22,196
And we've seen that using


1686
00:39:22,196 --> 00:39:23,206
developer responses, we've got


1687
00:39:23,206 --> 00:39:24,546
some great new opportunities to


1688
00:39:24,546 --> 00:39:25,986
actually see improvements in


1689
00:39:25,986 --> 00:39:27,106
your ratings and reviews.


1690
00:39:27,356 --> 00:39:28,616
Better customer experiences, in


1691
00:39:28,616 --> 00:39:29,396
that regard as well.


1692
00:39:30,146 --> 00:39:32,456
For more information about this


1693
00:39:32,456 --> 00:39:34,576
session, we've got some links on


1694
00:39:34,576 --> 00:39:35,106
the website, here.


1695
00:39:35,106 --> 00:39:36,476
And this is Session 303.


1696
00:39:37,666 --> 00:39:38,996
There's also, some related


1697
00:39:38,996 --> 00:39:39,876
sessions, particularly this


1698
00:39:39,876 --> 00:39:40,996
afternoon, with the Advanced


1699
00:39:40,996 --> 00:39:41,906
StoreKit session.


1700
00:39:42,156 --> 00:39:43,496
And I can see you there,


1701
00:39:43,496 --> 00:39:44,536
hopefully, if you come along.


1702
00:39:44,656 --> 00:39:46,326
We've got some more details


1703
00:39:46,326 --> 00:39:47,656
about receipt validation.


1704
00:39:47,656 --> 00:39:48,486
We're going to go really


1705
00:39:48,486 --> 00:39:49,526
in-depth into subscription


1706
00:39:49,526 --> 00:39:50,926
management, persisting state


1707
00:39:50,926 --> 00:39:52,016
across the server environment,


1708
00:39:52,016 --> 00:39:52,626
and that kind of thing.


1709
00:39:52,626 --> 00:39:54,966
So, please come along and we've


1710
00:39:54,966 --> 00:39:55,926
got some more content for you,


1711
00:39:55,926 --> 00:39:56,096
there.


1712
00:39:56,536 --> 00:39:57,836
But that's it for today.


1713
00:39:57,836 --> 00:39:58,816
Thank you, for coming along this


1714
00:39:58,816 --> 00:39:59,206
session.


1715
00:39:59,206 --> 00:39:59,856
And I hope you have a great


1716
00:39:59,856 --> 00:39:59,976
lunch.


1717
00:40:00,516 --> 00:40:03,500
[ Applause ]

