1
00:00:00,506 --> 00:00:09,516
[ Silence ]


2
00:00:10,016 --> 00:00:15,000
[ Applause ]


3
00:00:15,866 --> 00:00:16,346
>> Good morning.


4
00:00:17,016 --> 00:00:18,036
I'm Nathan Taylor.


5
00:00:18,226 --> 00:00:21,186
I manage the iOS Game Center
team and today, I want to talk


6
00:00:21,186 --> 00:00:23,676
to you about Turn-Based
Gaming in Game Center.


7
00:00:24,926 --> 00:00:28,496
So, here are the things
I'm going to cover today.


8
00:00:28,496 --> 00:00:29,966
I'm going to talk
about turn-based gaming


9
00:00:29,966 --> 00:00:30,826
for the most part of this talk.


10
00:00:30,826 --> 00:00:32,906
I'm going to start with a
brief overview, you know,


11
00:00:33,036 --> 00:00:35,646
what is turn-based gaming and
what other multiplayer types


12
00:00:35,826 --> 00:00:37,126
of gaming does Game
Center provide?


13
00:00:38,186 --> 00:00:39,576
Throughout the talk, I'm going


14
00:00:39,576 --> 00:00:41,466
to cover some new features,
will be interspersed.


15
00:00:41,946 --> 00:00:44,016
Let me give you a little load
on what they are in a bit.


16
00:00:45,026 --> 00:00:46,496
Then I'm going to cover
the basic scenarios


17
00:00:46,496 --> 00:00:49,116
of turn-based gaming and this
is sort of all the scenarios


18
00:00:49,456 --> 00:00:51,986
that you need to cover to
make a good turn-based game.


19
00:00:52,986 --> 00:00:55,846
And in doing this, you know, I'm
going to show a lot of code and,


20
00:00:55,846 --> 00:00:57,806
you know, kind of go over some
of the decisions that you have


21
00:00:57,806 --> 00:00:59,436
to make when you're handling
some of the events you get.


22
00:01:00,406 --> 00:01:01,156
And then I'm going to go


23
00:01:01,156 --> 00:01:03,376
into advance scenarios
of turn-based gaming.


24
00:01:03,756 --> 00:01:06,226
These are some of the things
that are difficult to do


25
00:01:06,456 --> 00:01:09,966
with turn-based gaming today
and show you a solution


26
00:01:09,966 --> 00:01:14,566
that we're offering in iOS
7 to help you solve this.


27
00:01:14,726 --> 00:01:18,346
Game Center has three ways
to do multiplayer and play


28
00:01:18,346 --> 00:01:19,366
with your friends, all right.


29
00:01:19,786 --> 00:01:22,746
The first that we offered
is peer-to-peer multiplayer,


30
00:01:23,416 --> 00:01:25,006
you know, and this
is, you know, device--


31
00:01:25,006 --> 00:01:27,246
a device multiplayer
up to four players,


32
00:01:27,576 --> 00:01:29,426
Game Center provides
auto-matching


33
00:01:29,426 --> 00:01:31,936
and invitations and, you
know, we connect the devices


34
00:01:31,936 --> 00:01:34,126
and provide the networking
layer and allow players


35
00:01:34,126 --> 00:01:35,256
to play a synchronous game.


36
00:01:36,476 --> 00:01:37,736
Similarly, we offer, you know,


37
00:01:37,736 --> 00:01:40,936
through the same auto-matching
invitation mechanism a


38
00:01:40,936 --> 00:01:42,716
server-hosted multiplayer.


39
00:01:42,836 --> 00:01:44,996
And this is where you use
Game Center's auto-matching


40
00:01:44,996 --> 00:01:47,216
and invitations you
bring your own server


41
00:01:47,216 --> 00:01:49,546
into your own networking through
your server between the devices.


42
00:01:49,856 --> 00:01:51,626
And this will allow
up to 16 players.


43
00:01:52,416 --> 00:01:54,146
And the topic of
today's session,


44
00:01:54,306 --> 00:01:56,786
turn-based multiplayers
relatively new compared


45
00:01:56,786 --> 00:01:58,026
to this others in Game Center.


46
00:01:58,026 --> 00:02:00,436
And we think it's going
to be ideal solution


47
00:02:00,526 --> 00:02:04,076
in multiplayer allows, you know,
up to 16 players to take turns


48
00:02:04,336 --> 00:02:05,836
and passing the turn, you know,


49
00:02:06,356 --> 00:02:08,856
device in a fully
asynchronous manner.


50
00:02:09,656 --> 00:02:12,006
And this is sort of how
turn-based gaming works,


51
00:02:12,006 --> 00:02:14,476
you know, so we sort of have
this table and people see it


52
00:02:14,476 --> 00:02:17,036
around the table and its kind
of like a board game, right?


53
00:02:17,386 --> 00:02:19,106
Everybody's going to take their
turn and the turn will move


54
00:02:19,106 --> 00:02:19,966
on to the next person.


55
00:02:20,376 --> 00:02:23,586
So, you'll take your turn,
indicate to Game Center


56
00:02:23,586 --> 00:02:27,486
to pass it turn to Sue, Sue will
take her turn, pass it to Bob,


57
00:02:28,146 --> 00:02:30,306
and then we've got an empty
seat here and this is kind


58
00:02:30,306 --> 00:02:31,976
of represents the seat that
we're going to auto-match


59
00:02:31,976 --> 00:02:33,706
and fill with somebody else
who wants to play with us.


60
00:02:34,186 --> 00:02:37,036
So, when the turn passes to the
empty seat we will auto-match


61
00:02:37,036 --> 00:02:39,816
in a new player Meg here,
Meg will take her turn.


62
00:02:40,396 --> 00:02:43,296
And then, the other thing
about turn-based gaming is


63
00:02:43,296 --> 00:02:45,546
that the turn sequence is
entirely determined by you.


64
00:02:45,546 --> 00:02:47,386
It's not purely sequential.


65
00:02:47,786 --> 00:02:49,516
So, you can send the
turn to whoever you need


66
00:02:49,516 --> 00:02:50,596
to base on your game rules.


67
00:02:50,966 --> 00:02:53,616
So, here, you know, Meg
will then turn to Sam, Sam--


68
00:02:53,616 --> 00:02:55,456
sorry, let me start that over.


69
00:02:55,456 --> 00:02:57,856
Sam will send it back to Meg,


70
00:02:57,856 --> 00:03:00,966
and then Meg can
send it back to you.


71
00:03:02,176 --> 00:03:05,226
And this will proceed however
your game [inaudible] needs


72
00:03:05,226 --> 00:03:05,576
to go.


73
00:03:05,576 --> 00:03:09,086
You can implement, you know,
skips, reverses, whatever type--


74
00:03:09,456 --> 00:03:10,416
whatever your game needs.


75
00:03:10,416 --> 00:03:15,076
So, Game Center turn-based
multiplayer provides all the


76
00:03:15,076 --> 00:03:16,596
matchmaking in invitation
services.


77
00:03:16,596 --> 00:03:19,736
Your users can invite their
friends to play or they can pick


78
00:03:19,736 --> 00:03:21,486
up and play an auto-match game


79
00:03:21,486 --> 00:03:22,976
with other players
around the world.


80
00:03:23,846 --> 00:03:25,926
The important part to
remember is the matching


81
00:03:25,926 --> 00:03:27,536
and invites are asynchronous.


82
00:03:27,806 --> 00:03:30,636
You know, invites do not
go out until the turn moves


83
00:03:31,226 --> 00:03:33,326
to the participant that had--


84
00:03:33,326 --> 00:03:34,446
you know, that's
waiting to be invited,


85
00:03:34,776 --> 00:03:36,696
and then when they get the
invitations immediately


86
00:03:36,696 --> 00:03:37,276
their turn.


87
00:03:38,636 --> 00:03:41,286
Game Center, also, provides all
the storage of the game save,


88
00:03:42,126 --> 00:03:44,266
you know, we also do
the synchronization


89
00:03:44,266 --> 00:03:45,316
and the updating of clients.


90
00:03:45,316 --> 00:03:46,536
So, we use push notifications


91
00:03:46,536 --> 00:03:48,816
when you pass the turn
to the next player.


92
00:03:49,406 --> 00:03:52,446
They get notified on their
devices and then they can pull


93
00:03:52,446 --> 00:03:54,236
down the game state and take
their turn and upload it.


94
00:03:55,126 --> 00:03:56,366
The turn-based game scenario


95
00:03:57,266 --> 00:03:59,626
in Game Center also
covers player status.


96
00:03:59,986 --> 00:04:01,756
So, this is where you know,
if hey, this person is


97
00:04:01,756 --> 00:04:04,736
on auto-match, he's invited,
he's actively playing,


98
00:04:05,226 --> 00:04:07,776
has quit the game, or
when the game is over.


99
00:04:10,026 --> 00:04:11,836
With all this, you
know, we kind of feel


100
00:04:11,836 --> 00:04:14,686
that turn-based game is
really the ideal solution


101
00:04:14,686 --> 00:04:17,136
for multiplayer gaming
on a mobile platform.


102
00:04:17,315 --> 00:04:20,086
Users can play whenever
they have spare time.


103
00:04:20,086 --> 00:04:22,516
You know, we always have
our iPhones with us,


104
00:04:22,516 --> 00:04:23,636
our devices in our pocket.


105
00:04:24,236 --> 00:04:27,116
And, you know, we don't
actually have, you know,


106
00:04:27,116 --> 00:04:30,836
10 minutes to sit together with
somebody and play and, you know,


107
00:04:31,346 --> 00:04:34,166
be involved for a real time
game but we have a spare


108
00:04:34,166 --> 00:04:36,236
of minute here, we're
online, we're on the bus


109
00:04:36,236 --> 00:04:38,806
and we can take a couple of
turns then get on with our life.


110
00:04:40,216 --> 00:04:42,116
So, here's a breakdown


111
00:04:42,116 --> 00:04:43,636
of the capabilities
of turn-based gaming.


112
00:04:44,676 --> 00:04:47,196
Users can have up to
30 simultaneous matches


113
00:04:47,326 --> 00:04:49,806
for your game, so they can
be playing with, you know,


114
00:04:49,856 --> 00:04:52,736
30 different games with
however many game friends


115
00:04:52,836 --> 00:04:53,656
that your game allows.


116
00:04:55,466 --> 00:04:57,446
There's up to 16
players per game.


117
00:04:59,446 --> 00:05:01,926
Gameplay as well as invitations


118
00:05:01,926 --> 00:05:04,266
in auto-matching is fully
asynchronous, right?


119
00:05:05,396 --> 00:05:08,846
Player one is taking their turn,
the other players two, three,


120
00:05:08,846 --> 00:05:11,526
four don't know anything
about it until it's completed.


121
00:05:12,936 --> 00:05:15,836
The game data can be
up to 64 kilobytes.


122
00:05:15,836 --> 00:05:18,286
You know, a little a while
ago we increased this


123
00:05:18,286 --> 00:05:19,426
from the initial 4 kilobyte.


124
00:05:19,426 --> 00:05:21,076
We offer 64 kilobytes
of storage.


125
00:05:22,716 --> 00:05:25,026
Seats are filled as I
said through invitations


126
00:05:25,026 --> 00:05:27,196
and auto-matching and
it's fully asynchronous.


127
00:05:29,116 --> 00:05:31,306
The turn order is
entirely up to you.


128
00:05:32,126 --> 00:05:35,056
Game Center doesn't take
any part in the turn order.


129
00:05:35,056 --> 00:05:37,786
You specify who the turn
goes to and you can tell us


130
00:05:37,786 --> 00:05:39,716
who it should we go to next
if that person is unavailable.


131
00:05:42,096 --> 00:05:44,846
And to that effect we
have this fallback list


132
00:05:44,846 --> 00:05:46,276
so you can specify
a complete list;


133
00:05:46,276 --> 00:05:48,896
it could be all the players in
the game of who we should go


134
00:05:48,896 --> 00:05:52,446
to in case the next person is
not available and the person


135
00:05:52,446 --> 00:05:53,436
after that's not available.


136
00:05:53,846 --> 00:05:56,236
So, it provides a recovery
mechanism for games


137
00:05:56,586 --> 00:05:59,016
or people are away or
forget about their game.


138
00:05:59,016 --> 00:06:03,156
And finally, we give time outs.


139
00:06:03,226 --> 00:06:06,196
You can specify a time
out but the default time


140
00:06:06,196 --> 00:06:07,916
of the game center
uses these two weeks.


141
00:06:10,726 --> 00:06:13,086
So, let's take a look
at what actually happens


142
00:06:13,416 --> 00:06:14,096
with the game data.


143
00:06:14,536 --> 00:06:16,836
The way game center
does synchronization


144
00:06:16,836 --> 00:06:17,816
of term based game data is


145
00:06:17,816 --> 00:06:20,446
that the person whose turn
it is is the only person


146
00:06:20,446 --> 00:06:21,486
who can write the game data.


147
00:06:22,076 --> 00:06:24,746
All other players can, you
know, download from the server,


148
00:06:24,976 --> 00:06:27,276
read from it and view the
game state but only the person


149
00:06:27,276 --> 00:06:29,956
who knows the term can write
new data to the servers.


150
00:06:30,496 --> 00:06:32,276
So, you have to turn
here and you're going


151
00:06:32,276 --> 00:06:34,486
to write the data send it up
to the Game Center servers


152
00:06:34,866 --> 00:06:35,906
and pass to turn to Sue.


153
00:06:36,576 --> 00:06:37,756
Sue gets notified.


154
00:06:38,216 --> 00:06:40,256
We badge your application
on Sue's devices,


155
00:06:40,646 --> 00:06:43,096
and then when Sue decides to
launch a game and play it,


156
00:06:43,096 --> 00:06:46,766
he will pull down the game data
and then Sue can take her turn,


157
00:06:47,976 --> 00:06:50,746
move it, pass the turn to
Bob and Bob gets notified.


158
00:06:51,746 --> 00:06:53,206
But Bob is on vacation
and can't play.


159
00:06:54,006 --> 00:06:55,626
So, your time out
comes into effect.


160
00:06:56,226 --> 00:06:58,366
You fallbacks fall
and also take place


161
00:06:59,216 --> 00:07:02,366
and we automatically will
notify Meg who can then pull


162
00:07:02,366 --> 00:07:04,096
down the turn data
and take her turn.


163
00:07:04,256 --> 00:07:05,356
And then, it's up to you.


164
00:07:05,566 --> 00:07:06,736
Do you want to let Meg choose?


165
00:07:06,736 --> 00:07:09,726
Do you want to give Bob another
chance to take his turn later?


166
00:07:10,356 --> 00:07:12,006
Or, do you drop Bob
from the match?


167
00:07:12,566 --> 00:07:14,166
It's up to you and your users


168
00:07:14,166 --> 00:07:15,726
on how your game should
proceed in the state.


169
00:07:17,826 --> 00:07:22,126
So, let's take a quick look at
what the match data is, right?


170
00:07:22,296 --> 00:07:23,986
This is basically
an NSData object.


171
00:07:24,066 --> 00:07:25,796
It's completely opaque
to Game Center.


172
00:07:25,866 --> 00:07:27,036
We don't write anything to it.


173
00:07:27,096 --> 00:07:27,896
We don't read it.


174
00:07:28,326 --> 00:07:31,596
It's just a blob that we pass
it to servers, store for you


175
00:07:31,796 --> 00:07:33,996
and it will let you
download onto--


176
00:07:33,996 --> 00:07:35,436
into the game so you
can show your data.


177
00:07:36,216 --> 00:07:38,386
You completely define
the contents.


178
00:07:38,386 --> 00:07:40,416
Only the current player
can upload new data.


179
00:07:40,416 --> 00:07:43,576
And they can upload new data
with an intermediate upload


180
00:07:43,576 --> 00:07:45,906
and they upload new data
when they finish their turn


181
00:07:45,906 --> 00:07:47,746
and at the end of the game,
you upload the final state.


182
00:07:48,966 --> 00:07:51,346
All other players can read
this data at any time.


183
00:07:51,436 --> 00:07:53,696
The can pull down,
view the current state.


184
00:07:53,736 --> 00:07:56,276
So, if there's stuff you want
them ask in there about turn,


185
00:07:56,276 --> 00:07:58,936
well, you know, sets some flags
in the data so they can see,


186
00:07:59,236 --> 00:08:01,026
hey, you know, this
guy is taking his turn.


187
00:08:01,026 --> 00:08:02,236
I don't want to show you
what he's done, you know,


188
00:08:02,236 --> 00:08:05,426
fog of war type of stuff.


189
00:08:05,426 --> 00:08:08,696
Remember that it's
limited size, 64 kilobytes.


190
00:08:08,696 --> 00:08:10,716
It's not a whole lot, you know.


191
00:08:11,516 --> 00:08:15,966
But you can do a quite a bit
with it as long as you are smart


192
00:08:15,966 --> 00:08:17,376
and you use and, you know,


193
00:08:17,376 --> 00:08:18,916
efficient data packing
strategies.


194
00:08:19,806 --> 00:08:21,686
You know, small games
might be able to get away


195
00:08:21,686 --> 00:08:23,996
with encoding a P-list
or, you know,


196
00:08:23,996 --> 00:08:26,656
serializing our objects
directly into this.


197
00:08:27,026 --> 00:08:30,476
But if you got a more complex
game, you going to want to think


198
00:08:30,476 --> 00:08:33,746
about this, you know, turn your
games into some [inaudible],


199
00:08:33,885 --> 00:08:36,696
use some bit fields, do what you
need to to pack data tightly.


200
00:08:37,296 --> 00:08:40,395
If you need more,
you can always point


201
00:08:40,816 --> 00:08:43,336
to data stored on
your own servers.


202
00:08:43,936 --> 00:08:46,946
And to do this you can either
store reference inside the match


203
00:08:46,946 --> 00:08:49,916
data, or you can
just use the match--


204
00:08:50,116 --> 00:08:51,996
session ID to reference it.


205
00:08:54,786 --> 00:08:56,616
So, users have some
interesting expectations


206
00:08:56,616 --> 00:08:58,116
of turn-based games, right?


207
00:08:58,676 --> 00:08:59,556
It's a little bit different


208
00:08:59,556 --> 00:09:01,196
when they're playing
peer-to-peer game,


209
00:09:01,196 --> 00:09:03,286
you're playing one game
and that's all there is.


210
00:09:04,126 --> 00:09:05,076
You know, you can't
really do anything else.


211
00:09:05,076 --> 00:09:07,126
But with turn-based games
it's always asynchronous,


212
00:09:07,126 --> 00:09:08,326
they can come and
go as they want.


213
00:09:09,596 --> 00:09:11,076
So, to get this, they
expect to be able


214
00:09:11,076 --> 00:09:12,566
to have multiple
simultaneous matches.


215
00:09:12,566 --> 00:09:16,786
So, your game needs to be
able to handle the scenario.


216
00:09:17,016 --> 00:09:18,386
You now, you don't want to be
in this case with the user,


217
00:09:18,386 --> 00:09:20,686
you can just have one match
but somehow get a second


218
00:09:20,686 --> 00:09:23,096
and there's no way to
manage it in your game,


219
00:09:23,096 --> 00:09:24,706
that's a problem, right?


220
00:09:24,706 --> 00:09:26,076
How do they find the match


221
00:09:26,076 --> 00:09:27,236
with the other friend
if they're playing?


222
00:09:28,206 --> 00:09:31,476
Each game has its own
state, its own players,


223
00:09:31,636 --> 00:09:33,536
and in the end, its own outcome.


224
00:09:34,066 --> 00:09:36,616
And some users like to keep
the match around and be able


225
00:09:36,616 --> 00:09:38,366
to show it to their
friends when they've won.


226
00:09:38,586 --> 00:09:40,776
You know, when they got all the
work, all the titles filled,


227
00:09:41,346 --> 00:09:42,566
they can show off
to their friends.


228
00:09:44,716 --> 00:09:45,996
One player at a time, right?


229
00:09:46,426 --> 00:09:47,306
It's turn-based.


230
00:09:47,526 --> 00:09:48,966
There's only one
person taking the turn


231
00:09:49,756 --> 00:09:51,536
and they're the only person
who can upload the game state.


232
00:09:51,976 --> 00:09:54,496
Other players are observers
until it becomes their turn.


233
00:09:54,816 --> 00:09:58,966
And the other thing in
your mind is your game


234
00:09:58,966 --> 00:09:59,976
on the other device
is not running, right?


235
00:10:01,066 --> 00:10:02,716
These things are handled
through notifications


236
00:10:02,716 --> 00:10:03,906
that game center handles.


237
00:10:04,336 --> 00:10:07,316
We will tell you-- your game
will launch when we needed to


238
00:10:07,466 --> 00:10:09,816
and the user going to take,
you know, choose a match,


239
00:10:10,346 --> 00:10:15,906
take their turn, exit, go back
to, you know, doing work and,


240
00:10:16,076 --> 00:10:17,986
you know, whenever they get
a notification they'll take


241
00:10:17,986 --> 00:10:18,576
another turn.


242
00:10:19,826 --> 00:10:21,576
And the tricky part with
turn-based gaming is


243
00:10:21,576 --> 00:10:24,006
because it is asynchronous.


244
00:10:24,006 --> 00:10:27,136
You can get notified about
any of these other 30 matches


245
00:10:27,136 --> 00:10:29,886
that the user might have in
their game at any time, right?


246
00:10:30,126 --> 00:10:31,316
User's playing one match


247
00:10:31,936 --> 00:10:33,916
and gets a new turn
in another match.


248
00:10:34,836 --> 00:10:36,996
Sometimes the right
answer here is take them


249
00:10:36,996 --> 00:10:37,866
to that other match.


250
00:10:38,026 --> 00:10:39,886
Sometimes it's not.


251
00:10:40,496 --> 00:10:43,816
You know, and you often want to
give the user the choice but do


252
00:10:43,816 --> 00:10:46,226
so in as non-disruptive
way of possible.


253
00:10:46,866 --> 00:10:49,596
You also may have
user-viewing the game and one


254
00:10:49,596 --> 00:10:52,786
of the players is not their turn
when someone takes their turn,


255
00:10:52,916 --> 00:10:54,816
you know, and passes it to,
you know, the third player.


256
00:10:55,516 --> 00:10:56,986
And there you might want


257
00:10:56,986 --> 00:10:59,006
to immediately update the state
'cause they're looking at it


258
00:10:59,006 --> 00:11:00,946
and show the live updates.


259
00:11:00,946 --> 00:11:03,846
You can make it feel
like it's a live game.


260
00:11:05,036 --> 00:11:08,076
And I'm going to go into the
decisions you have to make


261
00:11:08,076 --> 00:11:10,296
when handling these kind of
events, so that it can give sort


262
00:11:10,296 --> 00:11:13,286
of the correct and ideal
user experience here.


263
00:11:15,896 --> 00:11:18,406
So, before I start
looking at some scenarios,


264
00:11:18,406 --> 00:11:19,686
let me give an overview of some


265
00:11:19,686 --> 00:11:22,236
of the new features
we have in iOS 7.


266
00:11:23,336 --> 00:11:27,406
One, the first here is that we
allow you to report the scores


267
00:11:27,406 --> 00:11:30,726
and achievements for all
the players of the match


268
00:11:30,726 --> 00:11:33,586
from the one device that
the takes the final turn.


269
00:11:33,586 --> 00:11:36,656
This was a request
and it was a good one.


270
00:11:36,656 --> 00:11:39,116
It was really hard to get the
right scores and achievements


271
00:11:39,116 --> 00:11:41,856
up when actually the last
term can change all that.


272
00:11:42,576 --> 00:11:44,576
So, one player with
the final submission


273
00:11:44,576 --> 00:11:49,406
of the match can report all the
scores, because now this is,


274
00:11:49,546 --> 00:11:51,316
you know, an internet
world and people play


275
00:11:51,316 --> 00:11:52,836
in multiple different
countries and have, you know,


276
00:11:52,836 --> 00:11:53,796
speak different languages.


277
00:11:54,716 --> 00:11:57,726
We now allow for you to
specify turn messages


278
00:11:57,726 --> 00:11:59,976
that will be localized
on the receiver's device.


279
00:12:00,596 --> 00:12:03,856
So, with a little extra work,
you can specify, you know,


280
00:12:03,856 --> 00:12:07,886
when you send the turn, you
know, the message, you know,


281
00:12:08,006 --> 00:12:11,836
key and we will localize it
for the user that receives it.


282
00:12:12,236 --> 00:12:15,926
We also have a new feature to
be able to easily remind people


283
00:12:16,106 --> 00:12:18,596
that have forgotten to take the
turn this is now their turn.


284
00:12:18,596 --> 00:12:20,066
So, there's an API to do this


285
00:12:20,066 --> 00:12:21,956
and you can give
your users buttons


286
00:12:21,956 --> 00:12:23,426
to remind their friend
to take turns.


287
00:12:24,746 --> 00:12:26,536
As alluded to in
the earlier games


288
00:12:26,536 --> 00:12:28,656
in our talk there's an
improved event handling model


289
00:12:28,656 --> 00:12:31,116
and I'm going to go into
some depth on this on how


290
00:12:31,116 --> 00:12:33,846
to use this event handling
model for turn-based games.


291
00:12:35,286 --> 00:12:37,296
And then, we have
a big new feature


292
00:12:37,296 --> 00:12:40,276
and this is what will help us
all in the advance scenarios


293
00:12:40,276 --> 00:12:42,436
in turn-based gaming and we
call turn-based exchanges.


294
00:12:42,976 --> 00:12:45,056
I'm going to talk about
more-- that more at the end.


295
00:12:46,286 --> 00:12:49,756
And lastly, you know, game
center its little tricky debug


296
00:12:49,756 --> 00:12:51,096
at times with turn-based gaming.


297
00:12:51,346 --> 00:12:53,986
And so, we've done a little
bit better parameter checking


298
00:12:54,366 --> 00:12:55,166
in error handling.


299
00:12:55,166 --> 00:12:58,366
So, hopefully, you know, with
iOS 7 you'll get notified


300
00:12:58,366 --> 00:13:00,926
of mistakes that you may making
your code and catch those


301
00:13:00,926 --> 00:13:03,846
in sandbox before you go
live and I hopefully be able


302
00:13:03,846 --> 00:13:04,636
to figure them out easier.


303
00:13:06,846 --> 00:13:10,476
So, let's take a quick look
at the primary classes you use


304
00:13:10,476 --> 00:13:12,496
in doing turn-based gaming
and the principle class


305
00:13:12,496 --> 00:13:14,466
of all is the turn based match.


306
00:13:15,456 --> 00:13:16,996
This represents the
game instance


307
00:13:16,996 --> 00:13:18,886
and you might have 30 of them.


308
00:13:19,346 --> 00:13:21,096
It includes the list
of participants.


309
00:13:21,096 --> 00:13:23,876
You know, these are the
empty seats or the players


310
00:13:23,876 --> 00:13:25,476
that are filled in
and playing the game.


311
00:13:26,256 --> 00:13:27,906
It includes the current
game state.


312
00:13:27,906 --> 00:13:29,766
You know, this is the
NSData that you provided us.


313
00:13:29,916 --> 00:13:32,376
We also let you know who
currently has the turn


314
00:13:32,376 --> 00:13:33,756
so you know if it's your player


315
00:13:34,686 --> 00:13:37,696
on the current device
or someone else.


316
00:13:37,696 --> 00:13:40,366
And with turn-based
exchanges, all exchanges


317
00:13:40,366 --> 00:13:42,476
that have been made
are also listed


318
00:13:42,476 --> 00:13:43,736
and accessible from the match.


319
00:13:44,986 --> 00:13:48,186
The next class, the participant,
you know, this is the seat.


320
00:13:48,756 --> 00:13:50,526
This is how many people
are playing the game


321
00:13:50,816 --> 00:13:52,086
and who they are if you know.


322
00:13:52,736 --> 00:13:55,956
Alright so, if we know who they
are it's a player ID but you got


323
00:13:55,956 --> 00:13:57,856
to keep in mind that
maybe an open seat


324
00:13:57,856 --> 00:13:59,376
and maybe waiting to auto-match.


325
00:13:59,846 --> 00:14:01,926
It may be an invitation
that your player sent,


326
00:14:02,336 --> 00:14:04,466
you'll know who it is but
they haven't actually gotten


327
00:14:04,466 --> 00:14:04,996
to take the turn yet.


328
00:14:05,986 --> 00:14:07,866
This also then includes
the status,


329
00:14:07,936 --> 00:14:09,056
so that you can know
this, right?


330
00:14:09,246 --> 00:14:09,896
Are they invited?


331
00:14:09,896 --> 00:14:10,696
Are they matching?


332
00:14:11,316 --> 00:14:12,946
Are they currently
playing the game?


333
00:14:13,816 --> 00:14:14,566
Or are they done?


334
00:14:15,766 --> 00:14:18,296
And lastly and it's a little bit
often forgotten is the outcome.


335
00:14:18,896 --> 00:14:20,426
For each participant of the game


336
00:14:20,426 --> 00:14:22,966
when you end the game we've
[inaudible] a mechanism


337
00:14:22,966 --> 00:14:25,826
to set the outcome and we
provide you a basic enum


338
00:14:25,826 --> 00:14:28,336
so you can set this
to, you know one lost,


339
00:14:28,336 --> 00:14:29,746
first, second third place.


340
00:14:29,896 --> 00:14:32,376
And there's also a range
in this [inaudible]


341
00:14:32,376 --> 00:14:34,466
that you can use
for custom outcomes.


342
00:14:34,466 --> 00:14:36,926
So, you can use this to
display state in your game.


343
00:14:37,706 --> 00:14:40,806
And you need to fill this
in when you end the game


344
00:14:41,586 --> 00:14:43,356
or when a player
quits on their turn.


345
00:14:45,996 --> 00:14:49,856
So, the other class, you
know, that you often use this


346
00:14:49,856 --> 00:14:53,216
that the Game Center GK
turn-based match maker


347
00:14:53,216 --> 00:14:53,686
view control.


348
00:14:53,796 --> 00:14:56,236
This is the Game Center
interface for turn-based games.


349
00:14:56,786 --> 00:14:58,866
Now, if you want easy access


350
00:14:58,866 --> 00:15:01,536
to creating matches
inviting friends


351
00:15:01,596 --> 00:15:04,376
and listening available matches
and allowing management of this,


352
00:15:04,706 --> 00:15:05,876
you can use the view controller.


353
00:15:06,626 --> 00:15:08,586
It per basically provides
management from matches.


354
00:15:13,186 --> 00:15:15,766
So, let's look at
the basic scenarios


355
00:15:15,766 --> 00:15:18,496
that all turn-based games kind
of has to be able to handle.


356
00:15:19,026 --> 00:15:21,266
And I'd like to say, you know,
that is only three items,


357
00:15:21,496 --> 00:15:23,146
but I've got seven on the slide.


358
00:15:23,776 --> 00:15:24,856
You know, and the
kind of a grouped


359
00:15:24,856 --> 00:15:25,806
into sort of three things.


360
00:15:25,806 --> 00:15:30,276
Creating a match, dealing with
the turns and then dealing with,


361
00:15:30,276 --> 00:15:31,856
you know, and managing
multiple matches.


362
00:15:31,856 --> 00:15:33,786
So, the first thing
you're going to want


363
00:15:33,786 --> 00:15:36,236
to build is make sure a way--
there's a way that in your app


364
00:15:36,236 --> 00:15:39,226
for user to create a match
and invite their friends.


365
00:15:39,926 --> 00:15:41,816
Then the thing you're
going to do most often


366
00:15:42,766 --> 00:15:43,776
and most important thing


367
00:15:43,776 --> 00:15:45,586
to get absolutely right
is playing a turn, right?


368
00:15:45,586 --> 00:15:48,436
This is your game logic and then
how you communicate that turn


369
00:15:48,436 --> 00:15:49,386
to the Game Center server.


370
00:15:49,386 --> 00:15:54,716
At the end of the match, when
all the turns are taken you need


371
00:15:54,716 --> 00:15:55,886
to end the match appropriately.


372
00:15:56,386 --> 00:15:58,386
This will notify all the
users that the game is over


373
00:15:59,116 --> 00:16:01,506
and just put it into
the completed section


374
00:16:01,506 --> 00:16:03,896
of the other list and make it so
they can remove it if they want.


375
00:16:04,726 --> 00:16:07,246
And then in managing
matches, you need to be able


376
00:16:07,246 --> 00:16:12,106
to list all the open matches,
remove a match and quit a match.


377
00:16:12,296 --> 00:16:14,006
In quitting, there're
two ways, you know,


378
00:16:14,006 --> 00:16:17,936
in turn or out of turn.


379
00:16:18,146 --> 00:16:21,626
So, creating a match can be
done with the view controller.


380
00:16:21,626 --> 00:16:23,186
If you want to use our UI,


381
00:16:23,796 --> 00:16:25,616
you can use the turn-based
matchmaker view controller,


382
00:16:26,166 --> 00:16:27,526
provides all the
management you need,


383
00:16:28,066 --> 00:16:31,226
list the matches allows users to
remove them with a little help


384
00:16:31,226 --> 00:16:33,126
from you, they can quit in turn


385
00:16:33,856 --> 00:16:36,186
and it provides auto-matching
invitations.


386
00:16:36,856 --> 00:16:40,866
And you create this by
specifying a match request.


387
00:16:41,676 --> 00:16:44,286
However, if you want to do it
programmatically and you want


388
00:16:44,286 --> 00:16:47,666
to provide your own UI for this
and we encourage this, you know,


389
00:16:47,666 --> 00:16:49,166
nothing kind of fits
better in your app


390
00:16:49,536 --> 00:16:51,186
than your own, UI design.


391
00:16:51,766 --> 00:16:53,806
We provide a mechanism so
you can do auto-matching


392
00:16:53,806 --> 00:16:54,986
and invitations
programmatically.


393
00:16:54,986 --> 00:16:57,146
And that's what I'm
going to show you next.


394
00:16:57,146 --> 00:16:59,316
It's really not too difficult.


395
00:16:59,316 --> 00:17:03,286
This is how to create a
match and allows someone


396
00:17:03,286 --> 00:17:04,695
to invite their friends
at the same time.


397
00:17:05,266 --> 00:17:07,796
So, you provide a mechanism
what the user choose,


398
00:17:07,876 --> 00:17:09,836
which friends they want
to invite, you know,


399
00:17:09,836 --> 00:17:11,376
get the player ID's
of these friends.


400
00:17:11,376 --> 00:17:13,776
Set up a match request.


401
00:17:14,636 --> 00:17:16,626
We'll just specify the
minimum and maximum number


402
00:17:16,626 --> 00:17:17,996
of players here, four and four.


403
00:17:19,415 --> 00:17:22,026
And then we'll set the
players to invite on a--


404
00:17:22,316 --> 00:17:23,236
on the match request, right?


405
00:17:23,236 --> 00:17:24,616
So, players to invite
as a property


406
00:17:24,616 --> 00:17:29,216
that you put your friend ID's
in and set the invite message.


407
00:17:29,776 --> 00:17:33,146
Usually this is something we've
recommend you'll have the user


408
00:17:33,146 --> 00:17:34,626
type in 'cause this is kind


409
00:17:34,626 --> 00:17:36,086
of a personal message that's
[inaudible] to the friends


410
00:17:36,086 --> 00:17:36,806
that you're going to invite.


411
00:17:38,126 --> 00:17:41,496
And then one API call,
it's a class method


412
00:17:41,496 --> 00:17:44,636
on GK turn-based matching you
can call, find match for request


413
00:17:45,386 --> 00:17:48,136
with your request and
then a completion handler.


414
00:17:48,456 --> 00:17:52,366
On completion, you
either get a match,


415
00:17:52,456 --> 00:17:54,576
it will immediately be your
players turn in that match.


416
00:17:54,576 --> 00:17:57,266
They'll need to take some
action or you'll get an error


417
00:17:57,336 --> 00:17:58,876
if we were unable to
create that match for you.


418
00:18:02,556 --> 00:18:05,486
So, said users can
enable to matches


419
00:18:05,486 --> 00:18:09,036
and you can see matches here
can be in various states.


420
00:18:09,036 --> 00:18:10,456
It might be your players turn.


421
00:18:10,456 --> 00:18:11,766
It might be someone else's turn.


422
00:18:12,316 --> 00:18:14,776
You know, so, how
do you handle this?


423
00:18:15,256 --> 00:18:16,536
Well, it's really simple.


424
00:18:16,776 --> 00:18:19,596
There's pretty much two
APIs and you do and sort


425
00:18:19,596 --> 00:18:22,146
of two actions you need to take.


426
00:18:22,296 --> 00:18:25,296
If you want to list matches,
build your own UI around this.


427
00:18:25,466 --> 00:18:27,796
You can use the class
method, load matches


428
00:18:27,796 --> 00:18:28,706
with completion handler.


429
00:18:28,706 --> 00:18:33,046
And this will give you an
array of the existing matches.


430
00:18:33,096 --> 00:18:35,226
All the active matches,
all the completed matches


431
00:18:35,226 --> 00:18:36,856
and then you can sort
this as you'd like


432
00:18:36,856 --> 00:18:37,846
and display it to the user.


433
00:18:39,316 --> 00:18:41,096
When the user's done
with the match, you know,


434
00:18:41,096 --> 00:18:42,356
you want to implement
some way for them


435
00:18:42,356 --> 00:18:44,326
to remove this match
from their list.


436
00:18:44,396 --> 00:18:48,116
You know, some matches will
get auto removed overtime


437
00:18:48,116 --> 00:18:50,366
as new matches are
created, but users want


438
00:18:50,366 --> 00:18:51,066
to keep their list clean.


439
00:18:51,066 --> 00:18:53,186
So, provide a mechanism
when you remove a match


440
00:18:53,186 --> 00:18:54,466
and it's quite simple.


441
00:18:54,726 --> 00:18:57,656
It's an instance method on the
turn-based match called Remove


442
00:18:57,656 --> 00:18:59,866
with Completion Handler and
this will simply remove it


443
00:18:59,866 --> 00:19:01,576
from the users match list.


444
00:19:02,866 --> 00:19:04,946
And then alternatively you
can use the view controller.


445
00:19:06,756 --> 00:19:08,276
So, most important
thing you can do


446
00:19:08,276 --> 00:19:10,226
in any turn-based
game is take turns.


447
00:19:10,426 --> 00:19:12,376
Every player in the
game presumably is going


448
00:19:12,376 --> 00:19:15,076
to take a turn, multiple
turns and this is going


449
00:19:15,076 --> 00:19:16,926
to be the most common
thing and there's a lot


450
00:19:16,926 --> 00:19:18,086
of stuff you want to do here.


451
00:19:19,866 --> 00:19:23,006
So, essentially taking a turn
involves making the match data,


452
00:19:23,006 --> 00:19:26,216
passing it up to the server,
setting who the player is next.


453
00:19:28,056 --> 00:19:30,316
And so, let's take a look
at the actual full sequence.


454
00:19:30,526 --> 00:19:33,116
First, you're going to
unload the current state


455
00:19:33,116 --> 00:19:33,636
from the server.


456
00:19:33,636 --> 00:19:36,736
So, this is the effect, pulling
down the most recent match data,


457
00:19:36,876 --> 00:19:39,626
so that you have current stuff--
most current data to operate on.


458
00:19:40,486 --> 00:19:42,406
You will then apply
your game logic to it


459
00:19:42,646 --> 00:19:44,316
to both allow the user
to take their turn.


460
00:19:45,516 --> 00:19:47,986
You will then be able to save
the enemy, hit save if you want.


461
00:19:47,986 --> 00:19:50,416
So, if the users in the middle
of the turn, it's really nice


462
00:19:50,456 --> 00:19:52,876
to let them save their state
so that if they want to resume


463
00:19:52,876 --> 00:19:55,626
on another device, but they
happen to put the device away


464
00:19:56,056 --> 00:19:58,686
and your app gets jetsam to be
able to come back and come back


465
00:19:58,686 --> 00:20:00,086
to where they were in
the middle of their turn.


466
00:20:00,086 --> 00:20:00,976
You can save the enemy at state.


467
00:20:01,056 --> 00:20:05,106
And in doing this, you have to
keep in mind that other players


468
00:20:05,106 --> 00:20:08,806
in the game can see that state
unless you explicitly kind


469
00:20:08,806 --> 00:20:10,576
of hide it through flags
in the match state.


470
00:20:12,136 --> 00:20:14,766
Next, when the user is done,
they've taken their turn,


471
00:20:14,766 --> 00:20:16,066
you know, kind of the results.


472
00:20:16,586 --> 00:20:18,766
You need to choose the next
player sequence, right?


473
00:20:19,196 --> 00:20:21,966
Who should the turn go to
next and specify the fallback


474
00:20:21,966 --> 00:20:24,086
so that we can recover
gracefully


475
00:20:24,086 --> 00:20:25,646
if that person is unable
to take their turn.


476
00:20:26,816 --> 00:20:29,016
And then finally, you're
going to submit the turn


477
00:20:29,016 --> 00:20:32,106
to Game Center and Game Center
will then notify the next player


478
00:20:32,666 --> 00:20:33,806
and this will repeat.


479
00:20:34,986 --> 00:20:37,046
So, to load the current state,


480
00:20:37,366 --> 00:20:39,306
there's basically a
single API to do this.


481
00:20:39,506 --> 00:20:42,956
It's an instance method on
the match, load match data


482
00:20:42,956 --> 00:20:43,846
with completion handler.


483
00:20:44,546 --> 00:20:46,626
This will return to you,
your latest match data


484
00:20:46,626 --> 00:20:50,196
and then usually what you'll
do is take the match data,


485
00:20:50,686 --> 00:20:52,786
you know, and apply it
to your view controller


486
00:20:52,786 --> 00:20:53,726
and show it to the user.


487
00:20:57,226 --> 00:20:59,486
After that, you know,
you've let your user play


488
00:20:59,486 --> 00:21:00,186
with the match there, right.


489
00:21:00,186 --> 00:21:01,036
They've taken their turn.


490
00:21:01,036 --> 00:21:02,256
They manipulated
the data, they've--


491
00:21:02,396 --> 00:21:05,836
you know, drawn some cards,
moved their token, roll the die.


492
00:21:06,696 --> 00:21:08,536
You'll want to, you
know, update the match


493
00:21:08,536 --> 00:21:10,656
or generate the new match
data for the user actions.


494
00:21:12,086 --> 00:21:15,686
Now, because I said,
you know, your device


495
00:21:15,686 --> 00:21:17,966
and user make want to-- you
need to put your app away,


496
00:21:18,266 --> 00:21:20,256
your app is in the
background and make it jetsam.


497
00:21:21,096 --> 00:21:24,556
The user might want to
switch to another device


498
00:21:25,226 --> 00:21:26,176
and pick this up later.


499
00:21:26,616 --> 00:21:29,336
Save the enemy that
state to server, right?


500
00:21:29,416 --> 00:21:32,606
And to do this, there's an
API called save current turn


501
00:21:32,606 --> 00:21:34,996
with match data with
completion handler.


502
00:21:35,546 --> 00:21:38,236
This doesn't move who
the current turn is.


503
00:21:38,266 --> 00:21:40,736
This only uploads the new
data or into the server


504
00:21:40,736 --> 00:21:42,126
so that's available
to all the players.


505
00:21:43,626 --> 00:21:45,066
And then, we're going
to continue,


506
00:21:45,356 --> 00:21:46,566
you know, taking the turn.


507
00:21:47,156 --> 00:21:50,546
So, the next step as I
mentioned was to choose


508
00:21:50,996 --> 00:21:52,236
who which you go to next.


509
00:21:54,666 --> 00:21:57,336
This is entirely based
on your game rules.


510
00:21:57,626 --> 00:21:59,196
Game Center doesn't
really take any part


511
00:21:59,196 --> 00:22:00,556
in who the turn goes to next.


512
00:22:01,646 --> 00:22:03,136
The things you keep
mind though is you need


513
00:22:03,136 --> 00:22:06,806
to select active players
or players that you want


514
00:22:06,806 --> 00:22:08,906
to become active,
remember auto-matching


515
00:22:08,906 --> 00:22:10,286
and invitation is asynchronous.


516
00:22:10,986 --> 00:22:13,416
To get those people into the
game, to get send invites


517
00:22:13,416 --> 00:22:15,966
to auto-matching when--
they need to get the turn.


518
00:22:15,966 --> 00:22:20,106
And when they do, it will
be that persons turn.


519
00:22:20,266 --> 00:22:23,786
You also want to be able to
guard against missed turns.


520
00:22:23,886 --> 00:22:27,216
So, you can check to see
if a player has timed


521
00:22:27,216 --> 00:22:29,846
out in the past, right?


522
00:22:29,846 --> 00:22:31,326
And you can also provide--


523
00:22:31,326 --> 00:22:33,456
you provided us the list of
the multiple participants.


524
00:22:33,456 --> 00:22:34,666
You're not picking
just the next person.


525
00:22:34,666 --> 00:22:35,646
You're going to give
us everybody.


526
00:22:36,316 --> 00:22:37,836
You can find out who timed out.


527
00:22:38,596 --> 00:22:40,876
Make the decision or look if the
user choose whether they should,


528
00:22:40,876 --> 00:22:43,966
you know, still be in the game,
you know, if they time out,


529
00:22:43,966 --> 00:22:45,836
did they forfeit or did
they get three tries.


530
00:22:46,656 --> 00:22:47,836
That's up to you, right?


531
00:22:50,136 --> 00:22:52,486
You then, you know, just specify
this list of participants.


532
00:22:52,836 --> 00:22:56,926
You're going to use time outs so
that if someone takes too long


533
00:22:56,926 --> 00:22:58,836
or it's not available to
move on to the next person.


534
00:23:00,036 --> 00:23:03,106
The last person on this list
because after that games


535
00:23:03,106 --> 00:23:05,316
and doesn't know what
to do won't time out.


536
00:23:05,316 --> 00:23:09,536
And what we actually recommend
you do here is basically specify


537
00:23:09,536 --> 00:23:11,706
the full turn cycle
and put the last person


538
00:23:11,706 --> 00:23:13,566
on the list is the person who
is currently taking the turn.


539
00:23:14,236 --> 00:23:17,076
This way if everything
goes wrong,


540
00:23:17,766 --> 00:23:19,326
the person who took
the turn last played


541
00:23:19,326 --> 00:23:22,026
in the game can make a decision
of, all right, if I want to give


542
00:23:22,026 --> 00:23:24,696
up on this game, I want to
go play with someone else


543
00:23:24,696 --> 00:23:26,846
or do I try again, right?


544
00:23:29,466 --> 00:23:32,426
So, this is the work
that you need to do here.


545
00:23:32,536 --> 00:23:34,816
There aren't really an API's
on this slide but you're going


546
00:23:34,816 --> 00:23:38,146
to again update your match
data with the latest state.


547
00:23:39,216 --> 00:23:44,266
You're going to determine
the next participant list


548
00:23:44,266 --> 00:23:46,606
and then you're going
set up a turn message.


549
00:23:46,706 --> 00:23:49,186
And this gets us into
the next new feature,


550
00:23:50,056 --> 00:23:52,906
localizable message.


551
00:23:52,906 --> 00:23:53,546
You're essentially going


552
00:23:53,546 --> 00:23:56,406
to be providing us localizable
strings in your bundle.


553
00:23:57,246 --> 00:24:01,356
Game Center will use the strings
on the recipient's device


554
00:24:01,736 --> 00:24:04,146
to generate the message that
we show in notification center


555
00:24:04,146 --> 00:24:07,106
on the lock screen and
the message of this show


556
00:24:07,106 --> 00:24:09,696
and the Game Center
user interface both


557
00:24:09,696 --> 00:24:10,716
from the Game Center app.


558
00:24:11,586 --> 00:24:14,106
And in the-- you know, in
game UI in your screen.


559
00:24:14,106 --> 00:24:18,316
So, this allows us to actually
show something, a message here


560
00:24:18,656 --> 00:24:22,036
that is localized to, you
know, the user current device.


561
00:24:22,356 --> 00:24:24,686
And we've seen games that
you, you know, that, you know,


562
00:24:24,736 --> 00:24:26,606
this player played
this word, right?


563
00:24:26,606 --> 00:24:28,876
It would be nice
to be able to make


564
00:24:28,876 --> 00:24:34,046
that appropriately localized
and this can be a format string.


565
00:24:34,896 --> 00:24:37,366
All right, so that you can say
you can specify the player name,


566
00:24:38,266 --> 00:24:40,396
you give us the word
played and with any formats


567
00:24:40,396 --> 00:24:41,666
and with to format parameters.


568
00:24:42,186 --> 00:24:44,406
And then you give us, you know,
the word if you're a word game.


569
00:24:46,606 --> 00:24:50,406
We localize it on the recipients
device, but before we send it,


570
00:24:50,406 --> 00:24:53,816
we also as a fallback localize
it on the senders device


571
00:24:53,816 --> 00:24:56,616
and the senders language,
because there is a chance


572
00:24:56,716 --> 00:24:59,136
that the person, if it's
being invited to play the game


573
00:24:59,136 --> 00:25:01,466
for the first time it may
not have it on the device.


574
00:25:01,466 --> 00:25:02,536
Their bundle's not there.


575
00:25:02,796 --> 00:25:04,096
We can't localize the message,


576
00:25:04,256 --> 00:25:07,466
but we will have
something to fallback to.


577
00:25:07,676 --> 00:25:11,886
And then, you know, ideally the
user will quick notification


578
00:25:11,886 --> 00:25:13,366
Game Center will take
them to the store


579
00:25:13,366 --> 00:25:14,306
and they will buy your game.


580
00:25:15,806 --> 00:25:17,546
To do this, we need
two items from you.


581
00:25:18,326 --> 00:25:21,816
The first and most important
is the message string


582
00:25:22,396 --> 00:25:22,886
or format string.


583
00:25:22,886 --> 00:25:24,936
You know, this is works to
the standard, and you know,


584
00:25:25,146 --> 00:25:26,576
localizable strings mechanism.


585
00:25:26,576 --> 00:25:29,936
So, you're going to specify a
string key that will be looked


586
00:25:29,936 --> 00:25:33,416
up in your localizable strings
table inside of the bundle


587
00:25:33,416 --> 00:25:34,396
on the recipient device.


588
00:25:35,516 --> 00:25:39,026
Optionally, if you're using a
format string, you can pass this


589
00:25:39,086 --> 00:25:40,976
to us in array of
format arguments.


590
00:25:43,836 --> 00:25:45,696
So, let's look at how
we do this, right?


591
00:25:46,236 --> 00:25:48,466
This first part is
your job, you know,


592
00:25:48,786 --> 00:25:51,906
giving us the key
and the arguments.


593
00:25:51,906 --> 00:25:55,246
Then on the match, you're going
to set the localizable message


594
00:25:55,246 --> 00:25:57,566
with this key and arguments.


595
00:25:58,696 --> 00:26:00,236
And then, finally
we're to the meat


596
00:26:00,236 --> 00:26:01,786
of this whole taking
a turn sequence.


597
00:26:01,786 --> 00:26:03,576
This is the last bit.


598
00:26:04,236 --> 00:26:05,446
We're going to end
the turn, right.


599
00:26:05,716 --> 00:26:07,776
Your user has done
everything that you need to do.


600
00:26:07,776 --> 00:26:09,476
It's time for the next
person to take their turn.


601
00:26:09,936 --> 00:26:11,096
So, you will call in turn


602
00:26:11,096 --> 00:26:13,836
with next participants
specifying there's array


603
00:26:13,836 --> 00:26:15,366
of participants that
we determined earlier.


604
00:26:15,836 --> 00:26:19,246
Specifying a time out, here
we use the default time


605
00:26:19,246 --> 00:26:23,856
out using your current match
data that you determined earlier


606
00:26:24,806 --> 00:26:27,146
and then the completion handle
would be called with an error


607
00:26:27,546 --> 00:26:29,876
if there is a problem
submitting this turn, otherwise,


608
00:26:29,876 --> 00:26:32,476
it will move on to the next
player and they will be notified


609
00:26:32,476 --> 00:26:34,006
and the game will proceed.


610
00:26:36,536 --> 00:26:38,276
Reminders, this is
another new feature, right.


611
00:26:39,726 --> 00:26:42,946
Turns-- Turn-based games
is fully asynchronous.


612
00:26:44,156 --> 00:26:47,426
You know, we notify the
user, they download the data


613
00:26:47,426 --> 00:26:50,046
when they're ready to take a
turn but nothing happens if,


614
00:26:50,046 --> 00:26:52,426
you know, until they actually
launched the game and do it.


615
00:26:52,996 --> 00:26:54,966
The games can only
proceed as fast


616
00:26:54,966 --> 00:26:56,606
as their slowest player, right.


617
00:26:57,176 --> 00:26:58,396
Each player gets a turn.


618
00:26:58,586 --> 00:26:59,866
They spend their
time taking up turn.


619
00:26:59,866 --> 00:27:01,166
They forget about it perhaps.


620
00:27:01,746 --> 00:27:04,636
Time outs and fallbacks help
keep things moving along.


621
00:27:05,176 --> 00:27:07,126
Help us recover from
failure cases.


622
00:27:07,846 --> 00:27:10,966
But it's really nice to be
able to continue in the game


623
00:27:10,966 --> 00:27:13,666
and be able to nudge someone,
"Hey, remember you're playing


624
00:27:13,666 --> 00:27:14,976
with me and take your turn now."


625
00:27:15,766 --> 00:27:20,386
So, sometimes, you need to
remind a player to play.


626
00:27:21,976 --> 00:27:25,766
And we do this through a simple
API and to send a reminder


627
00:27:25,766 --> 00:27:26,616
on the turn-based game.


628
00:27:26,906 --> 00:27:30,286
It's a single one way push
with a localizable message.


629
00:27:30,286 --> 00:27:33,906
Let's take a look at
the code to do this.


630
00:27:33,906 --> 00:27:37,066
Just as before, you're going
to set up a localizable message


631
00:27:37,906 --> 00:27:41,646
with arguments and then call.


632
00:27:41,646 --> 00:27:42,976
Send reminder to participants.


633
00:27:43,046 --> 00:27:47,376
Note that is actually
an array of participants


634
00:27:47,716 --> 00:27:50,826
with the localizable
message key in arguments


635
00:27:50,826 --> 00:27:51,666
and the completion handler.


636
00:27:52,796 --> 00:27:54,276
And you'll see why
the array is kind


637
00:27:54,276 --> 00:27:55,656
of important a little bit later


638
00:27:56,376 --> 00:27:57,836
but the common case
is the sender


639
00:27:57,836 --> 00:27:59,066
to who currently has the turn.


640
00:27:59,886 --> 00:28:01,966
But there are cases
with some new features,


641
00:28:02,006 --> 00:28:05,056
turn-based exchanges where you
might be waiting on actions


642
00:28:05,056 --> 00:28:07,306
from multiple people and
you can remind everybody


643
00:28:07,306 --> 00:28:08,166
to take their actions.


644
00:28:09,966 --> 00:28:12,376
So, it's all over, right?


645
00:28:12,546 --> 00:28:13,776
All the turns have been taken.


646
00:28:14,706 --> 00:28:16,066
All the cards are played.


647
00:28:17,016 --> 00:28:19,166
You know, there's no more
property to buy somewhere.


648
00:28:19,166 --> 00:28:20,146
Everybody's gone bankrupt.


649
00:28:20,386 --> 00:28:21,726
Whatever rules determine the end


650
00:28:21,726 --> 00:28:23,696
of your game and
you decide that.


651
00:28:23,696 --> 00:28:27,016
And instead of take-- the
last person taking their turn


652
00:28:27,016 --> 00:28:28,036
and moving on to someone else.


653
00:28:28,546 --> 00:28:29,986
You decide that, all
right the game is over.


654
00:28:30,456 --> 00:28:31,966
And now, I need to end the game.


655
00:28:32,736 --> 00:28:33,456
And what do you need to do?


656
00:28:33,456 --> 00:28:35,956
So, when it's all
over, you know,


657
00:28:35,956 --> 00:28:36,976
there are various
reasons this can happen.


658
00:28:37,356 --> 00:28:41,976
They finish your game
according to the rules, right.


659
00:28:41,976 --> 00:28:45,366
There's nothing left
to do in the game.


660
00:28:45,366 --> 00:28:47,686
And then, there are other cases
where games can end, right?


661
00:28:48,286 --> 00:28:51,906
If everybody quits the game, you
know, and they can quit in turn


662
00:28:51,946 --> 00:28:55,326
or they can forfeit
the game out of turn.


663
00:28:55,326 --> 00:28:57,276
You know, these are things to
think about in winning the game.


664
00:28:58,636 --> 00:29:01,496
But ultimately the game is
ended by the last person


665
00:29:01,686 --> 00:29:03,896
to play instead of
taking their turn.


666
00:29:03,896 --> 00:29:05,896
And so, instead of
calling in turn


667
00:29:05,896 --> 00:29:09,026
with next participants you're
going to call a different API


668
00:29:09,026 --> 00:29:10,956
and let me get to that.


669
00:29:11,176 --> 00:29:15,386
So, before we end the game,
right, it's usual to be able


670
00:29:15,386 --> 00:29:16,976
to say and let the user
know, who won, who lost.


671
00:29:17,276 --> 00:29:21,006
So, we'd like you
to set the outcomes.


672
00:29:21,546 --> 00:29:24,246
So, we start here by taking
the current match data


673
00:29:24,776 --> 00:29:27,496
and determining your final match
data, this last match data.


674
00:29:27,956 --> 00:29:30,576
You know, this is so that
everybody whose still has the


675
00:29:30,576 --> 00:29:32,946
game in their session list
can download the match data,


676
00:29:33,326 --> 00:29:36,406
can show off how well or poorly
they did to their friends.


677
00:29:37,796 --> 00:29:41,766
Then you're going to walk
over all the participants


678
00:29:41,766 --> 00:29:45,916
in the match and then for each
active participant, you know,


679
00:29:45,916 --> 00:29:48,126
people out still
playing, you know,


680
00:29:48,126 --> 00:29:50,116
we want you to change
their status to done,


681
00:29:50,116 --> 00:29:51,786
because they're not
playing anymore, and then,


682
00:29:51,786 --> 00:29:52,976
determine their outcome and
set the outcome property.


683
00:29:53,096 --> 00:29:57,466
This is entirely
based on you, right?


684
00:29:57,466 --> 00:29:59,296
You're going to look at
the match data, you know,


685
00:29:59,426 --> 00:30:01,186
you know the positions
of the different player,


686
00:30:01,216 --> 00:30:03,286
you'll set the outcome,
and you can use our enums


687
00:30:03,286 --> 00:30:05,506
or you can use-- you notice
the reserved bit range


688
00:30:05,536 --> 00:30:06,976
and user custom outcome so
you can pull this down later.


689
00:30:07,046 --> 00:30:09,736
This will be saved in the
match when you end the turn.


690
00:30:09,736 --> 00:30:11,486
And so, when later you
download the match,


691
00:30:11,616 --> 00:30:13,976
you can query this
off to participants.


692
00:30:14,516 --> 00:30:24,046
[ Pause ]


693
00:30:24,546 --> 00:30:26,946
Let's continue on the
ending the game here.


694
00:30:27,466 --> 00:30:30,766
We get to another new feature
and this is what I kind


695
00:30:30,766 --> 00:30:31,756
of start of any features.


696
00:30:32,066 --> 00:30:35,596
At the end of the game,
you now know the scores


697
00:30:35,596 --> 00:30:38,386
that everybody got, the
achievements that everybody got.


698
00:30:38,626 --> 00:30:40,786
And this used to be
a real kind of tricky


699
00:30:40,786 --> 00:30:42,176
in hairy situation, right?


700
00:30:42,946 --> 00:30:46,986
You-- Before now, you would have
to kind of submit a new score


701
00:30:46,986 --> 00:30:49,006
as everybody took a
turn and kind of hope


702
00:30:49,006 --> 00:30:50,756
that that was the final,
you know, representative


703
00:30:50,756 --> 00:30:52,156
of the final score at
the end of the match.


704
00:30:53,436 --> 00:30:55,016
And submit achievements
as their earned


705
00:30:55,016 --> 00:30:56,686
and we still recommend
you to do that.


706
00:30:57,356 --> 00:31:01,046
But at the end of the game
you can now generate scores


707
00:31:01,236 --> 00:31:03,516
for all the participants
and generate achievements


708
00:31:03,516 --> 00:31:04,556
for all the participants.


709
00:31:04,876 --> 00:31:08,276
There are new APIs for
initialization of scores


710
00:31:08,276 --> 00:31:09,976
as you can meet them
with player IDs.


711
00:31:09,976 --> 00:31:11,506
So, they will be specified


712
00:31:11,506 --> 00:31:13,566
to someone who's not
the local player.


713
00:31:14,146 --> 00:31:18,636
And then, when you're in the
match you can use the new API


714
00:31:18,636 --> 00:31:22,366
to in match and turn
with the new match data.


715
00:31:22,546 --> 00:31:23,756
This is your final match data


716
00:31:24,446 --> 00:31:27,316
and we give us the
scores and achievements.


717
00:31:27,316 --> 00:31:29,826
Games Center then we'll submit
these scores and achievements


718
00:31:30,236 --> 00:31:32,976
in bulk associated
specifically with this match.


719
00:31:33,226 --> 00:31:34,786
So, we know who is
participating.


720
00:31:35,336 --> 00:31:37,166
You can't submit scores
or achievements for people


721
00:31:37,166 --> 00:31:38,506
that weren't members
of this match.


722
00:31:39,226 --> 00:31:42,426
This is really the only way to
submit scores for someone else


723
00:31:42,426 --> 00:31:44,836
and we're using the
match and the match data


724
00:31:44,836 --> 00:31:48,346
and the participants on the
servers as a verification


725
00:31:48,346 --> 00:31:50,486
of this data that things
are being submitted


726
00:31:50,486 --> 00:31:51,376
for the appropriate people.


727
00:31:51,376 --> 00:31:54,016
And then at the end
of the match,


728
00:31:54,016 --> 00:31:56,136
you get a completion handler
an error will tell you


729
00:31:56,136 --> 00:31:57,486
if there're some
problems submitting this.


730
00:32:00,096 --> 00:32:00,676
That's it.


731
00:32:00,826 --> 00:32:02,556
When you're done,
that match is over.


732
00:32:02,556 --> 00:32:04,956
Your user can look at it
and view it some other time,


733
00:32:05,426 --> 00:32:06,866
move on to other
matches and play.


734
00:32:08,746 --> 00:32:10,886
But all along this process,


735
00:32:11,166 --> 00:32:14,736
because turn-based gaming is
asynchronous, there were events.


736
00:32:15,036 --> 00:32:18,016
You've got events for invites,
the very start of the match.


737
00:32:18,406 --> 00:32:21,686
You got events whenever it
became your players turn.


738
00:32:22,206 --> 00:32:25,196
And you get events when the
turn move between other players.


739
00:32:25,916 --> 00:32:32,476
We have a new mechanism in
iOS 7 to handle these events.


740
00:32:32,476 --> 00:32:36,886
Previously, we had basically a
singleton GK turn-based event


741
00:32:36,886 --> 00:32:39,606
handler object that you
would set a delegate to.


742
00:32:40,366 --> 00:32:43,056
And it was a singleton and
you can only have one delegate


743
00:32:43,056 --> 00:32:46,766
and you had to kind of process
events all in one place.


744
00:32:47,216 --> 00:32:50,806
We now have this listener
model and you're going to want


745
00:32:50,806 --> 00:32:52,736
to implement the GK
turn-based event listener.


746
00:32:53,206 --> 00:32:55,626
It's a protocol for
turn-based events.


747
00:32:56,066 --> 00:32:59,726
These events include state
changes such as invitations,


748
00:32:59,726 --> 00:33:03,316
new turns, turns getting
passed, match data getting saved


749
00:33:03,316 --> 00:33:07,086
and updated, as well as match
ended events when you're


750
00:33:07,506 --> 00:33:10,996
in the game and for the
turn-based exchanges,


751
00:33:11,286 --> 00:33:13,296
the various exchange
or events for requests,


752
00:33:13,586 --> 00:33:15,066
cancellations and completions.


753
00:33:17,176 --> 00:33:19,386
As with all the events
these kind of come


754
00:33:19,386 --> 00:33:20,296
from the local player.


755
00:33:20,296 --> 00:33:22,116
The local player is the producer


756
00:33:22,116 --> 00:33:23,676
of these events 'cause
they all sort


757
00:33:23,746 --> 00:33:24,736
of involve the local player.


758
00:33:25,806 --> 00:33:29,146
And this replaces the older
turn-based handler and delegate


759
00:33:29,146 --> 00:33:31,056
which we have deprecated
in iOS 7.


760
00:33:32,866 --> 00:33:36,126
The nice part is you can
have multiple listeners.


761
00:33:36,606 --> 00:33:38,416
All of the protocol
methods are optional.


762
00:33:39,106 --> 00:33:41,676
You can implement the ones
you want, where you want them.


763
00:33:42,266 --> 00:33:44,686
And so, it can simplify the
decisions you have to make.


764
00:33:44,986 --> 00:33:49,576
For example, your app delegate
can remain in responsibility


765
00:33:49,576 --> 00:33:51,826
of receiving new turn
notifications, right?


766
00:33:51,876 --> 00:33:56,146
When the user activates the app
and you've got a turn, you know,


767
00:33:56,146 --> 00:33:58,776
you want to jump right into
that and you're going to start


768
00:33:58,776 --> 00:33:59,516
that with your app again.


769
00:34:00,136 --> 00:34:03,146
But, if the users viewing a
match, your view controller


770
00:34:03,276 --> 00:34:06,816
for that game state can listen
for the events for updates.


771
00:34:07,006 --> 00:34:09,366
And it can ignore all
other updates except ones


772
00:34:09,366 --> 00:34:10,916
that affect that match.


773
00:34:11,216 --> 00:34:13,146
And then it can just show
the updates to the user.


774
00:34:13,606 --> 00:34:15,126
It doesn't have to worry
about anything else.


775
00:34:17,976 --> 00:34:20,065
To do this, you know, you're
going to set up for listener.


776
00:34:20,576 --> 00:34:22,646
And you start by
adopting this protocol.


777
00:34:23,996 --> 00:34:27,056
The next thing you do is you're
going to register your listener


778
00:34:27,056 --> 00:34:30,926
or listeners with the local
player using the simple


779
00:34:30,956 --> 00:34:33,226
registered listener method.


780
00:34:34,616 --> 00:34:37,056
And as I've said, you can
register multiple listeners.


781
00:34:37,056 --> 00:34:39,206
You can separate
responsibilities in your app.


782
00:34:39,636 --> 00:34:41,476
And ultimately you
can have simpler code


783
00:34:41,815 --> 00:34:43,686
and less convoluted
decision trees


784
00:34:43,686 --> 00:34:46,196
when you get turn-based events.


785
00:34:46,626 --> 00:34:48,676
So, let's take a look at
what the protocol provides.


786
00:34:48,966 --> 00:34:50,876
These are the basic turn events.


787
00:34:51,996 --> 00:34:54,636
We have, you know, the
generic turn event.


788
00:34:54,636 --> 00:34:58,776
This is when the match state
changes and it's, you know,


789
00:34:58,776 --> 00:35:02,376
player received the turn event
for match, did become active.


790
00:35:03,376 --> 00:35:04,926
So, this is you and
get this is on invites.


791
00:35:04,926 --> 00:35:06,456
You can get this one
when it comes your turn


792
00:35:06,636 --> 00:35:08,016
and when the match
state changes.


793
00:35:09,776 --> 00:35:12,456
The next is match
requests from Game Center.


794
00:35:14,026 --> 00:35:18,156
This is relatively uncommon, but
Game Center provides a mechanism


795
00:35:18,156 --> 00:35:22,126
for users to essentially
choose to play your game


796
00:35:22,126 --> 00:35:23,236
with one of their friends.


797
00:35:24,096 --> 00:35:26,496
When this happens,
your game gets launched


798
00:35:27,146 --> 00:35:30,206
and the event you will receive
is player did request match


799
00:35:30,206 --> 00:35:30,906
with players.


800
00:35:32,436 --> 00:35:35,156
The right action here is for
you to create a new match


801
00:35:35,256 --> 00:35:36,946
with these players, so that,


802
00:35:36,946 --> 00:35:38,916
the user can immediately start
playing with their friends.


803
00:35:40,396 --> 00:35:43,866
And finally the last basic
event we have is the match


804
00:35:43,866 --> 00:35:44,356
ended event.


805
00:35:44,406 --> 00:35:47,346
You've ended the
turn and all players.


806
00:35:47,646 --> 00:35:50,256
So, you've ended the match and
all players now get notified


807
00:35:50,256 --> 00:35:51,106
that the match is over.


808
00:35:52,166 --> 00:35:54,186
And this is player match ended.


809
00:35:59,076 --> 00:36:01,376
So, let's take a look
at the new turn event.


810
00:36:01,466 --> 00:36:04,806
As I've said, this is sort of
the most complicated scenario


811
00:36:04,806 --> 00:36:08,036
and I'm going to actually walk
through this with the sort


812
00:36:08,036 --> 00:36:09,316
of the full decision
tree you make.


813
00:36:09,316 --> 00:36:11,696
So, it's going to go over
kind of multiple slides here.


814
00:36:11,876 --> 00:36:14,216
And we're going to start
here with, you know,


815
00:36:14,216 --> 00:36:16,276
the method its player
receive turn event


816
00:36:16,276 --> 00:36:17,986
for match did become active.


817
00:36:18,646 --> 00:36:20,956
And the part focused on
first that did become active.


818
00:36:21,866 --> 00:36:26,656
This flag will be, yes, and
true win the event is the one


819
00:36:26,656 --> 00:36:28,846
that we activated
your application for.


820
00:36:29,296 --> 00:36:33,406
And this happens when the user
taps on a banner for the event


821
00:36:33,496 --> 00:36:35,406
in a notification
center, you know,


822
00:36:35,406 --> 00:36:37,656
they swipe on the lock screen
when we launch their game,


823
00:36:37,996 --> 00:36:41,416
or they select the
turn-based match in Game Center


824
00:36:41,576 --> 00:36:43,566
in the turn, you know the common
turn list that we all have


825
00:36:44,066 --> 00:36:45,436
and select to play this match.


826
00:36:46,136 --> 00:36:48,876
We will launch your game and you
will receive this event as soon


827
00:36:48,876 --> 00:36:49,796
as you set up this listener.


828
00:36:50,826 --> 00:36:54,206
If did become active
is true, what you need


829
00:36:54,206 --> 00:36:55,816
to do is immediately
switch to this match.


830
00:36:56,516 --> 00:36:59,326
The user has already
chosen to play this match.


831
00:37:00,336 --> 00:37:02,096
It doesn't make sense
to ask them again.


832
00:37:02,846 --> 00:37:05,386
You want to basically save
off any current state,


833
00:37:06,296 --> 00:37:07,796
allow them to go
to this new match.


834
00:37:07,836 --> 00:37:09,966
And then you're done,
you don't have


835
00:37:09,966 --> 00:37:11,066
to really handle anything else.


836
00:37:11,066 --> 00:37:12,686
You know, you-- they're
ready to play.


837
00:37:13,986 --> 00:37:17,416
But if it's not the one that
activated your app, now you want


838
00:37:17,416 --> 00:37:18,536
to handle it more selectively.


839
00:37:20,856 --> 00:37:22,416
So again, we're going
to continue


840
00:37:22,416 --> 00:37:24,576
with the received
turned event from match.


841
00:37:25,886 --> 00:37:28,146
Here, we want to
look for matches


842
00:37:28,146 --> 00:37:29,236
that are the current match.


843
00:37:29,876 --> 00:37:31,636
So, this is something
that if you were--


844
00:37:32,226 --> 00:37:33,496
you want a separate
responsibilities


845
00:37:33,496 --> 00:37:35,536
that your view controller
for the game can do.


846
00:37:35,536 --> 00:37:37,696
And then you just can
listen for matches


847
00:37:37,696 --> 00:37:38,896
that match the current match.


848
00:37:38,896 --> 00:37:41,576
Now, you can do the easy equal
check between my current match


849
00:37:41,646 --> 00:37:43,866
and the matches passed
on this event.


850
00:37:44,796 --> 00:37:50,896
If it is a match, it's the same
one, you can call refresh match


851
00:37:51,246 --> 00:37:54,936
and update the UI for the user
so they can see the latest turns


852
00:37:54,936 --> 00:37:58,096
that were taken and-- yeah,
you can do simple animations,


853
00:37:58,206 --> 00:37:59,776
whatever is necessary
to make your game fun.


854
00:38:01,246 --> 00:38:02,576
If it's not the current match,


855
00:38:02,756 --> 00:38:06,396
there's a little
bit more work to do.


856
00:38:06,396 --> 00:38:10,016
So again, we're going to receive
a turned event, this time,


857
00:38:10,406 --> 00:38:11,656
it's not the current match.


858
00:38:12,596 --> 00:38:13,826
What's the right
thing to do here?


859
00:38:15,056 --> 00:38:18,956
Well, did the player
just get a new turn?


860
00:38:18,956 --> 00:38:19,906
Is it the player's turn?


861
00:38:20,216 --> 00:38:21,416
So here were checking this


862
00:38:21,456 --> 00:38:24,106
by comparing the current
participant's player ID


863
00:38:24,826 --> 00:38:28,126
to the local player's ID-- like
the producer of this event,


864
00:38:28,986 --> 00:38:30,556
the player passing
is the local player.


865
00:38:30,946 --> 00:38:33,636
If these player IDs are
the same, this indicates


866
00:38:33,736 --> 00:38:37,866
that your player now is the
current player in this turn.


867
00:38:38,876 --> 00:38:40,826
That's kind of an
important event.


868
00:38:41,096 --> 00:38:44,986
So, what you want to do
here is consider some way


869
00:38:44,986 --> 00:38:46,066
to notify the user.


870
00:38:46,776 --> 00:38:50,396
They might be busy in having fun
taking a turn so you don't want


871
00:38:50,396 --> 00:38:53,046
to take them immediately
out of that current match.


872
00:38:53,736 --> 00:38:55,506
So, we recommend, you know,
some way to notify them.


873
00:38:55,506 --> 00:38:58,896
You can use Game Centers, you
know, notification banner,


874
00:38:58,896 --> 00:39:01,156
API and show a banner on
the top of your screen.


875
00:39:01,536 --> 00:39:04,166
You can-- put a badge
on your UI somewhere.


876
00:39:04,566 --> 00:39:07,376
You can show an alert
but let the user know


877
00:39:07,376 --> 00:39:09,476
that somebody is waiting
on them somewhere else,


878
00:39:09,976 --> 00:39:11,186
that they have another option--


879
00:39:12,196 --> 00:39:14,666
but don't take them out
of their turned context.


880
00:39:16,896 --> 00:39:20,186
All right, so that wraps up
the turn events and we'll look


881
00:39:20,186 --> 00:39:21,576
at now this match request.


882
00:39:21,576 --> 00:39:24,616
As I said, this is rare but
it's an important scenario.


883
00:39:25,536 --> 00:39:27,176
The user wants to play
with their friends.


884
00:39:27,296 --> 00:39:30,656
In Game Center, the application
has launched your game.


885
00:39:31,886 --> 00:39:33,756
How to handle this is
really quite simple.


886
00:39:33,756 --> 00:39:35,086
It's like creating any match.


887
00:39:35,086 --> 00:39:38,246
So, the first thing you do is
you create a match request.


888
00:39:38,246 --> 00:39:40,626
Here, I create one with,
you know, two players.


889
00:39:41,456 --> 00:39:44,446
I'm going to set the array that
was passing a play ready is


890
00:39:44,446 --> 00:39:46,926
to invite as the players to
invite on this match request.


891
00:39:47,666 --> 00:39:50,616
I'm going to let the user
specify the invite message


892
00:39:51,906 --> 00:39:53,946
and then just like any--


893
00:39:54,186 --> 00:39:56,646
creating a match I showed
you earlier, you're going


894
00:39:56,646 --> 00:39:59,956
to simply call find match for
request with completion handler.


895
00:40:03,196 --> 00:40:06,926
So, that's everything
you need do


896
00:40:06,926 --> 00:40:08,246
for basic turn-based
gaming today.


897
00:40:09,476 --> 00:40:11,156
Now, I'm going to get
into the new stuff.


898
00:40:11,156 --> 00:40:14,936
This is turn-based
exchanges and you might ask,


899
00:40:15,026 --> 00:40:16,336
what is turn-based exchange?


900
00:40:16,376 --> 00:40:20,506
Well, a turn-base exchange
is an out of band exchange


901
00:40:20,506 --> 00:40:21,576
of data between players.


902
00:40:22,376 --> 00:40:25,776
Recall that with the current
turn-base gaming mechanism,


903
00:40:26,266 --> 00:40:28,696
the only person who can,
basically, put new data


904
00:40:28,696 --> 00:40:29,656
into the match is the one


905
00:40:29,656 --> 00:40:31,376
who currently has the
turn, he can upload it.


906
00:40:31,456 --> 00:40:34,916
And when he does that, he
passes the turn to someone else.


907
00:40:35,626 --> 00:40:37,606
Exchanges allow you to
pass a little bit of data


908
00:40:37,606 --> 00:40:40,486
from one player to another,
from any player to another.


909
00:40:41,666 --> 00:40:43,776
And this is done through
basically a single reply,


910
00:40:44,056 --> 00:40:47,276
a single request, and
then a reply, one reply,


911
00:40:47,276 --> 00:40:51,266
from each player that that
request may have been sent to.


912
00:40:51,486 --> 00:40:55,476
What this allows is for you
to do some interesting things,


913
00:40:55,476 --> 00:40:58,616
you can do trading, you can
do auctions, but you also get


914
00:40:58,616 --> 00:41:01,656
to keep the current player
of the game, you player,


915
00:41:02,086 --> 00:41:04,916
in control of the duration
of their term, right?


916
00:41:04,956 --> 00:41:07,246
Other ways to handle some
of these complex scenarios


917
00:41:07,246 --> 00:41:08,906
which I will show
you later, you know,


918
00:41:08,906 --> 00:41:12,536
you're kind of relinquishing
control and-- and the game can,


919
00:41:12,536 --> 00:41:14,006
you know, kind of get messed up.


920
00:41:14,536 --> 00:41:17,166
But we now allow users
to control the duration,


921
00:41:17,296 --> 00:41:19,826
have the communications with
the other players in the match,


922
00:41:19,976 --> 00:41:23,726
and be able to control how
long it takes with time-outs,


923
00:41:23,726 --> 00:41:26,306
and you have the ability
to cancel this at any time.


924
00:41:27,586 --> 00:41:29,016
And as with everything
in turn-base gaming,


925
00:41:29,016 --> 00:41:31,026
this is fully asynchronous.


926
00:41:31,026 --> 00:41:32,726
You know, the user
only has to wait


927
00:41:32,726 --> 00:41:33,766
as long as they want to wait.


928
00:41:34,476 --> 00:41:36,116
You don't have to
wait for a reply.


929
00:41:36,596 --> 00:41:38,556
You can abandon it
and cancel a request.


930
00:41:41,916 --> 00:41:43,826
Why are we giving you exchanges?


931
00:41:43,826 --> 00:41:46,176
Well, we heard a
lot of feedback.


932
00:41:46,956 --> 00:41:49,086
There were kind of-- when we
introduced turn-based gaming,


933
00:41:49,086 --> 00:41:51,086
there were some concerns
about how this would work


934
00:41:51,086 --> 00:41:52,156
with more complex games.


935
00:41:53,046 --> 00:41:56,006
And we believe, exchanges
are the solution


936
00:41:56,006 --> 00:41:57,616
to these difficult scenarios.


937
00:41:57,906 --> 00:41:59,576
Let's take a look at
some of the scenarios


938
00:41:59,576 --> 00:42:01,526
that we think turn-base
exchanges really help solve.


939
00:42:02,106 --> 00:42:04,696
And I expect that you, being
as creative as you are,


940
00:42:04,696 --> 00:42:06,966
can find some really cool
usage of-- uses of these.


941
00:42:07,956 --> 00:42:10,516
But the primary one, you know,


942
00:42:10,516 --> 00:42:12,536
one of the first ones here
is trading resources, right?


943
00:42:12,966 --> 00:42:14,236
You're in the middle
of turn-base game


944
00:42:14,706 --> 00:42:17,026
and your player's taking
their turn and they want


945
00:42:17,026 --> 00:42:19,476
to trade some gold to
someone else and get some ore.


946
00:42:20,976 --> 00:42:23,146
Well, it's challenging.


947
00:42:23,736 --> 00:42:25,056
What type of trades are there?


948
00:42:25,346 --> 00:42:27,396
Well, there are trades that are
initiated by the current player.


949
00:42:28,056 --> 00:42:29,326
We could make that happen


950
00:42:29,596 --> 00:42:31,796
with turn-base gaming
before exchanges.


951
00:42:32,606 --> 00:42:35,026
But there are other types of
trades such as trades initiated


952
00:42:35,026 --> 00:42:37,516
by a different player who
doesn't currently have to turn


953
00:42:38,166 --> 00:42:41,586
with your player or
trades between two people


954
00:42:41,586 --> 00:42:43,586
that are unrelated to
the current player.


955
00:42:43,586 --> 00:42:45,846
We also offer things like
auctions of properties


956
00:42:45,846 --> 00:42:48,296
where you're going to
involve one or more


957
00:42:48,296 --> 00:42:50,516
or all the players
in the action.


958
00:42:50,516 --> 00:42:53,276
And then you can do things
like simultaneous turns


959
00:42:53,276 --> 00:42:54,966
or otherwise known as
kind of gated matches,


960
00:42:55,446 --> 00:42:58,566
where you let everybody
take a small action,


961
00:42:58,596 --> 00:43:01,356
you gather the results, you
integrate it into the turn,


962
00:43:01,356 --> 00:43:02,626
you move it on, and
you take next turn.


963
00:43:04,256 --> 00:43:06,856
And this also can be used for
like a simple messaging thing


964
00:43:06,856 --> 00:43:10,606
where you can let users send
thoughts, or cubits and kind


965
00:43:10,606 --> 00:43:14,886
of send little hints out of
band and to their partners.


966
00:43:16,886 --> 00:43:22,506
So, before exchanges, how
would you handle these


967
00:43:22,566 --> 00:43:23,536
difficult scenarios?


968
00:43:24,336 --> 00:43:26,686
Well, it all starts
with the turn, right?


969
00:43:26,686 --> 00:43:30,596
You start with the turn, then
you might edit the game state,


970
00:43:30,596 --> 00:43:32,576
put it into some special mode
that says, "Hey, I'm trading."


971
00:43:32,576 --> 00:43:37,636
And then you're going to
pass the turn to the players


972
00:43:37,676 --> 00:43:39,616
that the user wants
to trade with


973
00:43:39,766 --> 00:43:41,116
and you'll give it
a short time-out


974
00:43:41,116 --> 00:43:44,716
so that you can actually
recover and then return the turn


975
00:43:44,716 --> 00:43:45,496
to the original player.


976
00:43:45,496 --> 00:43:50,036
And at the end you'll resolve
a special mode, you know, "Hey,


977
00:43:50,036 --> 00:43:51,666
the user accepted the
trade, but the resources


978
00:43:51,666 --> 00:43:53,286
in their game state let
them finish their turn."


979
00:43:56,436 --> 00:43:58,176
Why is this really hard?


980
00:43:58,176 --> 00:43:59,086
Why is this none ideal?


981
00:43:59,086 --> 00:44:02,446
Well, you've relinquished
the turn and that means


982
00:44:02,446 --> 00:44:04,776
that the full duration
of this turn is not


983
00:44:04,776 --> 00:44:06,766
under the player's
control, right?


984
00:44:06,766 --> 00:44:09,006
If the other player that you
gave a turn to that you want


985
00:44:09,006 --> 00:44:11,336
to trade with, answer is
fast, create might work,


986
00:44:11,916 --> 00:44:13,116
but if you have to
wait for that time


987
00:44:13,116 --> 00:44:15,006
out if they're not
available to reply,


988
00:44:15,666 --> 00:44:17,366
they can take a very
long time to resolve


989
00:44:17,886 --> 00:44:20,006
and your player never really
got to finish their turn.


990
00:44:21,656 --> 00:44:24,456
What is this look like
with the exchanges?


991
00:44:25,726 --> 00:44:27,256
Well, it's simpler
here, you know,


992
00:44:27,256 --> 00:44:29,886
we've taken out a
few of the steps.


993
00:44:29,886 --> 00:44:32,496
We start the turn, we
request an exchange,


994
00:44:32,666 --> 00:44:33,556
I want to trade with you.


995
00:44:34,606 --> 00:44:37,886
You receive a reply,
here is my counter offer,


996
00:44:38,816 --> 00:44:41,606
you'll then take this
exchange you'll resolve it


997
00:44:41,606 --> 00:44:44,356
into the matched data, maybe
you'll initiate more exchanges.


998
00:44:45,696 --> 00:44:47,336
But you can leave
this up to the user.


999
00:44:47,396 --> 00:44:49,116
What they're doing
is based on them.


1000
00:44:50,066 --> 00:44:52,606
If they don't want to
wait for them for reply,


1001
00:44:52,606 --> 00:44:55,236
you can cancel them for them,
then they'll end their turn.


1002
00:44:58,016 --> 00:45:00,106
What are-- what are the
classes you use for exchanges?


1003
00:45:00,176 --> 00:45:02,646
Well, we added a
few more for this.


1004
00:45:03,086 --> 00:45:05,836
Obviously there's a new class
called GK turn-base exchange.


1005
00:45:06,346 --> 00:45:08,566
This represents the requests.


1006
00:45:08,996 --> 00:45:11,596
It has the sender, that's
usually your player,


1007
00:45:11,596 --> 00:45:13,706
but it can be any of the
people if you're sending them,


1008
00:45:13,706 --> 00:45:14,656
you know, the [inaudible]
player.


1009
00:45:15,056 --> 00:45:17,936
All the recipients of the
exchanges, this is one or more


1010
00:45:17,936 --> 00:45:19,156
of the participants
of the match.


1011
00:45:20,256 --> 00:45:22,576
You can send these
to open seats, right,


1012
00:45:22,666 --> 00:45:23,986
just like moving a
turn to an open seat.


1013
00:45:23,986 --> 00:45:25,406
You send and exchange
to an open seat,


1014
00:45:26,256 --> 00:45:29,166
it will trigger the invitation
or trigger auto match to fill


1015
00:45:29,166 --> 00:45:32,206
that seat, so someone will come
in and handle that exchange.


1016
00:45:33,956 --> 00:45:37,426
Each exchange has its status,
whether it's active, if you--


1017
00:45:37,426 --> 00:45:39,456
it's been canceled,
if it's completed,


1018
00:45:39,456 --> 00:45:40,906
and then the final
one is resolved.


1019
00:45:41,996 --> 00:45:43,986
Each exchange covered
its own message, right,


1020
00:45:43,986 --> 00:45:45,716
so you can include
a visible message,


1021
00:45:45,826 --> 00:45:48,386
a string for the user
and a small payload.


1022
00:45:49,016 --> 00:45:50,236
We allow you to specify data


1023
00:45:50,236 --> 00:45:52,016
up to one kilobyte
with each exchange.


1024
00:45:52,686 --> 00:45:54,776
And then the exchange
will track its replies.


1025
00:45:55,786 --> 00:45:57,866
You might-- if it's only sent
to one person, you get one reply


1026
00:45:58,026 --> 00:46:00,136
and then it will be completed
and you need to resolve it.


1027
00:46:00,836 --> 00:46:02,426
So the next class, obviously,


1028
00:46:02,426 --> 00:46:05,456
as it falls from this is the
GK turn-base exchange reply.


1029
00:46:06,586 --> 00:46:07,716
This has the recipient.


1030
00:46:07,716 --> 00:46:09,676
This is the person who
current exchange was sent


1031
00:46:09,676 --> 00:46:10,606
to and who is replying.


1032
00:46:11,096 --> 00:46:14,666
It has a message, so you can
have a message in response,


1033
00:46:14,666 --> 00:46:17,136
you know, and these generate
banners and notifications,


1034
00:46:17,136 --> 00:46:19,426
so that the user can see that
they left-- they left the game,


1035
00:46:19,426 --> 00:46:21,976
they can see, you know, that
hey I got a response, you know,


1036
00:46:21,976 --> 00:46:22,986
this person like, you know,


1037
00:46:23,636 --> 00:46:25,136
will make a counter
offer for my trade.


1038
00:46:26,016 --> 00:46:29,396
And then each reply has a small
payload as well, one kilobyte,


1039
00:46:29,396 --> 00:46:32,126
so that you can, you know,
take this payloads and request


1040
00:46:32,126 --> 00:46:34,556
and reply and then integrate
them into the match data.


1041
00:46:36,836 --> 00:46:38,226
So, what does this look like?


1042
00:46:38,336 --> 00:46:39,686
We've got our table here.


1043
00:46:40,906 --> 00:46:41,956
You have the game data.


1044
00:46:41,956 --> 00:46:42,796
It's your turn.


1045
00:46:44,136 --> 00:46:46,146
But you want to trade
with Meg and Bob.


1046
00:46:46,536 --> 00:46:48,716
So, you'll send one
exchange out to Meg.


1047
00:46:49,386 --> 00:46:51,196
We're going out of band
here so the turn goes away,


1048
00:46:51,196 --> 00:46:52,476
and we'll send another
exchange to Bob,


1049
00:46:52,476 --> 00:46:55,706
both of them will get notified,
now we're waiting for replies.


1050
00:46:56,586 --> 00:46:58,116
We get a reply quickly form Meg.


1051
00:46:58,116 --> 00:47:00,216
And we like it.


1052
00:47:00,216 --> 00:47:01,766
You know, the user--
users happy with it.


1053
00:47:01,766 --> 00:47:05,266
They accept the trade, so you
can cancel the exchange to Bob.


1054
00:47:06,546 --> 00:47:09,476
Integrate the results of
this exchange in reply


1055
00:47:09,956 --> 00:47:11,366
into the turn-base-- turn state,


1056
00:47:12,166 --> 00:47:14,516
go back to taking the
term and then finish it.


1057
00:47:14,736 --> 00:47:17,016
Upload the turn data that has
the results of the exchange,


1058
00:47:17,126 --> 00:47:22,156
and then move the turn to Sue.


1059
00:47:22,236 --> 00:47:25,236
So, there's sort of a
three Rs to exchanges.


1060
00:47:25,236 --> 00:47:26,886
This is what you want to
remember from exchanges.


1061
00:47:26,886 --> 00:47:28,676
You're going to request
an exchange,


1062
00:47:28,716 --> 00:47:29,646
all right, the first R.


1063
00:47:30,406 --> 00:47:31,516
It all starts with this.


1064
00:47:31,716 --> 00:47:33,806
It can be started by any
player in that match.


1065
00:47:34,326 --> 00:47:36,036
It can be started at any time.


1066
00:47:37,036 --> 00:47:40,126
Each exchange can target
one or multiple players,


1067
00:47:40,786 --> 00:47:42,466
and they all include
a small payload.


1068
00:47:44,006 --> 00:47:48,806
The next R, the second is
to reply to the exchange,


1069
00:47:49,146 --> 00:47:52,446
each player that we send the
exchange to, we expect a reply


1070
00:47:52,446 --> 00:47:56,036
from or time-out and you
can cancel if you need to.


1071
00:47:56,036 --> 00:47:57,446
And then the last


1072
00:47:57,446 --> 00:48:00,166
or the important one is
all completed exchanges,


1073
00:48:00,166 --> 00:48:02,836
that is all the exchanges that
we've got replies for need


1074
00:48:02,836 --> 00:48:06,106
to be resolved into the
match date before ending the


1075
00:48:06,106 --> 00:48:06,616
current turn.


1076
00:48:06,926 --> 00:48:09,576
If you fail to do so, you
will receive an error,


1077
00:48:10,236 --> 00:48:11,556
and you'll need to go
back and resolve those


1078
00:48:11,556 --> 00:48:13,276
into the state and
then try again.


1079
00:48:14,466 --> 00:48:15,836
So what does this look like?


1080
00:48:15,836 --> 00:48:18,786
Well, to request an
exchange, you know,


1081
00:48:18,846 --> 00:48:19,886
determine the number of players.


1082
00:48:19,886 --> 00:48:22,626
You can send it to one of more
people, remember you can send it


1083
00:48:22,626 --> 00:48:24,036
to empty seats, so if you--


1084
00:48:24,036 --> 00:48:26,346
especially if you're doing
like a gated turn-base match


1085
00:48:26,346 --> 00:48:28,546
for simultaneous
turns, you want--


1086
00:48:28,546 --> 00:48:30,056
sending it to empty
seats is very important


1087
00:48:30,056 --> 00:48:31,376
to be able to fill them in.


1088
00:48:32,616 --> 00:48:34,266
For each participant
that we sent it to,


1089
00:48:34,266 --> 00:48:36,076
we expect a single reply.


1090
00:48:37,556 --> 00:48:41,586
And the API to do is send
exchange to participants


1091
00:48:41,746 --> 00:48:43,956
with data, localize
well message,


1092
00:48:44,846 --> 00:48:46,736
arguments, and the time out.


1093
00:48:47,086 --> 00:48:50,246
And then you'll get a completion
handler that will be callback


1094
00:48:50,246 --> 00:48:52,286
with the exchange that
was successfully created.


1095
00:48:54,166 --> 00:48:56,446
Replying is essentially
just as simple.


1096
00:48:57,206 --> 00:49:00,656
This is an instance method
on the exchange itself.


1097
00:49:01,036 --> 00:49:04,396
Each exchange gets a single
reply form each participant


1098
00:49:04,436 --> 00:49:08,546
that it was sent to, and the
exchanges marked completed,


1099
00:49:08,976 --> 00:49:11,806
once all replies or
time outs are received


1100
00:49:11,806 --> 00:49:12,606
from each participants.


1101
00:49:12,606 --> 00:49:15,086
And then once completed,
you need to resolve it.


1102
00:49:15,676 --> 00:49:19,516
So to reply, you call reply
with localized well message,


1103
00:49:19,976 --> 00:49:23,006
given arguments, the data
payload that is all yours,


1104
00:49:23,006 --> 00:49:24,456
and the completion handler.


1105
00:49:25,786 --> 00:49:26,746
And then that's it.


1106
00:49:26,746 --> 00:49:29,936
The reply is sent, the
recipient receives it,


1107
00:49:29,936 --> 00:49:31,656
and the game can move on.


1108
00:49:32,626 --> 00:49:36,336
Once your user is done
with an exchange, right?


1109
00:49:36,526 --> 00:49:37,776
They don't want the results.


1110
00:49:38,496 --> 00:49:39,306
They're tired.


1111
00:49:39,306 --> 00:49:40,976
You know, they want to get
on and finish their turn.


1112
00:49:41,486 --> 00:49:42,616
You can cancel exchanges.


1113
00:49:42,616 --> 00:49:45,976
This leaves the control and
the duration of the exchange


1114
00:49:45,976 --> 00:49:48,216
and the turn in control
of your player.


1115
00:49:49,326 --> 00:49:50,666
And so when you don't
want to wait


1116
00:49:50,666 --> 00:49:52,076
for further replies, cancel it.


1117
00:49:52,606 --> 00:49:55,466
You can cancel active, once
that you're still waiting


1118
00:49:55,466 --> 00:49:57,356
for replies, or even
complete an exchange.


1119
00:49:57,356 --> 00:49:58,446
I mean this is going
to essentially say,


1120
00:49:58,446 --> 00:49:59,976
I'm discarding the results
from this completed exchange.


1121
00:50:00,046 --> 00:50:03,536
I don't need to reconcile,
resolve it.


1122
00:50:03,866 --> 00:50:07,246
And the act of cancelling
an exchange removes it


1123
00:50:07,246 --> 00:50:07,866
from the match.


1124
00:50:09,546 --> 00:50:11,726
So, did you saw-- you can
call the instance method


1125
00:50:11,726 --> 00:50:14,606
on the exchange; cancel
with localized message,


1126
00:50:15,336 --> 00:50:17,056
given some arguments and
a completion handler.


1127
00:50:17,526 --> 00:50:19,596
The users that have been waiting
for exchange will be able


1128
00:50:19,596 --> 00:50:21,686
to see a notification
that, yes this request


1129
00:50:21,686 --> 00:50:23,236
that you've done
previously has been canceled.


1130
00:50:25,116 --> 00:50:30,036
And lastly now, the final R
is resolving the exchanges.


1131
00:50:31,456 --> 00:50:35,636
Remember that all completed
exchanges needed resolve


1132
00:50:35,636 --> 00:50:39,996
and an exchange is complete
once you receive all the replies


1133
00:50:39,996 --> 00:50:42,486
for it including time outs.


1134
00:50:44,706 --> 00:50:46,966
It's also very important
to remember that you need


1135
00:50:46,966 --> 00:50:49,466
to resolve all the
completed exchanges


1136
00:50:49,856 --> 00:50:52,176
and that exchanges could
be done between players


1137
00:50:52,176 --> 00:50:54,736
that are not the current
player, some of you--


1138
00:50:54,736 --> 00:50:56,346
you're going to have to
check and see, you know,


1139
00:50:56,456 --> 00:50:58,526
which exchanges have been
completed, handle that


1140
00:50:58,526 --> 00:50:59,966
and integrate that
into your match data.


1141
00:51:00,306 --> 00:51:02,326
You know, how you do
that is all up to you.


1142
00:51:02,486 --> 00:51:05,236
You own the payloads and the
requests and the replies.


1143
00:51:05,326 --> 00:51:08,456
You own the match data, you
know, but you need to tell us


1144
00:51:08,456 --> 00:51:10,686
that you have resolved
this exchange,


1145
00:51:10,686 --> 00:51:13,656
and we will remove resolved
exchanges from the match.


1146
00:51:13,846 --> 00:51:18,096
So what you do is you gather
the data form the exchange


1147
00:51:18,096 --> 00:51:18,676
and reply.


1148
00:51:19,746 --> 00:51:20,906
You do what you need
to with that.


1149
00:51:21,726 --> 00:51:25,546
You then merge this into
the match state and then


1150
00:51:25,826 --> 00:51:28,576
when you resolve it,
we'll remove the match


1151
00:51:28,576 --> 00:51:30,206
so that it's no longer there.


1152
00:51:31,546 --> 00:51:32,496
Resolving the exchange.


1153
00:51:32,646 --> 00:51:35,376
So, we give you a
convenience method


1154
00:51:35,376 --> 00:51:37,166
to get all the completed
exchanges on the match.


1155
00:51:37,756 --> 00:51:39,776
It's this property,
completed exchanges.


1156
00:51:41,596 --> 00:51:44,396
You're going to go-- then
take this completed exchanges


1157
00:51:44,666 --> 00:51:47,346
and you're going to gather
the data-- the match, sorry,


1158
00:51:47,346 --> 00:51:50,206
the data from each exchange
and each reply and put it


1159
00:51:50,206 --> 00:51:52,706
into your new match data,
the merged match data here.


1160
00:51:53,586 --> 00:51:56,526
And then just like when we say
saving an intermediate turn,


1161
00:51:57,326 --> 00:52:00,616
we have this method where you
can save this new merged data


1162
00:52:00,666 --> 00:52:01,776
without passing the turn.


1163
00:52:02,276 --> 00:52:04,056
So, you call saved
merged matched data


1164
00:52:04,366 --> 00:52:06,276
with resolved exchanges
and completion handler.


1165
00:52:07,036 --> 00:52:08,266
And the reason you want
to do this is you want


1166
00:52:08,266 --> 00:52:10,066
to resolve exchanges
as they get completed.


1167
00:52:10,586 --> 00:52:14,316
But you don't necessarily end
the turn when you do this.


1168
00:52:14,536 --> 00:52:15,866
And then usually
continues with the turn.


1169
00:52:16,806 --> 00:52:21,436
Exchanges have their own event
handler protocol methods here.


1170
00:52:22,016 --> 00:52:24,076
So, as I mentioned
earlier, there are three.


1171
00:52:24,756 --> 00:52:26,626
You get to be notified
with an event


1172
00:52:26,696 --> 00:52:29,486
when you're player receives
a new exchange request,


1173
00:52:29,556 --> 00:52:31,836
that is player received
exchange request from match.


1174
00:52:33,186 --> 00:52:35,416
You'll be notified
when exchange request


1175
00:52:35,416 --> 00:52:36,926
that your player
has gets canceled.


1176
00:52:36,926 --> 00:52:40,016
The player received exchange
cancellation from match.


1177
00:52:41,326 --> 00:52:44,916
And you also be notified
when you have in exchange


1178
00:52:44,916 --> 00:52:47,326
that you sent out
has been completed,


1179
00:52:47,576 --> 00:52:48,836
or any exchange has
been completed.


1180
00:52:49,376 --> 00:52:50,116
And this is, you know,


1181
00:52:50,186 --> 00:52:51,556
the player received
exchange replies.


1182
00:52:51,556 --> 00:52:53,266
We're going to give you
all replies at this time.


1183
00:52:53,916 --> 00:52:56,206
For this completed
exchange, for match.


1184
00:52:59,966 --> 00:53:02,866
So, let's look at how we, you
know, what kind of we want to do


1185
00:53:02,866 --> 00:53:03,936
when we handle an exchange.


1186
00:53:04,396 --> 00:53:06,696
This is sort of similar to
getting a turned event, right?


1187
00:53:07,906 --> 00:53:10,306
Exchanges, you know, user
handling exchange, they're going


1188
00:53:10,306 --> 00:53:12,536
to be playing your
games like a mini turn.


1189
00:53:13,206 --> 00:53:13,956
Right, so you you're
going to want


1190
00:53:13,956 --> 00:53:17,406
to determine whether this
exchange, you know, the match is


1191
00:53:17,406 --> 00:53:18,656
for is your current
match, right?


1192
00:53:19,046 --> 00:53:20,556
If it's the one the
user's currently in,


1193
00:53:21,516 --> 00:53:23,376
immediately show them
the data, hey, you know,


1194
00:53:23,376 --> 00:53:25,756
there's a trade request
if you want to handle it.


1195
00:53:26,726 --> 00:53:28,256
If they're doing
something else in your app,


1196
00:53:28,446 --> 00:53:32,196
they're playing another match,
the same logic kind of holds


1197
00:53:32,196 --> 00:53:34,486
that we have for
turn state changes.


1198
00:53:34,876 --> 00:53:37,536
You don't want them to take this
immediately 'cause this will


1199
00:53:37,536 --> 00:53:38,516
interrupt what they're doing.


1200
00:53:39,206 --> 00:53:41,326
But you want to, you know,
notify them in some manner.


1201
00:53:42,466 --> 00:53:45,656
You know, showing some badge
in your UI, showing an alert,


1202
00:53:45,866 --> 00:53:48,726
using Game Center's
notification banners.


1203
00:53:51,916 --> 00:53:54,856
When you get in a cancel
exchange, it's pretty similar.


1204
00:53:54,856 --> 00:53:57,836
You know, if the users kind of
currently working on that match,


1205
00:53:57,866 --> 00:54:00,136
viewing that match,
dealing with that exchange,


1206
00:54:00,876 --> 00:54:03,626
you need to basically, say,
oh sorry we don't need you


1207
00:54:03,626 --> 00:54:06,496
to reply anymore,
return them to the match.


1208
00:54:07,726 --> 00:54:10,406
If they are, you know,


1209
00:54:10,406 --> 00:54:12,206
not dealing with this
exchange right now,


1210
00:54:12,206 --> 00:54:14,296
what you do is a little
less important, right?


1211
00:54:14,426 --> 00:54:16,456
You know, you've notified
them somehow, you know,


1212
00:54:16,456 --> 00:54:17,366
you've got a badge count.


1213
00:54:17,366 --> 00:54:20,516
Well, you want to clear
that so you'll, you know,


1214
00:54:20,556 --> 00:54:25,376
we use that badge somewhere,
hide your alert if you had one,


1215
00:54:25,376 --> 00:54:26,326
you know, clear the banner,


1216
00:54:26,756 --> 00:54:28,786
and then they'll be
able to continue.


1217
00:54:31,106 --> 00:54:33,556
Finally, you know, when
an exchange is completed,


1218
00:54:33,556 --> 00:54:36,776
you've done all the replies you
expect to receive, you know,


1219
00:54:36,776 --> 00:54:37,726
what do you want to do here?


1220
00:54:37,726 --> 00:54:41,566
Well, you're user that's getting
the reply is probably going


1221
00:54:41,566 --> 00:54:42,556
to want to do something with it.


1222
00:54:42,556 --> 00:54:43,406
If it's a trade, you know,


1223
00:54:43,406 --> 00:54:46,046
you'll see all the
different offers and you want


1224
00:54:46,046 --> 00:54:48,566
to let them pick which
one if they want to accept


1225
00:54:48,566 --> 00:54:49,606
or maybe make counter.


1226
00:54:50,426 --> 00:54:53,526
And so, you know, we check,
this the current match,


1227
00:54:53,526 --> 00:54:54,826
is this the current exchange,


1228
00:54:55,586 --> 00:54:57,616
immediately show
them the replies


1229
00:54:57,816 --> 00:54:58,986
because they're ready
to see that.


1230
00:54:59,686 --> 00:55:02,766
If it's not, you know,
show them, you know,


1231
00:55:02,766 --> 00:55:04,866
or clear appropriately the
banners that you need to show.


1232
00:55:05,626 --> 00:55:08,176
And let them know that something
is waiting for them to finalize


1233
00:55:08,176 --> 00:55:09,676
and finish their
match-- their turn.


1234
00:55:11,326 --> 00:55:14,136
So, I mentioned that
this also helps also


1235
00:55:14,136 --> 00:55:16,156
in difficult scenarios
and I talked about trading


1236
00:55:16,156 --> 00:55:18,266
and simultaneous turns,
and auctions of properties.


1237
00:55:19,226 --> 00:55:21,536
Let's see how you do this.


1238
00:55:22,706 --> 00:55:23,916
Using exchanges for trading,


1239
00:55:24,596 --> 00:55:26,776
you let the user decide
what they're going


1240
00:55:26,776 --> 00:55:27,646
to offer for trade, right?


1241
00:55:27,646 --> 00:55:28,506
It all starts there.


1242
00:55:29,596 --> 00:55:32,656
Then they will send
one exchange request


1243
00:55:32,656 --> 00:55:34,706
to each potential trade partners
or if it's going to be offered


1244
00:55:34,706 --> 00:55:36,876
to everybody, you'll
send out, you know,


1245
00:55:37,326 --> 00:55:40,636
one for each participant
in the match.


1246
00:55:40,636 --> 00:55:42,956
Once they've decided
they like something,


1247
00:55:43,216 --> 00:55:45,596
they can cancel all the
outstanding exchanges,


1248
00:55:46,626 --> 00:55:47,686
and then move on.


1249
00:55:47,936 --> 00:55:49,936
You know, you resolve the
complete exchange into the match


1250
00:55:50,406 --> 00:55:51,686
and let the user go on


1251
00:55:51,686 --> 00:55:53,566
and finish their turn maybe
they'll make another trade.


1252
00:55:55,016 --> 00:55:56,486
And they could have
multiple trades going


1253
00:55:56,486 --> 00:55:57,166
on at the same time.


1254
00:55:57,166 --> 00:55:58,226
It's entirely up to your logic.


1255
00:55:58,526 --> 00:55:59,326
What does this look like?


1256
00:55:59,516 --> 00:56:01,546
Well, you've actually seen
this animation before.


1257
00:56:01,546 --> 00:56:03,446
You get the match data, going


1258
00:56:03,446 --> 00:56:06,456
to send two requests
to Meg and Bob.


1259
00:56:07,586 --> 00:56:09,036
Meg's going to give
me a reply, I like.


1260
00:56:09,426 --> 00:56:13,206
I'll cancel the request to
Bob, resolve it into this--


1261
00:56:13,376 --> 00:56:15,856
the match state and
finish the turn.


1262
00:56:18,916 --> 00:56:23,206
Simultaneous turns, it's
a little more complex but,


1263
00:56:23,496 --> 00:56:25,706
you know, it involves
basically a single exchange.


1264
00:56:25,926 --> 00:56:27,256
So, you're going to
send one exchange


1265
00:56:27,256 --> 00:56:28,546
to all the participants
of the game.


1266
00:56:29,486 --> 00:56:31,926
You'll then wait until all
the replies are received


1267
00:56:31,926 --> 00:56:32,536
or time out.


1268
00:56:33,786 --> 00:56:35,896
You then can resolve
this completed exchange


1269
00:56:35,896 --> 00:56:37,946
into the match and
finish the turn.


1270
00:56:40,016 --> 00:56:41,966
Auctions, you can do similarly


1271
00:56:41,966 --> 00:56:44,016
or you can choose some
other mechanism to do this.


1272
00:56:44,386 --> 00:56:45,736
You know, send out an exchange


1273
00:56:45,736 --> 00:56:47,406
to all the participants
in the auction.


1274
00:56:47,656 --> 00:56:48,686
Give it a shot time out,


1275
00:56:49,516 --> 00:56:51,186
wait until all the
replies are received,


1276
00:56:51,726 --> 00:56:54,766
determine the high bidder,
you know, reward the item.


1277
00:56:54,766 --> 00:56:56,376
You repeat if you've
got some ties.


1278
00:56:56,466 --> 00:57:00,486
Send it just to those people let
them handle their tie and then,


1279
00:57:01,206 --> 00:57:04,476
you know, continue and resolve
the completely exchanged match


1280
00:57:05,506 --> 00:57:06,236
and finish the turn.


1281
00:57:07,146 --> 00:57:09,066
This looks a bit
different, right?


1282
00:57:09,786 --> 00:57:12,896
We're going to have a lot
of exchanges going or a lot


1283
00:57:12,896 --> 00:57:14,216
of lines that's going
to exchange.


1284
00:57:14,896 --> 00:57:16,046
I'm going to send
it out to everybody.


1285
00:57:16,116 --> 00:57:18,076
We're going to start
getting replies.


1286
00:57:18,076 --> 00:57:18,756
They're coming in.


1287
00:57:19,676 --> 00:57:23,286
We get all the replies,
exchanges completed.


1288
00:57:23,926 --> 00:57:26,606
We resolve it into the match
and we finish our turn.


1289
00:57:29,476 --> 00:57:35,256
So, that's how you can use
exchanges to do complex things,


1290
00:57:35,256 --> 00:57:36,166
very difficult scenarios.


1291
00:57:36,166 --> 00:57:39,476
You can make more complex, more
full featured turn-based games


1292
00:57:39,736 --> 00:57:41,346
and use on very interesting
things.


1293
00:57:42,636 --> 00:57:46,216
So, it's important to remember
the expectations that users have


1294
00:57:46,216 --> 00:57:48,446
of turn-based gaming
on mobile environments.


1295
00:57:48,446 --> 00:57:50,426
You have multiple sessions,
they expect to be able


1296
00:57:50,426 --> 00:57:53,416
to have matches, be able to
manage to just create new ones,


1297
00:57:53,516 --> 00:57:55,556
list them, remove old ones.


1298
00:57:56,646 --> 00:57:58,566
Remember, you have
to remember anything,


1299
00:57:58,566 --> 00:57:59,706
everything is asynchronous.


1300
00:58:00,156 --> 00:58:03,916
So, use the new event
listener, separate your code,


1301
00:58:03,916 --> 00:58:07,126
make it your code a little
more simpler but, you know,


1302
00:58:07,126 --> 00:58:08,996
do the right things,
and don't take users


1303
00:58:08,996 --> 00:58:10,666
out of the current context
when it is not appropriate.


1304
00:58:11,276 --> 00:58:14,066
And then yes, when you want
to switch the current match.


1305
00:58:14,066 --> 00:58:17,046
Well, you have to think about
when these are chose to move


1306
00:58:17,046 --> 00:58:18,906
to a new match, when they get
an invite for the new turn.


1307
00:58:22,056 --> 00:58:23,676
Wrapping things up, you know,


1308
00:58:24,356 --> 00:58:25,666
turn-based games
are great in mobile.


1309
00:58:25,776 --> 00:58:27,926
We believe its sort of
optimal solution in mobile,


1310
00:58:27,926 --> 00:58:28,696
where people can pick up


1311
00:58:28,696 --> 00:58:30,696
and play whenever they
have a spare moment.


1312
00:58:31,716 --> 00:58:34,036
We provide multiple
sessions, up to 30 sessions


1313
00:58:34,036 --> 00:58:35,586
for your game and your player.


1314
00:58:35,586 --> 00:58:37,806
It's a very simple structure


1315
00:58:38,136 --> 00:58:40,166
and only one person
can write to the data.


1316
00:58:40,166 --> 00:58:41,966
Game Center manages all
the synchronizations


1317
00:58:41,966 --> 00:58:42,576
through this model.


1318
00:58:44,406 --> 00:58:47,026
And we have exchanges,
a new feature for iOS 7


1319
00:58:47,086 --> 00:58:50,196
that make very difficult
scenarios pretty easy,


1320
00:58:50,736 --> 00:58:53,316
it opens up new game
modes and the things


1321
00:58:53,316 --> 00:58:55,216
to remember are the
three Rs of exchanges,


1322
00:58:55,386 --> 00:58:58,516
request, reply and resolve.


1323
00:59:00,376 --> 00:59:02,236
We want to thank you
for coming today.


1324
00:59:02,236 --> 00:59:03,356
If you need more information,


1325
00:59:03,356 --> 00:59:05,066
you can contact Allan
Shaffer [phonetic]


1326
00:59:05,066 --> 00:59:06,986
or Browser New Documentation.


1327
00:59:08,466 --> 00:59:12,126
There were successions earlier
for-- what's new in Game Center


1328
00:59:12,126 --> 00:59:13,506
and what's new in
iTunes Connect.


1329
00:59:13,946 --> 00:59:14,356
Thank you.


1330
00:59:14,356 --> 00:59:16,016
[Applause]


1331
00:59:16,016 --> 00:59:26,306
[ Silence ]

